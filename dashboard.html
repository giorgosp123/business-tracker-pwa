<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Business Tracker Pro">
    
    <title>Enhanced Business Dashboard</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --secondary: #764ba2;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --surface: rgba(255, 255, 255, 0.05);
            --surface-glass: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --border: rgba(255, 255, 255, 0.1);
            --border-hover: rgba(255, 255, 255, 0.2);
            --shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 60px rgba(0, 0, 0, 0.4);
            --radius: 1rem;
            --radius-lg: 1.5rem;
            --space-unit: 0.25rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e1e2e, #2a2a3e, #1a1a2e);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            font-feature-settings: 'liga' 1, 'kern' 1;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Glassmorphism containers */
        .glass {
            background: var(--surface-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid var(--border-hover);
            box-shadow: var(--shadow-lg);
        }

        /* Main container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            margin-bottom: 2rem;
        }

        .nav-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            gap: 1rem;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text-primary);
        }

        .brand-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            min-height: 2.75rem;
            touch-action: manipulation;
            user-select: none;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover:before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--surface-glass);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-error {
            background: linear-gradient(135deg, var(--error), #dc2626);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-icon {
            width: 2.5rem;
            height: 2.5rem;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Dropdown */
        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            min-width: 12rem;
            background: var(--surface-glass);
            backdrop-filter: blur(30px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow: hidden;
        }

        .dropdown.active .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s ease;
            cursor: pointer;
            min-height: 3rem;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border);
            margin: 0.5rem 0;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }

        /* Cards */
        .card {
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-subtitle {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* Stats Cards */
        .stat-card {
            text-align: center;
            padding: 2rem 1.5rem;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: 0.5rem;
            animation: countUp 1s ease-out;
        }

        @keyframes countUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-change {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            animation: fadeIn 0.5s ease-in-out 0.5s both;
        }

        .stat-change.positive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .stat-change.negative {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .stat-change.neutral {
            background: rgba(156, 163, 175, 0.1);
            color: var(--text-muted);
        }

        /* Form Controls */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s ease;
            min-height: 3rem;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-select {
            cursor: pointer;
        }

        /* Table */
        .table-container {
            border-radius: var(--radius-lg);
            overflow: hidden;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            max-height: 600px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .table th {
            background: rgba(255, 255, 255, 0.08);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
            position: relative;
        }

        .table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .table-cell-editable {
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0.5rem;
            margin: -0.25rem;
            padding: 0.25rem;
        }

        .table-cell-editable:hover {
            background: rgba(102, 126, 234, 0.1);
            color: var(--text-primary);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            padding: 1rem;
        }

        .chart-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .chart-type-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .chart-type-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-type-btn.active,
        .chart-type-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            max-width: 24rem;
            padding: 1rem 1.5rem;
            background: var(--surface-glass);
            backdrop-filter: blur(30px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            box-shadow: var(--shadow-lg);
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--error);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        .notification.info {
            border-left: 4px solid var(--info);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        /* Insights Panel */
        .insight-item {
            padding: 1.5rem;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .insight-item:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.08);
        }

        .insight-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .insight-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .insight-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .insight-action {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
            transition: all 0.2s ease;
        }

        .insight-action:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-1px);
        }

        /* Progress bars */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 1s ease;
            border-radius: 4px;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .nav-bar {
                padding: 1rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .nav-controls {
                order: 3;
                width: 100%;
                justify-content: space-between;
            }

            .btn {
                padding: 0.625rem 1rem;
                font-size: 0.8rem;
                min-height: 2.5rem;
            }

            .grid-2,
            .grid-3,
            .grid-4 {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 2rem;
            }

            .chart-controls {
                flex-direction: column;
                gap: 1rem;
            }

            .chart-type-buttons {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
            }

            .chart-container {
                height: 300px;
                padding: 0.5rem;
            }

            .form-input, .form-select {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .table th,
            .table td {
                padding: 0.75rem 0.5rem;
                font-size: 0.8rem;
            }

            .notification {
                right: 0.5rem;
                left: 0.5rem;
                max-width: none;
            }

            .dropdown-menu {
                left: 0;
                right: auto;
                min-width: 100%;
            }

            /* Enhanced touch targets */
            .btn,
            .dropdown-item,
            .table-cell-editable {
                min-height: 44px;
            }

            /* Better spacing for mobile */
            .card {
                padding: 1rem;
            }

            .stat-card {
                padding: 1.5rem 1rem;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
            }
        }

        /* Extra small devices */
        @media (max-width: 375px) {
            .nav-bar {
                padding: 0.75rem;
            }

            .btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }

            .stat-value {
                font-size: 1.75rem;
            }

            .chart-container {
                height: 250px;
            }
        }

        /* Utility Classes */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }

        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: calc(var(--space-unit) * 4); }
        .mb-2 { margin-bottom: calc(var(--space-unit) * 8); }
        .mb-3 { margin-bottom: calc(var(--space-unit) * 12); }
        .mb-4 { margin-bottom: calc(var(--space-unit) * 16); }

        .hidden { display: none; }
        .block { display: block; }
        .flex { display: flex; }
        .inline-flex { display: inline-flex; }

        /* Animation utilities */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        .slide-up {
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Smooth scrolling for webkit browsers */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-hover);
        }

        /* Data import/export styles */
        .file-drop-zone {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.05);
        }

        .filter-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .filter-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <nav class="nav-bar glass">
                <div class="brand">
                    <div class="brand-icon">üìä</div>
                    <span>Business Tracker Pro</span>
                </div>
                
                <div class="nav-controls">
                    <button class="btn btn-icon btn-secondary" onclick="toggleTheme()" title="Toggle Theme">
                        üåì
                    </button>
                    
                    <button class="btn btn-icon btn-secondary" onclick="showSettings()" title="Settings">
                        ‚öôÔ∏è
                    </button>
                    
                    <div class="dropdown" id="actionsDropdown">
                        <button class="btn btn-secondary" onclick="toggleDropdown()">
                            üìä Actions
                            <span style="transform: rotate(0deg); transition: transform 0.2s;">‚ñº</span>
                        </button>
                        <div class="dropdown-menu">
                            <a href="#" class="dropdown-item" onclick="exportToExcel()">
                                üì• Export Excel
                            </a>
                            <a href="#" class="dropdown-item" onclick="exportToPDF()">
                                üìÑ Export PDF
                            </a>
                            <a href="#" class="dropdown-item" onclick="importData()">
                                üìÇ Import Data
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" onclick="toggleCalculator()">
                                üî¢ Calculator
                            </a>
                            <a href="#" class="dropdown-item" onclick="generateReport()">
                                üìã Generate Report
                            </a>
                            <a href="#" class="dropdown-item" onclick="showHelp()">
                                ‚ùì Help
                            </a>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="saveData()">
                        üíæ Save
                    </button>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Statistics Overview -->
            <section class="grid grid-4 mb-4">
                <div class="card glass stat-card" onclick="showTooltip(this, 'Total revenue for selected period')">
                    <div class="stat-value" id="totalSales">‚Ç¨0</div>
                    <div class="stat-label">Total Sales</div>
                    <div class="stat-change neutral" id="totalSalesChange">--</div>
                </div>
                
                <div class="card glass stat-card" onclick="showTooltip(this, 'Average monthly sales')">
                    <div class="stat-value" id="avgSales">‚Ç¨0</div>
                    <div class="stat-label">Monthly Average</div>
                    <div class="stat-change neutral" id="avgSalesChange">--</div>
                </div>
                
                <div class="card glass stat-card" onclick="showTooltip(this, 'Best performing month')">
                    <div class="stat-value" id="bestMonth">--</div>
                    <div class="stat-label">Best Month</div>
                    <div class="stat-change neutral" id="bestMonthChange">--</div>
                </div>
                
                <div class="card glass stat-card" onclick="showTooltip(this, 'Growth rate compared to last period')">
                    <div class="stat-value" id="growthRate">0%</div>
                    <div class="stat-label">Growth Rate</div>
                    <div class="stat-change neutral" id="growthRateChange">--</div>
                </div>
            </section>

            <!-- Quick Actions & Filters -->
            <section class="card glass mb-4">
                <div class="card-header">
                    <h2 class="card-title">
                        üéØ Quick Actions
                    </h2>
                </div>
                
                <div class="grid grid-3">
                    <div class="form-group">
                        <label class="form-label" for="yearSelect">Year</label>
                        <select id="yearSelect" class="form-select" onchange="changeYear()">
                            <option value="2023">2023</option>
                            <option value="2024" selected>2024</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="categoryFilter">Filter Category</label>
                        <select id="categoryFilter" class="form-select" onchange="filterTable()">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">&nbsp;</label>
                        <button class="btn btn-success" onclick="quickAddSample()" style="width: 100%;">
                            ‚ö° Add Sample Data
                        </button>
                    </div>
                </div>
            </section>

            <!-- Data Input Section -->
            <section class="card glass mb-4">
                <div class="card-header">
                    <h2 class="card-title">
                        üìù Add Category Data
                    </h2>
                    <button class="btn btn-secondary btn-icon" onclick="clearForm()" title="Clear Form">
                        üóëÔ∏è
                    </button>
                </div>
                
                <div class="grid grid-3">
                    <div class="form-group">
                        <label class="form-label" for="categoryName">Category Name *</label>
                        <input type="text" id="categoryName" class="form-input" placeholder="e.g., Product A, Service B" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="categoryType">Category Type</label>
                        <select id="categoryType" class="form-select">
                            <option value="product">Product</option>
                            <option value="service">Service</option>
                            <option value="subscription">Subscription</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">&nbsp;</label>
                        <button class="btn btn-primary" onclick="addCategory()" style="width: 100%;">
                            ‚ûï Add Category
                        </button>
                    </div>
                </div>
            </section>

            <!-- Data Table -->
            <section class="card glass-strong mb-4">
                <div class="card-header">
                    <h2 class="card-title">
                        üìä Sales Data
                    </h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-icon" onclick="refreshData()" title="Refresh">
                            üîÑ
                        </button>
                        <button class="btn btn-secondary btn-icon" onclick="sortTable()" title="Sort">
                            üì∂
                        </button>
                        <button class="btn btn-secondary btn-icon" onclick="toggleTableView()" title="Toggle View">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
                
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all" onclick="setTableFilter('all')">All</button>
                    <button class="filter-tab" data-filter="product" onclick="setTableFilter('product')">Products</button>
                    <button class="filter-tab" data-filter="service" onclick="setTableFilter('service')">Services</button>
                    <button class="filter-tab" data-filter="subscription" onclick="setTableFilter('subscription')">Subscriptions</button>
                </div>
                
                <div class="table-container">
                    <table class="table" id="salesTable">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Type</th>
                                <th>Jan</th>
                                <th>Feb</th>
                                <th>Mar</th>
                                <th>Apr</th>
                                <th>May</th>
                                <th>Jun</th>
                                <th>Jul</th>
                                <th>Aug</th>
                                <th>Sep</th>
                                <th>Oct</th>
                                <th>Nov</th>
                                <th>Dec</th>
                                <th>Total</th>
                                <th>Avg</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Chart Section -->
            <section class="card glass-strong mb-4">
                <div class="card-header">
                    <h2 class="card-title">
                        üìà Analytics Dashboard
                    </h2>
                    <button class="btn btn-secondary" onclick="fullscreenChart()">
                        üîç Fullscreen
                    </button>
                </div>
                
                <div class="chart-controls">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" for="chartCategory">Category</label>
                        <select id="chartCategory" class="form-input" onchange="updateChart()">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" for="chartPeriod">Period</label>
                        <select id="chartPeriod" class="form-input" onchange="updateChart()">
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    
                    <div class="chart-type-buttons">
                        <button class="chart-type-btn active" data-type="line">üìà Line</button>
                        <button class="chart-type-btn" data-type="bar">üìä Bar</button>
                        <button class="chart-type-btn" data-type="doughnut">üç© Pie</button>
                        <button class="chart-type-btn" data-type="radar">üéØ Radar</button>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-left: auto;">
                        <button class="btn btn-secondary" onclick="generateForecast()">
                            üîÆ Forecast
                        </button>
                        <button class="btn btn-secondary" onclick="compareData()">
                            üìä Compare
                        </button>
                        <button class="btn btn-secondary" onclick="downloadChart()">
                            üì• Download
                        </button>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="salesChart"></canvas>
                    <div class="loading hidden" id="chartLoading"></div>
                </div>
            </section>

            <!-- AI Insights & Analytics -->
            <section class="card glass mb-4">
                <div class="card-header">
                    <h2 class="card-title">
                        üß† AI Insights & Recommendations
                    </h2>
                    <button class="btn btn-secondary" onclick="refreshInsights()">
                        üîÑ Refresh
                    </button>
                </div>
                
                <div class="grid grid-2" id="insightsContainer">
                    <!-- Dynamic insights will be inserted here -->
                </div>
            </section>

            <!-- Performance Metrics -->
            <section class="card glass mb-4">
                <div class="card-header">
                    <h2 class="card-title">
                        üìä Performance Metrics
                    </h2>
                </div>
                
                <div class="grid grid-2">
                    <div>
                        <h4 style="margin-bottom: 1rem;">Monthly Growth Trend</h4>
                        <div id="growthMetrics">
                            <!-- Dynamic growth metrics -->
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 1rem;">Category Performance</h4>
                        <div id="categoryMetrics">
                            <!-- Dynamic category metrics -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification" aria-live="polite"></div>

    <!-- Calculator Modal -->
    <div id="calculatorModal" class="modal">
        <div class="modal-content">
            <div class="card glass-strong">
                <div class="card-header">
                    <h3 class="card-title">üî¢ Advanced Calculator</h3>
                    <button class="btn btn-icon btn-secondary" onclick="toggleCalculator()">‚úï</button>
                </div>
                <div style="padding: 1rem;">
                    <input type="text" id="calcDisplay" class="form-input" value="0" readonly style="text-align: right; font-size: 1.5rem; margin-bottom: 1rem;">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem;">
                        <button class="btn btn-secondary" onclick="clearCalc()">C</button>
                        <button class="btn btn-secondary" onclick="deleteLast()">‚å´</button>
                        <button class="btn btn-secondary" onclick="appendOperator('/')">/</button>
                        <button class="btn btn-secondary" onclick="appendOperator('*')">√ó</button>
                        <button class="btn btn-secondary" onclick="appendNumber('7')">7</button>
                        <button class="btn btn-secondary" onclick="appendNumber('8')">8</button>
                        <button class="btn btn-secondary" onclick="appendNumber('9')">9</button>
                        <button class="btn btn-secondary" onclick="appendOperator('-')">-</button>
                        <button class="btn btn-secondary" onclick="appendNumber('4')">4</button>
                        <button class="btn btn-secondary" onclick="appendNumber('5')">5</button>
                        <button class="btn btn-secondary" onclick="appendNumber('6')">6</button>
                        <button class="btn btn-secondary" onclick="appendOperator('+')">+</button>
                        <button class="btn btn-secondary" onclick="appendNumber('1')">1</button>
                        <button class="btn btn-secondary" onclick="appendNumber('2')">2</button>
                        <button class="btn btn-secondary" onclick="appendNumber('3')">3</button>
                        <button class="btn btn-primary" onclick="calculate()" style="grid-row: span 2;">=</button>
                        <button class="btn btn-secondary" onclick="appendNumber('0')" style="grid-column: span 2;">0</button>
                        <button class="btn btn-secondary" onclick="appendDecimal()">.</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 0.5rem;">
                        <button class="btn btn-secondary" onclick="calculatePercentage()">%</button>
                        <button class="btn btn-secondary" onclick="calculateSquareRoot()">‚àö</button>
                        <button class="btn btn-secondary" onclick="calculatePower()">x¬≤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="card glass-strong">
                <div class="card-header">
                    <h3 class="card-title">üìÇ Import Data</h3>
                    <button class="btn btn-icon btn-secondary" onclick="closeImportModal()">‚úï</button>
                </div>
                <div style="padding: 1rem;">
                    <div class="file-drop-zone" onclick="document.getElementById('fileInput').click()">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üìÅ</div>
                        <p>Click to select file or drag and drop</p>
                        <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                            Supported formats: CSV, JSON, Excel
                        </p>
                        <input type="file" id="fileInput" accept=".csv,.json,.xlsx,.xls" style="display: none;" onchange="handleFileUpload(event)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="card glass-strong">
                <div class="card-header">
                    <h3 class="card-title">‚öôÔ∏è Settings</h3>
                    <button class="btn btn-icon btn-secondary" onclick="closeSettingsModal()">‚úï</button>
                </div>
                <div style="padding: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Currency</label>
                        <select class="form-select" id="currencySelect" onchange="updateCurrency()">
                            <option value="EUR">EUR (‚Ç¨)</option>
                            <option value="USD">USD ($)</option>
                            <option value="GBP">GBP (¬£)</option>
                            <option value="JPY">JPY (¬•)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Language</label>
                        <select class="form-select" id="languageSelect" onchange="updateLanguage()">
                            <option value="en">English</option>
                            <option value="el">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</option>
                            <option value="es">Espa√±ol</option>
                            <option value="fr">Fran√ßais</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Auto-save</label>
                        <input type="checkbox" id="autoSave" checked onchange="toggleAutoSave()" style="margin-left: 0.5rem;">
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                        <button class="btn btn-secondary" onclick="resetSettings()">Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let chart;
        let currentChartType = 'line';
        let salesData = {};
        let selectedYear = 2024;
        let currentCurrency = 'EUR';
        let currentLanguage = 'en';
        let tableFilter = 'all';
        let autoSaveEnabled = true;
        let sortAscending = true;
        
        // Calculator variables
        let calcMemory = 0;
        let calcCurrent = '0';
        let calcOperator = '';
        let calcPrevious = '';
        let calcWaitingForOperand = false;

        // Currency symbols
        const currencySymbols = {
            'EUR': '‚Ç¨',
            'USD': '$',
            'GBP': '¬£',
            'JPY': '¬•'
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            loadSettings();
            renderTable();
            populateDropdowns();
            updateChart();
            calculateStats();
            generateInsights();
            updateMetrics();
            setupEventListeners();
            
            showNotification('Welcome to Business Tracker Pro! üöÄ', 'success');
        });

        // Data initialization
        function initializeData() {
            if (!salesData[selectedYear]) {
                salesData[selectedYear] = {};
            }
        }

        // Settings management
        function loadSettings() {
            const settings = getStoredData('settings');
            if (settings) {
                currentCurrency = settings.currency || 'EUR';
                currentLanguage = settings.language || 'en';
                autoSaveEnabled = settings.autoSave !== false;
                
                document.getElementById('currencySelect').value = currentCurrency;
                document.getElementById('languageSelect').value = currentLanguage;
                document.getElementById('autoSave').checked = autoSaveEnabled;
            }
        }

        function saveSettings() {
            const settings = {
                currency: currentCurrency,
                language: currentLanguage,
                autoSave: autoSaveEnabled
            };
            storeData('settings', settings);
            showNotification('Settings saved successfully!', 'success');
            closeSettingsModal();
        }

        function resetSettings() {
            currentCurrency = 'EUR';
            currentLanguage = 'en';
            autoSaveEnabled = true;
            
            document.getElementById('currencySelect').value = currentCurrency;
            document.getElementById('languageSelect').value = currentLanguage;
            document.getElementById('autoSave').checked = autoSaveEnabled;
            
            showNotification('Settings reset to defaults', 'info');
        }

        // Data storage (simulating localStorage)
        let dataStore = {};

        function storeData(key, data) {
            dataStore[key] = JSON.stringify(data);
        }

        function getStoredData(key) {
            try {
                return JSON.parse(dataStore[key] || 'null');
            } catch {
                return null;
            }
        }

        // Utility functions
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        function showTooltip(element, message) {
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
            showNotification(message, 'info', 2000);
        }

        function formatCurrency(amount) {
            const symbol = currencySymbols[currentCurrency];
            return `${symbol}${amount.toLocaleString()}`;
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showSettings() {
            showModal('settingsModal');
        }

        function closeSettingsModal() {
            hideModal('settingsModal');
        }

        function importData() {
            showModal('importModal');
        }

        function closeImportModal() {
            hideModal('importModal');
        }

        // Dropdown functionality
        function toggleDropdown() {
            const dropdown = document.getElementById('actionsDropdown');
            dropdown.classList.toggle('active');
            
            const arrow = dropdown.querySelector('span');
            if (dropdown.classList.contains('active')) {
                arrow.style.transform = 'rotate(180deg)';
            } else {
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('actionsDropdown');
            if (!dropdown.contains(e.target)) {
                dropdown.classList.remove('active');
                dropdown.querySelector('span').style.transform = 'rotate(0deg)';
            }
        });

        // Theme toggle
        function toggleTheme() {
            document.documentElement.classList.toggle('light-theme');
            showNotification('Theme toggled!', 'info');
        }

        // Data management
        function addCategory() {
            const categoryName = document.getElementById('categoryName').value.trim();
            const categoryType = document.getElementById('categoryType').value;
            
            if (!categoryName) {
                showNotification('Please enter a category name', 'warning');
                document.getElementById('categoryName').focus();
                return;
            }
            
            if (salesData[selectedYear][categoryName]) {
                showNotification('Category already exists', 'error');
                return;
            }
            
            // Add new category with zero values
            salesData[selectedYear][categoryName] = {
                type: categoryType,
                sales: {
                    Jan: 0, Feb: 0, Mar: 0, Apr: 0, May: 0, Jun: 0,
                    Jul: 0, Aug: 0, Sep: 0, Oct: 0, Nov: 0, Dec: 0
                }
            };
            
            clearForm();
            renderTable();
            updateChart();
            populateDropdowns();
            calculateStats();
            generateInsights();
            autoSave();
            
            showNotification(`Category "${categoryName}" added successfully`, 'success');
        }

        function clearForm() {
            document.getElementById('categoryName').value = '';
            document.getElementById('categoryType').value = 'product';
        }

        function quickAddSample() {
            const sampleData = {
                'Electronics': { type: 'product', sales: { Jan: 1200, Feb: 1350, Mar: 1100, Apr: 1480, May: 1650, Jun: 1750, Jul: 1900, Aug: 1820, Sep: 1600, Oct: 1720, Nov: 1850, Dec: 2100 } },
                'Consulting': { type: 'service', sales: { Jan: 800, Feb: 920, Mar: 850, Apr: 1050, May: 1150, Jun: 1200, Jul: 1300, Aug: 1250, Sep: 1100, Oct: 1180, Nov: 1320, Dec: 1450 } },
                'Software License': { type: 'subscription', sales: { Jan: 500, Feb: 550, Mar: 520, Apr: 580, May: 620, Jun: 650, Jul: 700, Aug: 680, Sep: 640, Oct: 720, Nov: 780, Dec: 850 } }
            };

            Object.keys(sampleData).forEach(category => {
                if (!salesData[selectedYear][category]) {
                    salesData[selectedYear][category] = sampleData[category];
                }
            });

            renderTable();
            updateChart();
            populateDropdowns();
            calculateStats();
            generateInsights();
            updateMetrics();
            autoSave();
            
            showNotification('Sample data added successfully!', 'success');
        }

        function changeYear() {
            selectedYear = parseInt(document.getElementById('yearSelect').value);
            initializeData();
            renderTable();
            updateChart();
            calculateStats();
            generateInsights();
            updateMetrics();
            showNotification(`Switched to year ${selectedYear}`, 'info');
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            const categories = Object.keys(salesData[selectedYear] || {});
            const filteredCategories = tableFilter === 'all' ? 
                categories : 
                categories.filter(cat => salesData[selectedYear][cat].type === tableFilter);
            
            if (filteredCategories.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="17" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    No data available. Add some categories to get started! üöÄ
                </td>`;
                tbody.appendChild(row);
                return;
            }
            
            filteredCategories.forEach(category => {
                const row = document.createElement('tr');
                const categoryData = salesData[selectedYear][category];
                const categoryType = categoryData.type || 'other';
                
                let total = 0;
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                
                months.forEach(month => {
                    total += categoryData.sales[month] || 0;
                });
                
                const average = Math.round(total / 12);
                
                let html = `
                    <td class="table-cell-editable" onclick="editCategoryName(this, '${category}')">${category}</td>
                    <td><span style="padding: 0.25rem 0.5rem; background: var(--surface); border-radius: 0.5rem; font-size: 0.75rem;">${categoryType}</span></td>
                `;
                
                months.forEach(month => {
                    const value = categoryData.sales[month] || 0;
                    html += `<td class="table-cell-editable" onclick="editCell(this, '${category}', '${month}')" data-value="${value}">${formatCurrency(value)}</td>`;
                });
                
                html += `
                    <td><strong>${formatCurrency(total)}</strong></td>
                    <td>${formatCurrency(average)}</td>
                    <td>
                        <button class="btn btn-error btn-icon" onclick="deleteCategory('${category}')" style="padding: 0.5rem;" title="Delete">
                            üóëÔ∏è
                        </button>
                    </td>
                `;
                
                row.innerHTML = html;
                tbody.appendChild(row);
            });
        }

        function editCell(cell, category, month) {
            if (cell.querySelector('input')) return;
            
            const currentValue = salesData[selectedYear][category].sales[month] || 0;
            const input = document.createElement('input');
            input.type = 'number';
            input.value = currentValue;
            input.className = 'form-input';
            input.style.cssText = 'width: 100%; margin: 0; font-size: 0.875rem; background: var(--primary); color: white;';
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveCellValue(cell, input, category, month);
                }
                if (e.key === 'Escape') {
                    e.preventDefault();
                    cell.textContent = formatCurrency(currentValue);
                }
            });
            
            input.addEventListener('blur', () => {
                saveCellValue(cell, input, category, month);
            });
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();
        }

        function saveCellValue(cell, input, category, month) {
            const newValue = Math.max(0, parseFloat(input.value) || 0);
            salesData[selectedYear][category].sales[month] = newValue;
            cell.textContent = formatCurrency(newValue);
            cell.setAttribute('data-value', newValue);
            
            renderTable();
            updateChart();
            calculateStats();
            generateInsights();
            updateMetrics();
            autoSave();
            
            showNotification('Value updated successfully', 'success', 1500);
        }

        function editCategoryName(cell, oldName) {
            if (cell.querySelector('input')) return;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = oldName;
            input.className = 'form-input';
            input.style.cssText = 'width: 100%; margin: 0; font-size: 0.875rem; background: var(--primary); color: white;';
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveCategoryName(cell, input, oldName);
                }
                if (e.key === 'Escape') {
                    e.preventDefault();
                    cell.textContent = oldName;
                }
            });
            
            input.addEventListener('blur', () => {
                saveCategoryName(cell, input, oldName);
            });
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();
        }

        function saveCategoryName(cell, input, oldName) {
            const newName = input.value.trim();
            
            if (!newName || newName === oldName) {
                cell.textContent = oldName;
                return;
            }
            
            if (salesData[selectedYear][newName]) {
                showNotification('Category name already exists', 'error');
                cell.textContent = oldName;
                return;
            }
            
            salesData[selectedYear][newName] = salesData[selectedYear][oldName];
            delete salesData[selectedYear][oldName];
            
            cell.textContent = newName;
            
            renderTable();
            updateChart();
            populateDropdowns();
            autoSave();
            
            showNotification(`Category renamed to "${newName}"`, 'success');
        }

        function deleteCategory(category) {
            if (confirm(`Are you sure you want to delete "${category}"? This action cannot be undone.`)) {
                delete salesData[selectedYear][category];
                renderTable();
                updateChart();
                populateDropdowns();
                calculateStats();
                generateInsights();
                updateMetrics();
                autoSave();
                showNotification(`Category "${category}" deleted`, 'success');
            }
        }

        function populateDropdowns() {
            const chartCategory = document.getElementById('chartCategory');
            const categoryFilter = document.getElementById('categoryFilter');
            
            const currentChartValue = chartCategory.value;
            const currentFilterValue = categoryFilter.value;
            
            // Clear and repopulate chart category dropdown
            chartCategory.innerHTML = '<option value="">All Categories</option>';
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            
            Object.keys(salesData[selectedYear] || {}).forEach(category => {
                const chartOption = document.createElement('option');
                chartOption.value = category;
                chartOption.textContent = category;
                chartCategory.appendChild(chartOption);
                
                const filterOption = document.createElement('option');
                filterOption.value = category;
                filterOption.textContent = category;
                categoryFilter.appendChild(filterOption);
            });
            
            chartCategory.value = currentChartValue;
            categoryFilter.value = currentFilterValue;
        }

        // Chart functionality
        function updateChart() {
            const ctx = document.getElementById('salesChart');
            const selectedCategory = document.getElementById('chartCategory').value;
            const chartPeriod = document.getElementById('chartPeriod').value;
            
            if (chart) {
                chart.destroy();
            }
            
            showChartLoading(true);
            
            setTimeout(() => {
                const { labels, datasets } = prepareChartData(selectedCategory, chartPeriod);
                
                chart = new Chart(ctx, {
                    type: currentChartType,
                    data: { labels, datasets },
                    options: getChartOptions()
                });
                
                showChartLoading(false);
            }, 500);
        }

        function prepareChartData(selectedCategory, period) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#a8edea', '#fed6e3'];
            
            let labels = months;
            let datasets = [];
            
            if (period === 'quarterly') {
                labels = ['Q1', 'Q2', 'Q3', 'Q4'];
            } else if (period === 'yearly') {
                labels = [selectedYear.toString()];
            }
            
            if (currentChartType === 'doughnut') {
                const categoryTotals = {};
                Object.keys(salesData[selectedYear] || {}).forEach(cat => {
                    categoryTotals[cat] = months.reduce((sum, month) => {
                        return sum + (salesData[selectedYear][cat].sales[month] || 0);
                    }, 0);
                });
                
                labels = Object.keys(categoryTotals);
                datasets = [{
                    data: Object.values(categoryTotals),
                    backgroundColor: colors.slice(0, labels.length),
                    borderWidth: 2,
                    borderColor: 'rgba(255, 255, 255, 0.1)'
                }];
            } else {
                if (selectedCategory && salesData[selectedYear] && salesData[selectedYear][selectedCategory]) {
                    const data = prepareDataByPeriod(salesData[selectedYear][selectedCategory].sales, period);
                    datasets = [{
                        label: selectedCategory,
                        data: data,
                        borderColor: colors[0],
                        backgroundColor: currentChartType === 'line' ? colors[0] + '20' : colors[0],
                        fill: currentChartType === 'line',
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }];
                } else {
                    datasets = Object.keys(salesData[selectedYear] || {}).map((cat, i) => {
                        const data = prepareDataByPeriod(salesData[selectedYear][cat].sales, period);
                        return {
                            label: cat,
                            data: data,
                            borderColor: colors[i % colors.length],
                            backgroundColor: currentChartType === 'line' ? 
                                colors[i % colors.length] + '20' : colors[i % colors.length],
                            fill: currentChartType === 'line',
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 5,
                            pointHoverRadius: 8
                        };
                    });
                }
            }
            
            return { labels, datasets };
        }

        function prepareDataByPeriod(salesData, period) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            if (period === 'monthly') {
                return months.map(month => salesData[month] || 0);
            } else if (period === 'quarterly') {
                return [
                    (salesData.Jan || 0) + (salesData.Feb || 0) + (salesData.Mar || 0),
                    (salesData.Apr || 0) + (salesData.May || 0) + (salesData.Jun || 0),
                    (salesData.Jul || 0) + (salesData.Aug || 0) + (salesData.Sep || 0),
                    (salesData.Oct || 0) + (salesData.Nov || 0) + (salesData.Dec || 0)
                ];
            } else if (period === 'yearly') {
                return [months.reduce((sum, month) => sum + (salesData[month] || 0), 0)];
            }
            
            return [];
        }

        function getChartOptions() {
            return {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1000,
                    easing: 'easeInOutQuart'
                },
                plugins: {
                    legend: {
                        labels: {
                            color: 'rgba(255, 255, 255, 0.8)',
                            usePointStyle: true,
                            font: { family: 'Inter', weight: '500' }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1,
                        cornerRadius: 8,
                        callbacks: {
                            label: function(context) {
                                const value = context.parsed.y || context.parsed;
                                return `${context.dataset.label}: ${formatCurrency(value)}`;
                            }
                        }
                    }
                },
                scales: currentChartType !== 'doughnut' && currentChartType !== 'radar' ? {
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                    },
                    y: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)',
                            callback: function(value) {
                                return formatCurrency(value);
                            }
                        },
                        beginAtZero: true
                    }
                } : {}
            };
        }

        function showChartLoading(show) {
            const loading = document.getElementById('chartLoading');
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        function calculateStats() {
            const selectedCategory = document.getElementById('chartCategory').value;
            let totalSales = 0;
            let monthlyTotals = [];
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            if (selectedCategory && salesData[selectedYear] && salesData[selectedYear][selectedCategory]) {
                months.forEach(month => {
                    const value = salesData[selectedYear][selectedCategory].sales[month] || 0;
                    totalSales += value;
                    monthlyTotals.push(value);
                });
            } else {
                months.forEach(month => {
                    let monthTotal = 0;
                    Object.keys(salesData[selectedYear] || {}).forEach(cat => {
                        monthTotal += salesData[selectedYear][cat].sales[month] || 0;
                    });
                    totalSales += monthTotal;
                    monthlyTotals.push(monthTotal);
                });
            }
            
            const avgSales = totalSales / 12;
            const bestMonthIndex = monthlyTotals.indexOf(Math.max(...monthlyTotals));
            const bestMonth = monthlyTotals.length > 0 ? months[bestMonthIndex] : '--';
            
            let growthRate = 0;
            if (monthlyTotals.length > 1) {
                const firstHalf = monthlyTotals.slice(0, 6).reduce((a, b) => a + b, 0);
                const secondHalf = monthlyTotals.slice(6).reduce((a, b) => a + b, 0);
                if (firstHalf > 0) {
                    growthRate = ((secondHalf - firstHalf) / firstHalf) * 100;
                }
            }
            
            // Update stats with animation
            animateValue('totalSales', formatCurrency(totalSales));
            animateValue('avgSales', formatCurrency(Math.round(avgSales)));
            animateValue('bestMonth', bestMonth);
            animateValue('growthRate', `${growthRate.toFixed(1)}%`);
            
            // Update change indicators
            updateChangeIndicator('totalSalesChange', growthRate > 5 ? 'positive' : growthRate < -5 ? 'negative' : 'neutral', `${growthRate > 0 ? '+' : ''}${growthRate.toFixed(1)}%`);
            updateChangeIndicator('avgSalesChange', avgSales > 1000 ? 'positive' : 'neutral', avgSales > 1000 ? 'Above target' : 'Below target');
            updateChangeIndicator('bestMonthChange', 'positive', 'Peak performance');
            updateChangeIndicator('growthRateChange', growthRate > 0 ? 'positive' : 'negative', growthRate > 0 ? 'Growing' : 'Declining');
        }

        function animateValue(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.style.transform = 'scale(1.1)';
            setTimeout(() => {
                element.textContent = newValue;
                element.style.transform = 'scale(1)';
            }, 150);
        }

        function updateChangeIndicator(elementId, type, text) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.className = `stat-change ${type}`;
            element.textContent = text;
        }

        // Chart type buttons
        function setupEventListeners() {
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentChartType = btn.dataset.type;
                    updateChart();
                });
            });
            
            // Enter key support for category input
            document.getElementById('categoryName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addCategory();
                }
            });
            
            // File drop zone
            const dropZone = document.querySelector('.file-drop-zone');
            if (dropZone) {
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('dragover');
                });
                
                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('dragover');
                });
                
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileUpload({ target: { files } });
                    }
                });
            }
        }

        // Advanced features
        function generateInsights() {
            const container = document.getElementById('insightsContainer');
            const insights = [];
            
            const totalCategories = Object.keys(salesData[selectedYear] || {}).length;
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            if (totalCategories === 0) {
                insights.push({
                    icon: 'üöÄ',
                    title: 'Get Started',
                    description: 'Add your first category to begin tracking sales data and unlock AI-powered insights.',
                    action: 'Add sample data to explore features'
                });
            } else {
                // Calculate insights based on actual data
                let totalSales = 0;
                let bestCategory = '';
                let bestCategoryTotal = 0;
                let worstPerformingMonth = '';
                let worstMonthTotal = Infinity;
                
                Object.keys(salesData[selectedYear]).forEach(cat => {
                    let categoryTotal = 0;
                    months.forEach(month => {
                        categoryTotal += salesData[selectedYear][cat].sales[month] || 0;
                    });
                    totalSales += categoryTotal;
                    
                    if (categoryTotal > bestCategoryTotal) {
                        bestCategoryTotal = categoryTotal;
                        bestCategory = cat;
                    }
                });
                
                months.forEach(month => {
                    let monthTotal = 0;
                    Object.keys(salesData[selectedYear]).forEach(cat => {
                        monthTotal += salesData[selectedYear][cat].sales[month] || 0;
                    });
                    
                    if (monthTotal < worstMonthTotal) {
                        worstMonthTotal = monthTotal;
                        worstPerformingMonth = month;
                    }
                });
                
                if (bestCategory) {
                    insights.push({
                        icon: 'üèÜ',
                        title: 'Top Performer',
                        description: `${bestCategory} is your best performing category with ${formatCurrency(bestCategoryTotal)} in total sales.`,
                        action: 'Consider expanding this product line'
                    });
                }
                
                if (worstPerformingMonth) {
                    insights.push({
                        icon: 'üìä',
                        title: 'Seasonal Opportunity',
                        description: `${worstPerformingMonth} shows the lowest performance. Consider targeted marketing campaigns during this period.`,
                        action: 'Plan promotional activities'
                    });
                }
                
                const avgMonthlySales = totalSales / 12;
                if (avgMonthlySales > 1000) {
                    insights.push({
                        icon: 'üìà',
                        title: 'Growth Trajectory',
                        description: `Strong average monthly sales of ${formatCurrency(Math.round(avgMonthlySales))}. Consider scaling operations.`,
                        action: 'Explore expansion opportunities'
                    });
                } else {
                    insights.push({
                        icon: 'üéØ',
                        title: 'Growth Potential',
                        description: 'Current performance shows room for improvement. Focus on customer acquisition and retention strategies.',
                        action: 'Implement growth strategies'
                    });
                }
                
                if (totalCategories > 3) {
                    insights.push({
                        icon: 'üîç',
                        title: 'Portfolio Analysis',
                        description: `You have ${totalCategories} categories. Consider analyzing which ones drive the most profit.`,
                        action: 'Review profit margins by category'
                    });
                }
            }
            
            container.innerHTML = insights.map(insight => `
                <div class="insight-item fade-in">
                    <div class="insight-title">
                        ${insight.icon} ${insight.title}
                    </div>
                    <div class="insight-description">
                        ${insight.description}
                    </div>
                    <div class="insight-action">
                        ${insight.action}
                    </div>
                </div>
            `).join('');
        }

        function updateMetrics() {
            const growthContainer = document.getElementById('growthMetrics');
            const categoryContainer = document.getElementById('categoryMetrics');
            
            // Growth metrics
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyTotals = months.map(month => {
                return Object.keys(salesData[selectedYear] || {}).reduce((total, cat) => {
                    return total + (salesData[selectedYear][cat].sales[month] || 0);
                }, 0);
            });
            
            let growthMetricsHTML = '';
            months.forEach((month, i) => {
                if (i > 0) {
                    const currentMonth = monthlyTotals[i];
                    const previousMonth = monthlyTotals[i - 1];
                    const growth = previousMonth > 0 ? ((currentMonth - previousMonth) / previousMonth * 100) : 0;
                    const percentage = Math.max(0, Math.min(100, Math.abs(growth)));
                    
                    growthMetricsHTML += `
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                <span>${month}</span>
                                <span class="${growth >= 0 ? 'stat-change positive' : 'stat-change negative'}" style="margin: 0; padding: 0.125rem 0.25rem;">
                                    ${growth >= 0 ? '+' : ''}${growth.toFixed(1)}%
                                </span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }
            });
            
            growthContainer.innerHTML = growthMetricsHTML || '<p style="color: var(--text-muted);">Add data to see growth metrics</p>';
            
            // Category performance
            const categories = Object.keys(salesData[selectedYear] || {});
            const categoryTotals = categories.map(cat => {
                const total = months.reduce((sum, month) => {
                    return sum + (salesData[selectedYear][cat].sales[month] || 0);
                }, 0);
                return { name: cat, total };
            }).sort((a, b) => b.total - a.total);
            
            const maxTotal = categoryTotals.length > 0 ? categoryTotals[0].total : 1;
            
            let categoryMetricsHTML = '';
            categoryTotals.forEach(category => {
                const percentage = maxTotal > 0 ? (category.total / maxTotal * 100) : 0;
                
                categoryMetricsHTML += `
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span>${category.name}</span>
                            <span style="color: var(--text-secondary);">${formatCurrency(category.total)}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            });
            
            categoryContainer.innerHTML = categoryMetricsHTML || '<p style="color: var(--text-muted);">Add categories to see performance metrics</p>';
        }

        // Table functionality
        function filterTable() {
            const filterValue = document.getElementById('categoryFilter').value;
            tableFilter = filterValue ? filterValue : 'all';
            renderTable();
        }

        function setTableFilter(filter) {
            tableFilter = filter;
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.filter === filter) {
                    tab.classList.add('active');
                }
            });
            renderTable();
        }

        function sortTable() {
            const tbody = document.getElementById('tableBody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                const aTotal = parseInt(a.cells[14]?.textContent.replace(/[^0-9]/g, '') || '0');
                const bTotal = parseInt(b.cells[14]?.textContent.replace(/[^0-9]/g, '') || '0');
                return sortAscending ? aTotal - bTotal : bTotal - aTotal;
            });
            
            rows.forEach(row => tbody.appendChild(row));
            sortAscending = !sortAscending;
            
            showNotification(`Table sorted ${sortAscending ? 'ascending' : 'descending'}`, 'info');
        }

        function toggleTableView() {
            const table = document.getElementById('salesTable');
            table.classList.toggle('compact-view');
            showNotification('Table view toggled', 'info');
        }

        // Export functions
        function exportToExcel() {
            const data = [];
            const headers = ['Category', 'Type', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Total'];
            data.push(headers);
            
            Object.keys(salesData[selectedYear] || {}).forEach(category => {
                const categoryData = salesData[selectedYear][category];
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const total = months.reduce((sum, month) => sum + (categoryData.sales[month] || 0), 0);
                
                const row = [
                    category,
                    categoryData.type || 'other',
                    ...months.map(month => categoryData.sales[month] || 0),
                    total
                ];
                data.push(row);
            });
            
            // Create CSV content
            const csvContent = data.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sales-data-${selectedYear}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Data exported to CSV successfully!', 'success');
        }

        function exportToPDF() {
            showNotification('PDF export feature: Use browser print to PDF for now', 'info');
            window.print();
        }

        function generateReport() {
            const reportData = {
                year: selectedYear,
                totalCategories: Object.keys(salesData[selectedYear] || {}).length,
                totalSales: 0,
                avgMonthlySales: 0,
                bestMonth: '',
                bestCategory: ''
            };
            
            // Calculate report data
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            let bestCategoryTotal = 0;
            let monthlyTotals = [];
            
            Object.keys(salesData[selectedYear] || {}).forEach(cat => {
                let categoryTotal = 0;
                months.forEach(month => {
                    categoryTotal += salesData[selectedYear][cat].sales[month] || 0;
                });
                reportData.totalSales += categoryTotal;
                
                if (categoryTotal > bestCategoryTotal) {
                    bestCategoryTotal = categoryTotal;
                    reportData.bestCategory = cat;
                }
            });
            
            months.forEach(month => {
                let monthTotal = 0;
                Object.keys(salesData[selectedYear] || {}).forEach(cat => {
                    monthTotal += salesData[selectedYear][cat].sales[month] || 0;
                });
                monthlyTotals.push(monthTotal);
            });
            
            reportData.avgMonthlySales = reportData.totalSales / 12;
            const bestMonthIndex = monthlyTotals.indexOf(Math.max(...monthlyTotals));
            reportData.bestMonth = months[bestMonthIndex];
            
            showNotification(`Report generated: ${formatCurrency(reportData.totalSales)} total sales across ${reportData.totalCategories} categories`, 'success', 5000);
        }

        // File handling
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const fileName = file.name.toLowerCase();
            
            if (fileName.endsWith('.csv')) {
                handleCSVUpload(file);
            } else if (fileName.endsWith('.json')) {
                handleJSONUpload(file);
            } else {
                showNotification('Unsupported file format. Please use CSV or JSON.', 'error');
            }
        }

        function handleCSVUpload(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    if (!headers.includes('Category')) {
                        throw new Error('CSV must contain a Category column');
                    }
                    
                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].split(',').map(v => v.trim());
                        if (values.length >= headers.length && values[0]) {
                            const category = values[0];
                            if (!salesData[selectedYear][category]) {
                                salesData[selectedYear][category] = {
                                    type: values[1] || 'other',
                                    sales: {
                                        Jan: 0, Feb: 0, Mar: 0, Apr: 0, May: 0, Jun: 0,
                                        Jul: 0, Aug: 0, Sep: 0, Oct: 0, Nov: 0, Dec: 0
                                    }
                                };
                            }
                            
                            // Map values to months
                            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                            months.forEach((month, index) => {
                                if (headers[index + 2] && values[index + 2]) {
                                    const value = parseFloat(values[index + 2]) || 0;
                                    salesData[selectedYear][category].sales[month] = value;
                                }
                            });
                        }
                    }
                    
                    renderTable();
                    updateChart();
                    populateDropdowns();
                    calculateStats();
                    generateInsights();
                    updateMetrics();
                    autoSave();
                    closeImportModal();
                    
                    showNotification('CSV data imported successfully!', 'success');
                } catch (error) {
                    showNotification(`Error importing CSV: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        function handleJSONUpload(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    if (jsonData[selectedYear]) {
                        Object.keys(jsonData[selectedYear]).forEach(category => {
                            salesData[selectedYear][category] = jsonData[selectedYear][category];
                        });
                    } else if (jsonData.categories) {
                        jsonData.categories.forEach(category => {
                            salesData[selectedYear][category.name] = {
                                type: category.type || 'other',
                                sales: category.sales || {
                                    Jan: 0, Feb: 0, Mar: 0, Apr: 0, May: 0, Jun: 0,
                                    Jul: 0, Aug: 0, Sep: 0, Oct: 0, Nov: 0, Dec: 0
                                }
                            };
                        });
                    }
                    
                    renderTable();
                    updateChart();
                    populateDropdowns();
                    calculateStats();
                    generateInsights();
                    updateMetrics();
                    autoSave();
                    closeImportModal();
                    
                    showNotification('JSON data imported successfully!', 'success');
                } catch (error) {
                    showNotification(`Error importing JSON: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        // Chart advanced functions
        function generateForecast() {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyTotals = months.map(month => {
                return Object.keys(salesData[selectedYear] || {}).reduce((total, cat) => {
                    return total + (salesData[selectedYear][cat].sales[month] || 0);
                }, 0);
            });
            
            // Simple linear regression for forecast
            const validData = monthlyTotals.filter(val => val > 0);
            if (validData.length < 3) {
                showNotification('Need more data points for accurate forecasting', 'warning');
                return;
            }
            
            const avgGrowth = validData.reduce((sum, val, i) => {
                if (i === 0) return 0;
                return sum + ((val - validData[i-1]) / validData[i-1] * 100);
            }, 0) / (validData.length - 1);
            
            const lastValue = validData[validData.length - 1];
            const forecast = Math.round(lastValue * (1 + avgGrowth / 100));
            
            showNotification(`üìà Forecast: Next month predicted sales ${formatCurrency(forecast)} (${avgGrowth.toFixed(1)}% growth trend)`, 'info', 6000);
        }

        function compareData() {
            const currentYear = selectedYear;
            const previousYear = currentYear - 1;
            
            if (!salesData[previousYear]) {
                showNotification('No previous year data available for comparison', 'warning');
                return;
            }
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            let currentTotal = 0;
            let previousTotal = 0;
            
            months.forEach(month => {
                Object.keys(salesData[currentYear] || {}).forEach(cat => {
                    currentTotal += salesData[currentYear][cat].sales[month] || 0;
                });
                
                Object.keys(salesData[previousYear] || {}).forEach(cat => {
                    previousTotal += salesData[previousYear][cat].sales[month] || 0;
                });
            });
            
            const change = previousTotal > 0 ? ((currentTotal - previousTotal) / previousTotal * 100) : 0;
            const changeText = change >= 0 ? `+${change.toFixed(1)}%` : `${change.toFixed(1)}%`;
            
            showNotification(`üìä Year comparison: ${formatCurrency(currentTotal)} vs ${formatCurrency(previousTotal)} (${changeText})`, 'info', 6000);
        }

        function downloadChart() {
            if (chart) {
                const link = document.createElement('a');
                link.download = `sales-chart-${selectedYear}.png`;
                link.href = chart.toBase64Image('image/png', 1.0);
                link.click();
                showNotification('Chart downloaded successfully!', 'success');
            } else {
                showNotification('No chart available to download', 'error');
            }
        }

        function fullscreenChart() {
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer.requestFullscreen) {
                chartContainer.requestFullscreen();
            } else if (chartContainer.webkitRequestFullscreen) {
                chartContainer.webkitRequestFullscreen();
            } else if (chartContainer.msRequestFullscreen) {
                chartContainer.msRequestFullscreen();
            }
            showNotification('Chart in fullscreen mode', 'info');
        }

        // Settings functions
        function updateCurrency() {
            currentCurrency = document.getElementById('currencySelect').value;
            renderTable();
            calculateStats();
            showNotification(`Currency changed to ${currentCurrency}`, 'info');
        }

        function updateLanguage() {
            currentLanguage = document.getElementById('languageSelect').value;
            showNotification(`Language changed to ${currentLanguage}`, 'info');
            // In a real app, this would change the UI language
        }

        function toggleAutoSave() {
            autoSaveEnabled = document.getElementById('autoSave').checked;
            showNotification(`Auto-save ${autoSaveEnabled ? 'enabled' : 'disabled'}`, 'info');
        }

        // Auto-save functionality
        function autoSave() {
            if (autoSaveEnabled) {
                storeData('salesData', salesData);
                storeData('lastSaved', new Date().toISOString());
                
                // Show subtle save indicator
                const brand = document.querySelector('.brand');
                brand.style.opacity = '0.7';
                setTimeout(() => {
                    brand.style.opacity = '1';
                }, 200);
            }
        }

        function saveData() {
            storeData('salesData', salesData);
            storeData('lastSaved', new Date().toISOString());
            showNotification('Data saved successfully!', 'success');
        }

        function refreshData() {
            const savedData = getStoredData('salesData');
            if (savedData) {
                salesData = savedData;
                renderTable();
                updateChart();
                populateDropdowns();
                calculateStats();
                generateInsights();
                updateMetrics();
                showNotification('Data refreshed from saved state', 'success');
            } else {
                showNotification('No saved data found', 'warning');
            }
        }

        function refreshInsights() {
            generateInsights();
            updateMetrics();
            showNotification('AI insights updated', 'success');
        }

        // Calculator functions
        function toggleCalculator() {
            const modal = document.getElementById('calculatorModal');
            if (modal.classList.contains('show')) {
                hideModal('calculatorModal');
            } else {
                showModal('calculatorModal');
                clearCalc();
            }
        }

        function appendNumber(num) {
            const display = document.getElementById('calcDisplay');
            if (calcWaitingForOperand) {
                display.value = num;
                calcWaitingForOperand = false;
            } else {
                display.value = display.value === '0' ? num : display.value + num;
            }
            calcCurrent = display.value;
        }

        function appendDecimal() {
            const display = document.getElementById('calcDisplay');
            if (calcWaitingForOperand) {
                display.value = '0.';
                calcWaitingForOperand = false;
            } else if (display.value.indexOf('.') === -1) {
                display.value += '.';
            }
            calcCurrent = display.value;
        }

        function appendOperator(nextOperator) {
            const display = document.getElementById('calcDisplay');
            const inputValue = parseFloat(display.value);

            if (calcPrevious === '') {
                calcPrevious = inputValue;
            } else if (calcOperator) {
                const currentValue = calcPrevious || 0;
                const newValue = performCalculation(currentValue, inputValue, calcOperator);
                
                display.value = String(newValue);
                calcPrevious = newValue;
            }

            calcWaitingForOperand = true;
            calcOperator = nextOperator;
        }

        function calculate() {
            const display = document.getElementById('calcDisplay');
            const inputValue = parseFloat(display.value);

            if (calcPrevious !== '' && calcOperator && !calcWaitingForOperand) {
                const newValue = performCalculation(calcPrevious, inputValue, calcOperator);
                display.value = String(newValue);
                calcCurrent = String(newValue);
                calcPrevious = '';
                calcOperator = '';
                calcWaitingForOperand = true;
            }
        }

        function performCalculation(firstValue, secondValue, operator) {
            switch (operator) {
                case '+': return firstValue + secondValue;
                case '-': return firstValue - secondValue;
                case '*': return firstValue * secondValue;
                case '/': return secondValue !== 0 ? firstValue / secondValue : 0;
                default: return secondValue;
            }
        }

        function clearCalc() {
            const display = document.getElementById('calcDisplay');
            display.value = '0';
            calcCurrent = '0';
            calcOperator = '';
            calcPrevious = '';
            calcWaitingForOperand = false;
        }

        function deleteLast() {
            const display = document.getElementById('calcDisplay');
            if (display.value.length > 1) {
                display.value = display.value.slice(0, -1);
            } else {
                display.value = '0';
            }
            calcCurrent = display.value;
        }

        function calculatePercentage() {
            const display = document.getElementById('calcDisplay');
            const value = parseFloat(display.value);
            display.value = String(value / 100);
            calcCurrent = display.value;
        }

        function calculateSquareRoot() {
            const display = document.getElementById('calcDisplay');
            const value = parseFloat(display.value);
            if (value >= 0) {
                display.value = String(Math.sqrt(value));
                calcCurrent = display.value;
            } else {
                showNotification('Cannot calculate square root of negative number', 'error');
            }
        }

        function calculatePower() {
            const display = document.getElementById('calcDisplay');
            const value = parseFloat(display.value);
            display.value = String(value * value);
            calcCurrent = display.value;
        }

        // Help and utility functions
        function showHelp() {
            const helpText = `
üöÄ Quick Start Guide:
‚Ä¢ Click "Add Sample Data" to explore features
‚Ä¢ Add categories manually using the form
‚Ä¢ Click on table cells to edit values
‚Ä¢ Use chart controls to visualize data
‚Ä¢ Export data to CSV or generate reports

‚å®Ô∏è Keyboard Shortcuts:
‚Ä¢ Ctrl+N: Focus category input
‚Ä¢ Ctrl+R: Refresh data
‚Ä¢ Ctrl+K: Open calculator
‚Ä¢ Ctrl+S: Save data

üí° Tips:
‚Ä¢ Data auto-saves when enabled
‚Ä¢ Import CSV/JSON files for bulk data
‚Ä¢ Use insights panel for business recommendations
            `;
            
            showNotification(helpText, 'info', 10000);
        }

        // Mobile optimizations
        function isMobile() {
            return window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Touch feedback for mobile
        if (isMobile()) {
            document.body.addEventListener('touchstart', function(e) {
                if (e.target.classList.contains('btn') || e.target.classList.contains('table-cell-editable')) {
                    e.target.style.transform = 'scale(0.95)';
                    
                    // Haptic feedback
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                }
            });

            document.body.addEventListener('touchend', function(e) {
                if (e.target.classList.contains('btn') || e.target.classList.contains('table-cell-editable')) {
                    setTimeout(() => {
                        e.target.style.transform = '';
                    }, 150);
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' && e.target.type !== 'file') return;
            
            if (e.ctrlKey || e.metaKey) {
                switch(e.key.toLowerCase()) {
                    case 'n':
                        e.preventDefault();
                        document.getElementById('categoryName').focus();
                        break;
                    case 'r':
                        e.preventDefault();
                        refreshData();
                        break;
                    case 'k':
                        e.preventDefault();
                        toggleCalculator();
                        break;
                    case 's':
                        e.preventDefault();
                        saveData();
                        break;
                    case 'h':
                        e.preventDefault();
                        showHelp();
                        break;
                }
            }
            
            // Escape key to close modals
            if (e.key === 'Escape') {
                hideModal('calculatorModal');
                hideModal('importModal');
                hideModal('settingsModal');
            }
        });

        // Performance optimization
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                if (chart) {
                    chart.resize();
                }
            }, 250);
        });

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e.error);
            showNotification('An unexpected error occurred. Please refresh the page.', 'error');
        });

        // PWA support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(function(registration) {
                console.log('SW registered', registration);
            }).catch(function(error) {
                console.log('SW registration failed', error);
            });
        }

        // Load saved data on startup
        setTimeout(() => {
            const savedData = getStoredData('salesData');
            if (savedData) {
                salesData = savedData;
                renderTable();
                updateChart();
                populateDropdowns();
                calculateStats();
                generateInsights();
                updateMetrics();
                
                const lastSaved = getStoredData('lastSaved');
                if (lastSaved) {
                    const lastSavedDate = new Date(lastSaved);
                    showNotification(`Loaded data from ${lastSavedDate.toLocaleDateString()}`, 'info');
                }
            }
        }, 1000);
    </script>
</body>
</html>