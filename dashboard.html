<!DOCTYPE html>
<html lang="el">
<head>

    
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
<link rel="apple-touch-icon" sizes="180x180" href="icon-192.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Business Tracker">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Stock Manager Pro - Mobile</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --dark-bg: #2c3e50;
            --light-bg: #ecf0f1;
            --primary-color-rgb: 102, 126, 234;
            --animation-duration: 0.3s;
            --mobile-padding: 15px;
            --desktop-padding: 20px;
        }
        
        /* Mobile Device Optimizations */
        .mobile-device {
            --animation-duration: 0.2s;
            --padding: var(--mobile-padding);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        .mobile-device * {
            scroll-behavior: smooth;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: rgba(0,0,0,0.05);
        }

        /* Enhanced Mobile Tooltip Overlay */
        .mobile-device .stat-card.tooltip-active::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 14999;
            backdrop-filter: blur(2px);
            opacity: 0;
            animation: overlayFadeIn 0.3s ease forwards;
        }

        @keyframes overlayFadeIn {
            to { opacity: 1; }
        }

        /* Improved stat card interaction feedback */
        .mobile-device .stat-card {
            transform-origin: center;
            transition: transform 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .mobile-device .stat-card:active {
            transform: scale(0.98);
        }

        html, body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2c3e50;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ecf0f1;
        }

        /* Top Controls Styling */
        .top-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .top-controls button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            color: #2c3e50;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .top-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 1);
        }

        .top-controls button:active {
            transform: translateY(0px);
        }

        /* Dark mode για τα top controls */
        body.dark-mode .top-controls button {
            background: rgba(52, 73, 94, 0.9);
            color: #ecf0f1;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .top-controls button:hover {
            background: rgba(52, 73, 94, 1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* Mobile responsive για τα top controls */
        @media (max-width: 768px) {
            .top-controls {
                top: 10px;
                right: 10px;
                gap: 6px;
                z-index: 9999; /* Higher z-index to stay above everything */
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 12px;
                padding: 6px;
            }
            
            body.dark-mode .top-controls {
                background: rgba(44, 62, 80, 0.2);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .top-controls button {
                width: 36px;
                height: 36px;
                font-size: 14px;
                /* Better touch targets for mobile */
                min-width: 36px;
                min-height: 36px;
                border-radius: 8px;
            }
            
            /* Ensure top controls don't overlap with user area */
            #userArea {
                margin-top: 60px; /* Add space for top controls */
                padding-top: 15px;
            }
        }

        /* Mobile-first container */
        .container {
            width: 100%;
            max-width: 100vw;
            margin: 0;
            padding: 10px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            min-height: 100vh;
            animation: slideIn 0.8s ease-out;
        }

        body.dark-mode .container {
            background: rgba(44, 62, 80, 0.95);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile header */
        #userArea {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 9998;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            font-weight: 500;
        }

        .user-info img {
            height: 40px;
            width: auto;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .user-info img:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        body.dark-mode .user-info {
            color: #ecf0f1;
        }

        body.dark-mode .user-info img {
            box-shadow: 0 2px 6px rgba(255,255,255,0.1);
        }

        body.dark-mode .user-info img:hover {
            box-shadow: 0 4px 12px rgba(255,255,255,0.2);
        }

        .user-buttons {
            display: grid;
            grid-template-columns: auto 1fr 1fr;
            gap: 10px;
            align-items: center;
        }

        /* Dropdown Container */
        .dropdown-container {
            position: relative;
            display: inline-block;
            z-index: 9999;
        }

        .dropdown-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 18px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 44px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .dropdown-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .dropdown-btn:hover:before {
            left: 100%;
        }

        .dropdown-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.25);
        }

        .dropdown-arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .dropdown-container.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            min-width: 220px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            margin-top: 5px;
            border: 1px solid rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .dropdown-container.active .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            color: #2c3e50;
            border-radius: 8px;
            margin: 4px;
        }

        .dropdown-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            color: #667eea;
            transform: translateX(3px);
        }

        .dropdown-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .dropdown-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.1), transparent);
            margin: 8px 12px;
        }

        /* Dark mode dropdown */
        body.dark-mode .dropdown-menu {
            background: #2c3e50;
            border: 1px solid rgba(255,255,255,0.1);
        }

        body.dark-mode .dropdown-item {
            color: #ecf0f1;
        }

        body.dark-mode .dropdown-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            color: #667eea;
        }

        body.dark-mode .dropdown-divider {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        }

        /* Enhanced header buttons */
        .user-buttons button {
            border: none;
            border-radius: 10px;
            padding: 12px 18px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            touch-action: manipulation;
            min-height: 44px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .user-buttons button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .user-buttons button:hover:before {
            left: 100%;
        }

        .user-buttons button:hover, .user-buttons button:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.25);
        }

        /* Specific colors for each button */
        #exportExcelBtn {
            background: linear-gradient(135deg, #1D6F42 0%, #4CAF50 100%);
        }

        #exportExcelBtn:hover {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%);
        }

        #exportPdfBtn {
            background: linear-gradient(135deg, #B71C1C 0%, #F44336 100%);
        }

        #exportPdfBtn:hover {
            background: linear-gradient(135deg, #F44336 0%, #EF5350 100%);
        }

        #goalsBtn {
            background: linear-gradient(135deg, #FF6F00 0%, #FF9800 100%);
        }

        #goalsBtn:hover {
            background: linear-gradient(135deg, #FF9800 0%, #FFB74D 100%);
        }

        #themeBtn {
            background: linear-gradient(135deg, #7B1FA2 0%, #9C27B0 100%);
        }

        #themeBtn:hover {
            background: linear-gradient(135deg, #9C27B0 0%, #BA68C8 100%);
        }

        #darkModeBtn {
            background: linear-gradient(135deg, #37474F 0%, #607D8B 100%);
        }

        #darkModeBtn:hover {
            background: linear-gradient(135deg, #607D8B 0%, #78909C 100%);
        }

        #languageBtn {
            background: linear-gradient(135deg, #1976D2 0%, #2196F3 100%);
        }

        #languageBtn:hover {
            background: linear-gradient(135deg, #2196F3 0%, #64B5F6 100%);
        }

        #logoutBtn {
            background: linear-gradient(135deg, #D32F2F 0%, #F44336 100%);
        }

        #logoutBtn:hover {
            background: linear-gradient(135deg, #F44336 0%, #E57373 100%);
        }

        /* General button styles (for other buttons not in header) */
        button {
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            touch-action: manipulation;
            min-height: 44px; /* iOS minimum touch target */
        }

        button:hover, button:active {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(103, 126, 234, 0.3);
        }

        body.dark-mode .user-buttons button {
            box-shadow: 0 2px 12px rgba(255,255,255,0.1);
        }

        body.dark-mode .user-buttons button:hover {
            box-shadow: 0 4px 20px rgba(255,255,255,0.2);
        }

        /* Main title */
        h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-mode h2 {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Mobile category input section */
        .category-input-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
        }

        .input-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        input, select {
            flex: 1;
            min-width: 120px;
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 16px;
            padding: 16px 20px;
            font-size: 16px;
            font-weight: 500;
            backdrop-filter: blur(15px);
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-height: 48px; /* Enhanced touch target */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* Enhanced select styling for mobile */
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 20px 20px;
            padding-right: 50px;
            cursor: pointer;
        }

        body.dark-mode select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234facfe' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(103, 126, 234, 0.2), 0 8px 25px rgba(103, 126, 234, 0.15);
            transform: translateY(-2px);
            background: rgba(255,255,255,0.95);
        }

        input:hover, select:hover {
            border-color: rgba(103, 126, 234, 0.6);
            transform: translateY(-1px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.15);
        }

        body.dark-mode input, body.dark-mode select {
            background: rgba(52, 73, 94, 0.9);
            color: #ecf0f1;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        body.dark-mode input:focus, body.dark-mode select:focus {
            border-color: #4facfe;
            box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.2), 0 8px 25px rgba(79, 172, 254, 0.15);
            background: rgba(52, 73, 94, 0.95);
        }

        body.dark-mode input:hover, body.dark-mode select:hover {
            border-color: rgba(79, 172, 254, 0.6);
            box-shadow: 0 6px 18px rgba(0,0,0,0.4);
        }

        /* Enhanced forecast period dropdown */
        #forecastPeriod {
            background: linear-gradient(135deg, rgba(103, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid rgba(103, 126, 234, 0.3);
            font-weight: 600;
            min-height: 52px;
            font-size: 15px;
        }

        #forecastPeriod:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(103, 126, 234, 0.2), 0 8px 25px rgba(103, 126, 234, 0.2);
            background: linear-gradient(135deg, rgba(103, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
        }

        body.dark-mode #forecastPeriod {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
            border: 2px solid rgba(79, 172, 254, 0.3);
        }

        body.dark-mode #forecastPeriod:focus {
            border-color: #4facfe;
            box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.2), 0 8px 25px rgba(79, 172, 254, 0.2);
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.15), rgba(0, 242, 254, 0.15));
        }

        /* Enhanced category dropdown */
        #chartCategory {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,249,250,0.95));
            border: 2px solid rgba(103, 126, 234, 0.2);
            font-weight: 600;
            min-height: 52px;
            font-size: 15px;
        }

        #chartCategory:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(103, 126, 234, 0.15), 0 6px 20px rgba(103, 126, 234, 0.1);
            background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(248,249,250,0.98));
        }

        body.dark-mode #chartCategory {
            background: linear-gradient(135deg, rgba(52, 73, 94, 0.95), rgba(44, 62, 80, 0.95));
            border: 2px solid rgba(79, 172, 254, 0.2);
        }

        body.dark-mode #chartCategory:focus {
            border-color: #4facfe;
            box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.15), 0 6px 20px rgba(79, 172, 254, 0.1);
            background: linear-gradient(135deg, rgba(52, 73, 94, 0.98), rgba(44, 62, 80, 0.98));
        }

        /* Forecast period label styling */
        .chart-select-row label {
            color: #667eea;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
        }

        body.dark-mode .chart-select-row label {
            color: #4facfe;
        }

        .chart-select-row small {
            color: #667eea;
            font-size: 11px;
            font-style: italic;
            font-weight: 500;
            margin-top: 3px;
            display: block;
        }

        body.dark-mode .chart-select-row small {
            color: #4facfe;
        }

        /* Enhanced dropdown options styling */
        select option {
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            background: white;
            color: #2c3e50;
        }

        body.dark-mode select option {
            background: #34495e;
            color: #ecf0f1;
        }

        /* Mobile dropdown container enhancements */
        .chart-select-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 5px;
        }

        .chart-select-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
        }

        /* Dropdown icons and indicators */
        .dropdown-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        body.dark-mode .dropdown-label {
            color: #4facfe;
        }

        /* Enhanced mobile touch areas */
        select:active {
            transform: scale(0.98);
            border-color: #667eea;
        }

        /* Error message */
        #categoryMessage {
            color: #e74c3c;
            font-weight: 500;
            font-size: 14px;
            text-align: center;
            padding: 8px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
            display: none;
        }

        /* Mobile table container */
        .table-container {
            margin-bottom: 20px;
            background: rgba(255,255,255,0.9);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
        }

        body.dark-mode .table-container {
            background: rgba(52, 73, 94, 0.8);
        }

        /* Mobile-optimized table scroll */
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            position: relative;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Scroll indicators for mobile */
        .table-wrapper::before {
            content: "← Σύρετε για περισσότερα";
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(103, 126, 234, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 500;
            z-index: 5;
            pointer-events: none;
            opacity: 0.8;
            animation: fadeInOut 3s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.3; }
        }

        body.dark-mode .table-wrapper::before {
            background: rgba(79, 172, 254, 0.8);
        }

        /* Enhanced table styling for mobile */
        table {
            width: 100%;
            min-width: 800px; /* Increased for better readability */
            border-collapse: collapse;
            font-size: 13px;
        }

        th, td {
            padding: 12px 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            white-space: nowrap;
            position: relative;
        }

        /* Sticky header that works on mobile */
        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        body.dark-mode th {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
        }

        /* Enhanced mobile touch targets */
        td.editable, td.category-name {
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
            touch-action: manipulation;
        }

        td.editable:hover, td.category-name:hover,
        td.editable:active, td.category-name:active {
            background-color: rgba(103, 126, 234, 0.15);
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(103, 126, 234, 0.2);
        }

        body.dark-mode td.editable:hover, 
        body.dark-mode td.category-name:hover,
        body.dark-mode td.editable:active, 
        body.dark-mode td.category-name:active {
            background-color: rgba(79, 172, 254, 0.15);
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.2);
        }

        /* Mobile-friendly edit indicators */
        td.editable::after {
            content: "✏️";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        td.editable:hover::after,
        td.editable:active::after {
            opacity: 0.6;
        }

        td.category-name::after {
            content: "📝";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        td.category-name:hover::after,
        td.category-name:active::after {
            opacity: 0.6;
        }

        /* Better total column styling */
        td:nth-last-child(2) {
            background: rgba(103, 126, 234, 0.05);
            font-weight: 600;
            border-left: 2px solid rgba(103, 126, 234, 0.3);
        }

        body.dark-mode td:nth-last-child(2) {
            background: rgba(79, 172, 254, 0.05);
            border-left: 2px solid rgba(79, 172, 254, 0.3);
        }

        /* Enhanced delete button for mobile */
        .delete-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            min-height: 36px;
            min-width: 36px;
            touch-action: manipulation;
            transition: all 0.2s ease;
        }

        .delete-btn:hover,
        .delete-btn:active {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .delete-btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
        }

        /* Mobile table help text */
        .table-help {
            padding: 10px 15px;
            background: rgba(103, 126, 234, 0.1);
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 11px;
            color: #7f8c8d;
            text-align: center;
            font-style: italic;
        }

        body.dark-mode .table-help {
            background: rgba(79, 172, 254, 0.1);
            color: #bdc3c7;
        }

        /* Enhanced delete button for mobile */


      
.delete-btn {
    background: linear-gradient(45deg, #ff6b6b, #ee5a52);
    border: none;
    color: white;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    min-height: 36px;
    min-width: 36px;
    touch-action: manipulation;
    transition: all 0.2s ease;
}

.delete-btn:hover,
.delete-btn:active {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
}

.delete-btn:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
}

        /* Chart container - mobile optimized */
        .chart-container {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        body.dark-mode .chart-container {
            background: rgba(52, 73, 94, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .chart-header {
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 15px;
        }

        body.dark-mode .chart-title {
            color: #ecf0f1;
        }

        /* Mobile chart controls */
        .chart-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chart-select-row {
            display: flex;
            gap: 8px;
        }

        .chart-buttons-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .chart-type-buttons {
            display: flex;
            background: rgba(103, 126, 234, 0.1);
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
            grid-column: 1 / -1;
        }

        .chart-type-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background: rgba(103, 126, 234, 0.08);
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 12px;
        }

        .chart-type-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 12px rgba(103, 126, 234, 0.5);
        }

        body.dark-mode .chart-type-btn {
            background: rgba(79, 172, 254, 0.08);
            color: #4facfe;
        }

        body.dark-mode .chart-type-btn.active {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: #fff;
        }

        /* Chart wrapper */
        .chart-wrapper {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        /* Stats cards - mobile grid */
        .chart-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        /* Tooltips for stat cards */
        .stat-card {
            background: linear-gradient(135deg, rgba(103, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
            position: relative;
            cursor: help;
            /* Enhanced mobile interaction */
            -webkit-tap-highlight-color: rgba(103, 126, 234, 0.2);
            user-select: none;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        /* Enhanced mobile tap behavior */
        .stat-card:active {
            transform: translateY(-1px) scale(0.98);
        }

        .stat-card::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            line-height: 1.4;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 250px;
            white-space: normal;
            text-align: left;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1001;
            margin-bottom: -6px;
        }

        .stat-card:hover::before,
        .stat-card:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-8px);
        }

        body.dark-mode .stat-card::before {
            background: rgba(255, 255, 255, 0.98);
            color: #2c3e50;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 30px rgba(255, 255, 255, 0.1);
        }

        /* Dark mode mobile tooltips */
        @media (max-width: 768px) {
            body.dark-mode .stat-card::before {
                background: rgba(255, 255, 255, 0.98) !important;
                color: #2c3e50 !important;
                border: 1px solid rgba(255, 255, 255, 0.4) !important;
                box-shadow: 0 8px 30px rgba(255, 255, 255, 0.2) !important;
                backdrop-filter: blur(15px) !important;
            }
        }

        body.dark-mode .stat-card::after {
            border-top-color: rgba(255, 255, 255, 0.95);
        }

        /* Enhanced Mobile Tooltip System */
        @media (max-width: 768px) {
            /* Disable hover tooltips on mobile */
            .stat-card:hover::before,
            .stat-card:hover::after {
                opacity: 0 !important;
                visibility: hidden !important;
            }
            
            /* Mobile-optimized tooltip */
            .stat-card::before {
                position: fixed !important;
                bottom: 80px !important;
                left: 10px !important;
                right: 10px !important;
                transform: none !important;
                max-width: none !important;
                text-align: center !important;
                border-radius: 15px !important;
                font-size: 15px !important;
                padding: 18px 22px !important;
                z-index: 15000 !important;
                background: rgba(0, 0, 0, 0.96) !important;
                backdrop-filter: blur(15px) !important;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
                border: 1px solid rgba(255, 255, 255, 0.15) !important;
                line-height: 1.5 !important;
                font-weight: 600 !important;
                word-break: break-word !important;
                white-space: normal !important;
                opacity: 0 !important;
                visibility: hidden !important;
                transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
            }

            .stat-card::after {
                display: none !important;
            }
            
            /* Mobile touch activation */
            .stat-card.tooltip-active::before {
                opacity: 1 !important;
                visibility: visible !important;
                animation: mobileTooltipShow 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
            }
            
            @keyframes mobileTooltipShow {
                0% { 
                    opacity: 0;
                    transform: translateY(30px) scale(0.8);
                }
                60% {
                    transform: translateY(-5px) scale(1.05);
                }
                100% { 
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }
            
            /* Auto-hide tooltip after 4 seconds on mobile */
            .stat-card.tooltip-active {
                position: relative;
            }
            
            .stat-card.tooltip-active::before {
                animation: mobileTooltipShow 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55),
                           mobileTooltipHide 0.3s ease-in 3.7s forwards !important;
            }
            
            @keyframes mobileTooltipHide {
                0% { 
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
                100% { 
                    opacity: 0;
                    transform: translateY(20px) scale(0.9);
                }
            }
            
            /* Dark mode mobile tooltips */
            body.dark-mode .stat-card::before {
                background: rgba(255, 255, 255, 0.96) !important;
                color: #2c3e50 !important;
                border: 1px solid rgba(255, 255, 255, 0.3) !important;
                box-shadow: 0 10px 40px rgba(255, 255, 255, 0.15) !important;
            }
            
            /* Visual feedback for touched stat cards */
            .stat-card:active {
                transform: scale(0.96) !important;
                background: linear-gradient(135deg, rgba(103, 126, 234, 0.15), rgba(118, 75, 162, 0.15)) !important;
            }
            
            body.dark-mode .stat-card:active {
                background: linear-gradient(135deg, rgba(79, 172, 254, 0.15), rgba(0, 242, 254, 0.15)) !important;
            }
        }

        /* Theme transition effects */
        * {
            transition: background 0.5s ease, color 0.5s ease, border-color 0.5s ease !important;
        }

        body.dark-mode .stat-card {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
            border: 1px solid rgba(255,255,255,0.1);
        }

        .stat-value {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        body.dark-mode .stat-value {
            color: #4facfe;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            font-weight: 500;
        }

        body.dark-mode .stat-label {
            color: #bdc3c7;
        }

        /* Advanced Analytics Panel */
        .analytics-panel {
            margin: 20px 0;
            background: linear-gradient(135deg, rgba(103, 126, 234, 0.08), rgba(118, 75, 162, 0.08));
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(15px);
            overflow: hidden;
        }

        body.dark-mode .analytics-panel {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.08), rgba(0, 242, 254, 0.08));
            border: 1px solid rgba(255,255,255,0.1);
        }

        .analytics-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .analytics-header h3 {
            margin: 0;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            font-weight: 600;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-mode .analytics-header h3 {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .toggle-analytics-btn {
            padding: 8px 16px;
            font-size: 12px;
            background: linear-gradient(45deg, rgba(103, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            color: #667eea;
            border: 1px solid rgba(103, 126, 234, 0.3);
            min-height: 36px;
        }

        .toggle-analytics-btn:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        body.dark-mode .toggle-analytics-btn {
            background: linear-gradient(45deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
            color: #4facfe;
            border: 1px solid rgba(79, 172, 254, 0.3);
        }

        body.dark-mode .toggle-analytics-btn:hover {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
        }

        .analytics-content {
            padding: 20px;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { 
                opacity: 0; 
                transform: translateY(-20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .analytics-card {
            background: rgba(255,255,255,0.7);
            border-radius: 12px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        body.dark-mode .analytics-card {
            background: rgba(52, 73, 94, 0.7);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .analytics-title {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(103, 126, 234, 0.2);
            padding-bottom: 5px;
        }

        body.dark-mode .analytics-title {
            color: #4facfe;
            border-bottom: 1px solid rgba(79, 172, 254, 0.2);
        }

        /* Tooltips for metric rows in analytics */
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: relative;
            cursor: help;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-row::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.3;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            text-align: left;
            white-space: normal;
            margin-bottom: 5px;
        }

        .metric-row:hover::before {
            opacity: 1;
            visibility: visible;
        }

        body.dark-mode .metric-row::before {
            background: rgba(255, 255, 255, 0.95);
            color: #2c3e50;
        }

        /* Mobile metric tooltips */
        @media (max-width: 768px) {
            .metric-row::before {
                position: fixed;
                bottom: 60px;
                left: 20px;
                right: 20px;
                text-align: center;
                border-radius: 8px;
                font-size: 12px;
                padding: 12px 16px;
            }
        }

        .metric-label {
            font-size: 12px;
            color: #7f8c8d;
            font-weight: 500;
        }

        body.dark-mode .metric-label {
            color: #bdc3c7;
        }

        .metric-value {
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
            padding: 2px 8px;
            background: rgba(103, 126, 234, 0.1);
            border-radius: 6px;
        }

        body.dark-mode .metric-value {
            color: #ecf0f1;
            background: rgba(79, 172, 254, 0.1);
        }

        /* Smart Insights Panel */
        .insights-panel {
            margin: 20px 0;
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.08), rgba(39, 174, 96, 0.08));
            border-radius: 20px;
            border: 1px solid rgba(46, 204, 113, 0.2);
            backdrop-filter: blur(15px);
            overflow: hidden;
            animation: slideIn 0.8s ease-out;
        }

        body.dark-mode .insights-panel {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.08), rgba(39, 174, 96, 0.08));
            border: 1px solid rgba(46, 204, 113, 0.15);
        }

        .insights-header {
            padding: 20px;
            border-bottom: 1px solid rgba(46, 204, 113, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .insights-header h3 {
            margin: 0;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            font-weight: 600;
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-insights-btn {
            padding: 8px 16px;
            font-size: 12px;
            background: linear-gradient(45deg, rgba(46, 204, 113, 0.1), rgba(39, 174, 96, 0.1));
            color: #27ae60;
            border: 1px solid rgba(46, 204, 113, 0.3);
            min-height: 36px;
            transition: all 0.3s ease;
        }

        .refresh-insights-btn:hover {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            transform: scale(1.05);
        }

        body.dark-mode .refresh-insights-btn {
            background: linear-gradient(45deg, rgba(46, 204, 113, 0.1), rgba(39, 174, 96, 0.1));
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        body.dark-mode .refresh-insights-btn:hover {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
        }

        .insights-content {
            padding: 20px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .insight-item {
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid #2ecc71;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .insight-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.15);
        }

        body.dark-mode .insight-item {
            background: rgba(52, 73, 94, 0.8);
            border-left: 4px solid #2ecc71;
        }

        .insight-icon {
            display: inline-block;
            font-size: 20px;
            margin-right: 10px;
            vertical-align: middle;
        }

        .insight-title {
            font-size: 14px;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.dark-mode .insight-title {
            color: #2ecc71;
        }

        .insight-description {
            font-size: 13px;
            color: #2c3e50;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        body.dark-mode .insight-description {
            color: #ecf0f1;
        }

        .insight-action {
            font-size: 12px;
            color: #27ae60;
            font-weight: 500;
            font-style: italic;
            padding: 5px 10px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 6px;
            margin-top: 8px;
            display: inline-block;
        }

        body.dark-mode .insight-action {
            color: #2ecc71;
            background: rgba(46, 204, 113, 0.15);
        }

        /* Priority indicators */
        .insight-item.high-priority {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.05), rgba(255,255,255,0.8));
        }

        .insight-item.medium-priority {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.05), rgba(255,255,255,0.8));
        }

        .insight-item.low-priority {
            border-left-color: #3498db;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.05), rgba(255,255,255,0.8));
        }

        body.dark-mode .insight-item.high-priority {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.05), rgba(52, 73, 94, 0.8));
        }

        body.dark-mode .insight-item.medium-priority {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.05), rgba(52, 73, 94, 0.8));
        }

        body.dark-mode .insight-item.low-priority {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.05), rgba(52, 73, 94, 0.8));
        }

        .priority-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-badge.high {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .priority-badge.medium {
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
        }

        .priority-badge.low {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        /* Insights loading animation */
        .insights-loading {
            text-align: center;
            padding: 30px;
            color: #27ae60;
        }

        .insights-loading .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(46, 204, 113, 0.3);
            border-top: 3px solid #2ecc71;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        /* Loading spinner */
        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(103, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification System - Exact subscription styling positioned left with fade animation */
        .notification {
            position: fixed;
            top: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            color: #333;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow:
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55), visibility 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 350px;
            min-width: 300px;
        }

        .notification.show {
            opacity: 1;
            visibility: visible;
        }

        .notification.success {
            border-left: 4px solid #2ecc71;
        }

        .notification.error {
            border-left: 4px solid #e74c3c;
        }

        .notification.warning {
            border-left: 4px solid #f39c12;
        }

        .notification.info {
            border-left: 4px solid #3498db;
        }

        .notification .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification .notification-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .notification .notification-text {
            flex: 1;
            font-weight: 600;
            font-size: 14px;
            line-height: 1.4;
        }

        /* Dark mode notifications - exact subscription styling */
        body.dark-mode .notification {
            background: rgba(44, 62, 80, 0.95);
            color: #ecf0f1;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Enhanced Mobile Design - Beautiful & Functional */
        @media (max-width: 768px) {
            /* Mobile notifications - positioned at top */
            .notification {
                top: 70px; /* Below the top controls */
                left: 10px;
                right: 10px;
                bottom: auto;
                width: auto;
                border-radius: 12px;
                padding: 12px;
                max-width: none;
                min-width: auto;
                z-index: 9997; /* Below top controls but above content */
            }
            
            .notification-content {
                padding: 8px;
            }
            
            .notification-text {
                font-size: 13px;
                margin: 0 10px;
            }
            
            /* Base mobile layout improvements */
            body {
                font-size: 14px;
                line-height: 1.5;
                -webkit-text-size-adjust: 100%;
                touch-action: manipulation;
                overflow-x: hidden;
            }
            
            .container {
                padding: 5px;
                margin: 0;
                border-radius: 0;
                background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(248,250,252,0.95) 100%);
                backdrop-filter: blur(20px);
                min-height: 100vh;
            }
            
            body.dark-mode .container {
                background: linear-gradient(135deg, rgba(44, 62, 80, 0.98) 0%, rgba(52, 73, 94, 0.95) 100%);
            }
            
            /* Enhanced user area with glass-morphism */
            #userArea {
                background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
                backdrop-filter: blur(15px);
                border: 1px solid rgba(255,255,255,0.2);
                border-radius: 20px;
                margin: 10px 8px 15px 8px;
                padding: 15px 18px;
                box-shadow: 
                    0 8px 25px rgba(0,0,0,0.1),
                    inset 0 1px 0 rgba(255,255,255,0.3);
                position: relative;
                margin-top: 65px;
                overflow: hidden;
            }
            
            #userArea::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 2px;
                background: linear-gradient(90deg, #667eea, #764ba2, #ff6b6b, #4ecdc4);
                background-size: 300% 100%;
                animation: borderGlow 3s ease infinite;
            }
            
            @keyframes borderGlow {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            body.dark-mode #userArea {
                background: linear-gradient(135deg, rgba(52, 73, 94, 0.2) 0%, rgba(44, 62, 80, 0.1) 100%);
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            /* Beautiful user info section */
            .user-info {
                display: flex;
                align-items: center;
                gap: 12px;
                flex: 1;
                min-width: 0;
                margin-bottom: 0 !important;
            }
            
            .user-info img {
                width: 36px !important;
                height: 36px !important;
                border-radius: 12px;
                box-shadow: 
                    0 4px 12px rgba(102, 126, 234, 0.3),
                    0 2px 6px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
            }
            
            .user-info img:active {
                transform: scale(0.95);
            }
            
            .user-info span {
                font-size: 14px !important;
                font-weight: 600;
                color: #2c3e50;
                background: linear-gradient(135deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            body.dark-mode .user-info span {
                background: linear-gradient(135deg, #74b9ff, #a29bfe);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            /* Enhanced mobile buttons */
            .user-buttons {
                display: flex;
                flex-direction: row;
                align-items: center;
                gap: 6px;
                justify-content: flex-end;
                flex-wrap: nowrap;
                flex-shrink: 0;
                max-width: 55%;
            }
            
            .user-buttons button {
                padding: 10px 12px !important;
                font-size: 12px !important;
                min-height: 38px !important;
                border-radius: 12px !important;
                flex: none;
                white-space: nowrap;
                max-width: 85px;
                text-overflow: ellipsis;
                overflow: hidden;
                background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255,255,255,0.2);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                position: relative;
                overflow: hidden;
            }
            
            .user-buttons button::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.5s ease;
            }
            
            .user-buttons button:active {
                transform: scale(0.95);
                box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            }
            
            .user-buttons button:active::before {
                left: 100%;
            }
            
            /* Enhanced dropdown button */
            .dropdown-btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                color: white !important;
                border: none !important;
                padding: 10px 14px !important;
                font-size: 12px !important;
                min-height: 38px !important;
                border-radius: 12px !important;
                box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
                gap: 6px !important;
                min-width: 90px !important;
                max-width: 95px !important;
                justify-content: center !important;
                text-align: center !important;
                font-weight: 600;
            }
            
            body.dark-mode .dropdown-btn {
                background: linear-gradient(135deg, #3498db 0%, #9b59b6 100%) !important;
                box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
            }
            
            .dropdown-arrow {
                font-size: 10px !important;
                margin-left: 4px;
                transition: transform 0.3s ease;
            }
            
            .dropdown-btn.active .dropdown-arrow {
                transform: rotate(180deg);
            }
            
            /* Enhanced logout button */
            #logoutBtn {
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%) !important;
                color: white !important;
                border: none !important;
                padding: 10px 12px !important;
                font-size: 12px !important;
                min-height: 38px !important;
                max-width: 70px !important;
                box-shadow: 0 6px 15px rgba(231, 76, 60, 0.3);
                font-weight: 600;
            }
            
            #logoutBtn:active {
                background: linear-gradient(135deg, #c0392b 0%, #a93226 100%) !important;
            }
            /* Beautiful mobile title */
            h2 {
                text-align: center;
                margin: 20px 0;
                font-size: 24px;
                font-weight: 700;
                background: linear-gradient(135deg, #667eea, #764ba2, #ff6b6b);
                background-size: 200% 100%;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                animation: titleGradient 3s ease infinite;
                padding: 0 20px;
            }
            
            @keyframes titleGradient {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            /* Enhanced category input section */
            .category-input-section {
                background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
                backdrop-filter: blur(15px);
                border: 1px solid rgba(255,255,255,0.2);
                border-radius: 20px;
                margin: 15px 8px;
                padding: 20px 18px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.1);
                position: relative;
                overflow: hidden;
            }
            
            .category-input-section::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 2px;
                background: linear-gradient(90deg, #2ecc71, #27ae60, #16a085);
                background-size: 300% 100%;
                animation: inputBorderGlow 3s ease infinite;
            }
            
            @keyframes inputBorderGlow {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            body.dark-mode .category-input-section {
                background: linear-gradient(135deg, rgba(52, 73, 94, 0.2) 0%, rgba(44, 62, 80, 0.1) 100%);
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            .input-row {
                display: flex;
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            /* Beautiful mobile inputs */
            input[type="text"], select {
                font-size: 16px !important; /* Prevents zoom on iOS */
                padding: 15px 18px;
                border-radius: 15px;
                min-height: 50px;
                border: 2px solid rgba(102, 126, 234, 0.2);
                background: rgba(255,255,255,0.9);
                backdrop-filter: blur(10px);
                box-shadow: 
                    0 4px 12px rgba(0,0,0,0.1),
                    inset 0 1px 0 rgba(255,255,255,0.8);
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                box-sizing: border-box;
                width: 100%;
            }
            
            input[type="text"]:focus, select:focus {
                border-color: #667eea;
                box-shadow: 
                    0 8px 20px rgba(102, 126, 234, 0.2),
                    0 0 0 4px rgba(102, 126, 234, 0.1),
                    inset 0 1px 0 rgba(255,255,255,0.8);
                transform: translateY(-2px);
                outline: none;
            }
            
            body.dark-mode input[type="text"], 
            body.dark-mode select {
                background: rgba(52, 73, 94, 0.8);
                border-color: rgba(255,255,255,0.2);
                color: #ecf0f1;
            }
            
            body.dark-mode input[type="text"]:focus,
            body.dark-mode select:focus {
                border-color: #3498db;
                box-shadow: 
                    0 8px 20px rgba(52, 152, 219, 0.2),
                    0 0 0 4px rgba(52, 152, 219, 0.1);
            }
            
            /* Enhanced add button */
            #addCategoryBtn {
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%) !important;
                color: white !important;
                border: none !important;
                padding: 15px 20px;
                border-radius: 15px;
                font-size: 16px;
                font-weight: 700;
                min-height: 50px;
                box-shadow: 
                    0 8px 20px rgba(46, 204, 113, 0.3),
                    0 4px 10px rgba(0,0,0,0.1);
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                position: relative;
                overflow: hidden;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            #addCategoryBtn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.5s ease;
            }
            
            #addCategoryBtn:active {
                transform: scale(0.98);
                box-shadow: 
                    0 4px 12px rgba(46, 204, 113, 0.4),
                    0 2px 6px rgba(0,0,0,0.15);
            }
            
            #addCategoryBtn:active::before {
                left: 100%;
            }
            
            /* Enhanced table mobile experience */
            .table-container {
                margin: 15px 8px;
                border-radius: 20px;
                overflow: hidden;
                box-shadow: 
                    0 8px 25px rgba(0,0,0,0.1),
                    0 4px 12px rgba(102, 126, 234, 0.1);
                background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255,255,255,0.3);
                position: relative;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .table-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, #667eea, #764ba2, #ff6b6b, #4ecdc4);
                background-size: 300% 100%;
                animation: tableGlow 4s ease infinite;
            }
            
            @keyframes tableGlow {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            body.dark-mode .table-container {
                background: linear-gradient(135deg, rgba(52, 73, 94, 0.95) 0%, rgba(44, 62, 80, 0.9) 100%);
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            .table-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 5px;
            }
            
            table {
                font-size: 14px;
                width: 100%;
                min-width: 600px; /* Ensure horizontal scroll when needed */
            }
            
            th {
                padding: 15px 10px;
                font-size: 13px;
                font-weight: 700;
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
                color: #2c3e50;
                position: sticky;
                top: 0;
                z-index: 10;
            }
            
            body.dark-mode th {
                background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%);
                color: #ecf0f1;
            }
            
            td {
                padding: 12px 10px;
                min-width: 70px;
                border-bottom: 1px solid rgba(102, 126, 234, 0.1);
                transition: all 0.3s ease;
            }
            
            /* Enhanced editable cells */
            td.editable, td.category-name {
                position: relative;
                overflow: hidden;
                cursor: pointer;
                background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, rgba(248,250,252,0.3) 100%);
                border-radius: 8px;
                margin: 2px;
            }
            
            td.editable:active, td.category-name:active {
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
                transform: scale(0.98);
            }
            
            body.dark-mode td.editable, 
            body.dark-mode td.category-name {
                background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%);
            }
            
            /* Mobile chart container */
            .chart-container {
                margin: 15px 8px;
                padding: 20px 15px;
                border-radius: 20px;
                background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255,255,255,0.3);
                box-shadow: 
                    0 12px 30px rgba(0,0,0,0.1),
                    0 8px 20px rgba(102, 126, 234, 0.1);
                position: relative;
                overflow: hidden;
            }
            
            .chart-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
                background-size: 300% 100%;
                animation: chartGlow 4s ease infinite;
            }
            
            @keyframes chartGlow {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            body.dark-mode .chart-container {
                background: linear-gradient(135deg, rgba(52, 73, 94, 0.95) 0%, rgba(44, 62, 80, 0.9) 100%);
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            .chart-header {
                margin-bottom: 20px;
            }
            
            .chart-title {
                font-size: 18px;
                font-weight: 700;
                text-align: center;
                margin-bottom: 15px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            body.dark-mode .chart-title {
                background: linear-gradient(135deg, #74b9ff, #a29bfe);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            /* Enhanced chart controls for mobile */
            .chart-controls {
                margin-bottom: 20px;
            }
            
            .chart-select-row {
                display: flex;
                flex-direction: column;
                gap: 12px;
                margin-bottom: 15px;
            }
            
            .chart-select-container {
                flex: 1;
            }
            
            .dropdown-label {
                font-size: 13px;
                font-weight: 600;
                margin-bottom: 8px;
                color: #2c3e50;
                display: block;
            }
            
            body.dark-mode .dropdown-label {
                color: #ecf0f1;
            }
            
            #forecastPeriod, #chartCategory {
                width: 100%;
                font-size: 14px;
                padding: 12px 15px;
                border-radius: 12px;
                border: 2px solid rgba(102, 126, 234, 0.2);
                background: rgba(255,255,255,0.9);
                backdrop-filter: blur(10px);
                min-height: 44px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
            }
            
            #forecastPeriod:focus, #chartCategory:focus {
                border-color: #667eea;
                box-shadow: 
                    0 8px 20px rgba(102, 126, 234, 0.2),
                    0 0 0 4px rgba(102, 126, 234, 0.1);
                outline: none;
            }
            
            body.dark-mode #forecastPeriod,
            body.dark-mode #chartCategory {
                background: rgba(52, 73, 94, 0.8);
                border-color: rgba(255,255,255,0.2);
                color: #ecf0f1;
            }
            
            /* Enhanced chart buttons */
            .chart-buttons-row {
                display: flex;
                flex-direction: column;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .chart-buttons-row button {
                padding: 14px 18px;
                border-radius: 12px;
                font-size: 14px;
                font-weight: 600;
                min-height: 48px;
                border: none;
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
                backdrop-filter: blur(10px);
                color: #2c3e50;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                position: relative;
                overflow: hidden;
            }
            
            .chart-buttons-row button::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.2), transparent);
                transition: left 0.5s ease;
            }
            
            .chart-buttons-row button:active {
                transform: scale(0.98);
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            }
            
            .chart-buttons-row button:active::before {
                left: 100%;
            }
            
            body.dark-mode .chart-buttons-row button {
                background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%);
                color: #ecf0f1;
            }
            
            /* Enhanced chart type buttons */
            .chart-type-buttons {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
                margin-bottom: 15px;
            }
            
            .chart-type-btn {
                padding: 12px 8px !important;
                font-size: 12px !important;
                text-align: center;
                min-height: 44px;
                touch-action: manipulation;
                border-radius: 12px;
                background: rgba(255,255,255,0.5);
                backdrop-filter: blur(10px);
                border: 2px solid rgba(102, 126, 234, 0.2);
                color: #2c3e50;
                font-weight: 600;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }
            
            .chart-type-btn.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-color: transparent;
                box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
            }
            
            .chart-type-btn:active {
                transform: scale(0.95);
            }
            
            body.dark-mode .chart-type-btn {
                background: rgba(52, 73, 94, 0.5);
                border-color: rgba(255,255,255,0.2);
                color: #ecf0f1;
            }
            
            body.dark-mode .chart-type-btn.active {
                background: linear-gradient(135deg, #3498db 0%, #9b59b6 100%);
                box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
            }
            
            /* Enhanced mobile stats */
            .chart-stats {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin: 20px 0;
            }
            
            .stat-card {
                padding: 15px 12px;
                border-radius: 15px;
                min-height: auto;
                background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,250,252,0.6) 100%);
                backdrop-filter: blur(15px);
                border: 1px solid rgba(255,255,255,0.3);
                box-shadow: 
                    0 6px 18px rgba(0,0,0,0.1),
                    inset 0 1px 0 rgba(255,255,255,0.5);
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                position: relative;
                overflow: hidden;
                text-align: center;
            }
            
            .stat-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 2px;
                background: linear-gradient(90deg, #667eea, #764ba2, #ff6b6b);
                background-size: 200% 100%;
                animation: statGlow 3s ease infinite;
            }
            
            @keyframes statGlow {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            .stat-card:active {
                transform: scale(0.98);
                box-shadow: 
                    0 4px 12px rgba(0,0,0,0.15),
                    inset 0 1px 0 rgba(255,255,255,0.5);
            }
            
            body.dark-mode .stat-card {
                background: linear-gradient(135deg, rgba(52, 73, 94, 0.8) 0%, rgba(44, 62, 80, 0.6) 100%);
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            .stat-value {
                font-size: 20px;
                font-weight: 800;
                background: linear-gradient(135deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 6px;
                display: block;
            }
            
            body.dark-mode .stat-value {
                background: linear-gradient(135deg, #74b9ff, #a29bfe);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            .stat-label {
                font-size: 11px;
                font-weight: 600;
                color: #7f8c8d;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                line-height: 1.3;
            }
            
            body.dark-mode .stat-label {
                color: #bdc3c7;
            }
            
            /* Enhanced mobile panels */
            .analytics-panel, .insights-panel, .goals-panel, .theme-panel {
                margin: 15px 8px;
                border-radius: 20px;
                background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255,255,255,0.3);
                box-shadow: 
                    0 12px 30px rgba(0,0,0,0.1),
                    0 8px 20px rgba(102, 126, 234, 0.1);
                overflow: hidden;
                position: relative;
            }
            
            .analytics-panel::before, .insights-panel::before, 
            .goals-panel::before, .theme-panel::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, #e74c3c, #f39c12, #f1c40f, #2ecc71);
                background-size: 300% 100%;
                animation: panelGlow 4s ease infinite;
            }
            
            @keyframes panelGlow {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            body.dark-mode .analytics-panel, 
            body.dark-mode .insights-panel,
            body.dark-mode .goals-panel,
            body.dark-mode .theme-panel {
                background: linear-gradient(135deg, rgba(52, 73, 94, 0.95) 0%, rgba(44, 62, 80, 0.9) 100%);
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            .panel-header, .analytics-header, .insights-header, 
            .goals-header, .theme-header {
                padding: 18px 20px;
                border-radius: 20px 20px 0 0;
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
                border-bottom: 1px solid rgba(255,255,255,0.2);
            }
            
            body.dark-mode .panel-header,
            body.dark-mode .analytics-header,
            body.dark-mode .insights-header,
            body.dark-mode .goals-header,
            body.dark-mode .theme-header {
                background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%);
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }
            
            .panel-content, .analytics-content, .insights-content,
            .goals-content, .theme-content {
                padding: 18px 20px;
            }
            
            /* Enhanced mobile dropdown */
            .dropdown-menu {
                min-width: 280px;
                right: 0;
                left: auto;
                max-width: 90vw;
                max-height: 70vh;
                overflow-y: auto;
                border-radius: 20px;
                background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(248,250,252,0.95) 100%);
                backdrop-filter: blur(25px);
                border: 1px solid rgba(255,255,255,0.3);
                box-shadow: 
                    0 20px 40px rgba(0,0,0,0.2),
                    0 10px 20px rgba(102, 126, 234, 0.1);
                padding: 8px;
                -webkit-overflow-scrolling: touch;
            }
            
            body.dark-mode .dropdown-menu {
                background: linear-gradient(135deg, rgba(52, 73, 94, 0.98) 0%, rgba(44, 62, 80, 0.95) 100%);
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            .dropdown-item {
                padding: 16px 18px;
                font-size: 15px;
                min-height: 52px;
                border-radius: 15px;
                margin: 4px 0;
                background: rgba(255,255,255,0.3);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255,255,255,0.2);
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                display: flex;
                align-items: center;
                gap: 12px;
                position: relative;
                overflow: hidden;
                font-weight: 600;
                color: #2c3e50;
            }
            
            .dropdown-item::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.15), transparent);
                transition: left 0.4s ease;
            }
            
            .dropdown-item:active {
                transform: scale(0.98);
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            }
            
            .dropdown-item:active::before {
                left: 100%;
            }
            
            body.dark-mode .dropdown-item {
                background: rgba(52, 73, 94, 0.5);
                border: 1px solid rgba(255,255,255,0.1);
                color: #ecf0f1;
            }
            
            body.dark-mode .dropdown-item:active {
                background: linear-gradient(135deg, rgba(52, 152, 219, 0.2) 0%, rgba(155, 89, 182, 0.2) 100%);
            }
            
            .dropdown-icon {
                font-size: 20px;
                width: 28px;
                text-align: center;
                flex-shrink: 0;
            }
            
            /* Enhanced calculator widget for mobile */
            .calculator-widget {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90vw;
                max-width: 320px;
                background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(248,250,252,0.95) 100%);
                backdrop-filter: blur(25px);
                border: 1px solid rgba(255,255,255,0.3);
                border-radius: 25px;
                box-shadow: 
                    0 25px 50px rgba(0,0,0,0.2),
                    0 15px 30px rgba(102, 126, 234, 0.1);
                z-index: 10000;
                overflow: hidden;
            }
            
            .calculator-widget::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, #667eea, #764ba2, #ff6b6b, #4ecdc4);
                background-size: 300% 100%;
                animation: calcGlow 3s ease infinite;
            }
            
            @keyframes calcGlow {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            body.dark-mode .calculator-widget {
                background: linear-gradient(135deg, rgba(52, 73, 94, 0.98) 0%, rgba(44, 62, 80, 0.95) 100%);
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            /* Hide keyboard shortcuts on mobile */
            .shortcuts-mobile-hide {
                display: none !important;
            }
            
            /* Enhanced floating subscription button */
            #floatingSubscription {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 56px;
                height: 56px;
                border-radius: 28px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                font-size: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 
                    0 12px 25px rgba(102, 126, 234, 0.3),
                    0 6px 15px rgba(0,0,0,0.2);
                z-index: 9996;
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                animation: floatBounce 3s ease-in-out infinite;
                cursor: pointer;
            }
            
            @keyframes floatBounce {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-8px); }
            }
            
            #floatingSubscription:active {
                transform: scale(0.9);
                box-shadow: 
                    0 8px 18px rgba(102, 126, 234, 0.4),
                    0 4px 10px rgba(0,0,0,0.25);
            }
            
            body.dark-mode #floatingSubscription {
                background: linear-gradient(135deg, #3498db 0%, #9b59b6 100%);
                box-shadow: 
                    0 12px 25px rgba(52, 152, 219, 0.3),
                    0 6px 15px rgba(0,0,0,0.3);
            }
            
            /* Mobile gesture improvements */
            .chart-container {
                touch-action: pan-y pinch-zoom;
            }
            
            /* Smooth scrolling improvements */
            .table-wrapper, .dropdown-menu {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
            
            /* Loading states for mobile */
            .loading-spinner {
                width: 40px;
                height: 40px;
                border: 3px solid rgba(102, 126, 234, 0.2);
                border-top: 3px solid #667eea;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 20px auto;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        }
            
            /* Mobile user area layout */
            #userArea {
                flex-direction: row !important;
                justify-content: space-between !important;
                align-items: center !important;
                gap: 8px !important;
                padding: 12px 15px !important;
                margin-top: 60px !important; /* Space for top controls */
                position: relative;
                z-index: 9998; /* Below top controls */
            }
            
            .user-info {
                flex: 1;
                min-width: 0; /* Allow text overflow */
                margin-bottom: 0 !important;
            }
            
            .user-info span {
                font-size: 13px !important;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            /* Mobile logo size */
            .user-info img {
                width: 32px !important;
                height: 32px !important;
            }
            
            .user-buttons {
                display: flex;
                flex-direction: row;
                align-items: center;
                gap: 6px;
                justify-content: flex-end;
                flex-wrap: nowrap;
                flex-shrink: 0;
                max-width: 60%; /* Limit width to prevent overflow */
            }
            
            /* Mobile button text optimizations */
            #darkModeBtn {
                font-size: 14px !important; /* Keep emoji readable */
            }
            
            #logoutBtn {
                padding: 10px 10px !important; /* Slightly smaller padding for "Έξοδος" */
            }
            
            .dropdown-btn {
                min-width: 100px; /* Ensure enough space for text */
                max-width: 110px; /* Allow more space for Greek text */
                overflow: visible; /* Don't cut off text */
                text-overflow: unset; /* Remove text cutting */
                justify-content: center !important;
                text-align: center !important;
                white-space: nowrap !important; /* Keep text on one line */
                flex-shrink: 0; /* Don't shrink the button */
            }
            
            /* Enhanced table mobile experience */
            .table-container {
                margin: 10px 0;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }
            
            table {
                font-size: 13px;
            }
            
            th, td {
                padding: 10px 6px;
                min-width: 60px;
            }
            
            /* Improved chart controls for mobile */
            .chart-type-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                margin-bottom: 15px;
            }
            
            .chart-type-btn {
                padding: 12px 8px !important;
                font-size: 12px !important;
                text-align: center;
                min-height: 44px;
                touch-action: manipulation;
            }
            
            /* Chart container mobile optimization */
            .chart-container {
                margin: 15px 0;
                padding: 15px;
                border-radius: 12px;
                background: rgba(255,255,255,0.95);
                backdrop-filter: blur(10px);
            }
            
            /* Stats panels mobile layout */
            .stats-container {
                grid-template-columns: 1fr !important;
                gap: 10px;
            }
            
            .stat-card {
                padding: 12px 15px;
                border-radius: 12px;
                min-height: auto;
            }
            
            .stat-label {
                font-size: 12px;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            .dropdown-menu {
                min-width: 250px;
                right: 0;
                left: auto;
                max-width: 90vw;
                max-height: 70vh;
                overflow-y: auto;
                border-radius: 16px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            }
            
            .dropdown-item {
                padding: 16px 18px;
                font-size: 16px;
                min-height: 48px;
                border-radius: 12px;
                margin: 6px;
            }
            
            .dropdown-item:hover {
                transform: none;
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            }
            
            .dropdown-icon {
                font-size: 18px;
                width: 24px;
            }
            
            /* Hide keyboard shortcuts on mobile */
            .shortcuts-mobile-hide {
                display: none !important;
            }
            
            /* Mobile form inputs */
            input[type="text"], input[type="number"], select {
                font-size: 16px !important; /* Prevents zoom on iOS */
                padding: 12px 15px;
                border-radius: 10px;
                min-height: 44px;
            }
            
            /* Mobile-optimized panels */
            .analytics-panel, .insights-panel, .goals-panel, .theme-panel {
                margin: 10px;
                border-radius: 15px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            }
            
            .panel-header {
                padding: 15px 20px;
                border-radius: 15px 15px 0 0;
            }
            
            .panel-content {
                padding: 15px 20px;
            }
            
            /* Improved mobile gestures */
            .chart-container {
                touch-action: pan-y pinch-zoom;
            }
            
            /* Better mobile table interactions */
            td.editable, td.category-name {
                position: relative;
                overflow: hidden;
            }
            
            td.editable::before, td.category-name::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                transition: left 0.5s ease;
                pointer-events: none;
            }
            
            td.editable:active::before, td.category-name:active::before {
                left: 100%;
            }
            
            /* Loading states for mobile */
            .loading-spinner {
                width: 40px;
                height: 40px;
                border: 3px solid rgba(102, 126, 234, 0.2);
                border-top: 3px solid #667eea;
                border-radius: 50%;
                animation: mobileSpin 1s linear infinite;
                margin: 20px auto;
            }
            
            @keyframes mobileSpin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        }

        /* Tablet adjustments */
        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
                margin: 20px auto;
                padding: 40px;
                border-radius: 24px;
            }

            #userArea {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 20px;
            }

            .user-buttons {
                display: flex;
                gap: 12px;
                align-items: center;
                flex-wrap: nowrap;
            }
            
            /* Reset mobile overrides for desktop */
            .user-buttons button {
                padding: 12px 18px !important;
                font-size: 14px !important;
                min-height: 44px !important;
                border-radius: 10px !important;
                white-space: nowrap;
            }
            
            .dropdown-btn {
                padding: 12px 18px !important;
                font-size: 14px !important;
                min-height: 44px !important;
                border-radius: 10px !important;
                gap: 8px !important;
                max-width: none !important;
            }
            
            #darkModeBtn, #logoutBtn, .language-toggle {
                padding: 12px 18px !important;
                font-size: 14px !important;
                min-height: 44px !important;
                border-radius: 10px !important;
            }
            
            .user-info img {
                width: 40px !important;
                height: 40px !important;
            }

            .category-input-section {
                text-align: center;
                padding: 20px;
            }

            .input-row {
                justify-content: center;
                flex-wrap: nowrap;
            }

            input, select {
                max-width: 200px;
                font-size: 15px;
                padding: 14px 18px;
                min-height: 50px;
            }

            /* Desktop dropdown enhancements */
            .chart-controls {
                flex-direction: row;
                align-items: flex-start;
                flex-wrap: wrap;
                gap: 20px;
            }

            .chart-select-row {
                flex: 1;
                flex-direction: row;
                gap: 20px;
                align-items: flex-start;
            }

            .chart-select-container {
                flex: 1;
                min-width: 200px;
            }

            .dropdown-label {
                font-size: 14px;
                margin-bottom: 8px;
            }

            #forecastPeriod, #chartCategory {
                font-size: 14px;
                padding: 14px 18px;
                min-height: 50px;
            }

            .chart-buttons-row {
                display: flex;
                gap: 10px;
            }

            .chart-type-buttons {
                grid-column: unset;
            }

            .chart-wrapper {
                height: 400px;
            }

            .chart-stats {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
            }

            .analytics-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }

            .insights-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .notification {
                top: 30px;
                left: 30px;
                max-width: 400px;
            }

            th, td {
                padding: 14px 10px;
                font-size: 14px;
            }
            
            /* Desktop table improvements */
            .table-wrapper::before {
                display: none;
            }
            
            .table-help {
                font-size: 12px;
                padding: 12px 20px;
            }
        }

        /* Hide number input arrows */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            appearance: textfield;
            -moz-appearance: textfield;
        }

        /* Touch improvements */
        .fade-out {
            opacity: 0;
            transform: translateX(-100px) scale(0.8);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            filter: blur(2px);
        }

        /* Enhanced fade out for table rows */
        tr.fade-out {
            background: linear-gradient(90deg, rgba(231, 76, 60, 0.1), transparent) !important;
            border-left: 4px solid #e74c3c;
            animation: fadeOutSlide 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes fadeOutSlide {
            0% {
                opacity: 1;
                transform: translateX(0) scale(1);
                max-height: auto;
                filter: blur(0);
            }
            50% {
                opacity: 0.3;
                transform: translateX(-30px) scale(0.95);
                filter: blur(1px);
            }
            100% {
                opacity: 0;
                transform: translateX(-120px) scale(0.7);
                max-height: 0;
                padding: 0;
                margin: 0;
                filter: blur(3px);
            }
        }

        /* Advanced Mobile Gestures */
        .pinch-zoom-container {
            overflow: hidden;
            position: relative;
            touch-action: pan-x pan-y pinch-zoom;
        }

        /* Mobile Loading Skeletons */
        .skeleton {
            background: linear-gradient(90deg, 
                rgba(255,255,255,0.1) 25%, 
                rgba(255,255,255,0.2) 50%, 
                rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-row {
            height: 20px;
            margin-bottom: 10px;
        }

        .skeleton-row.short {
            width: 60%;
        }

        .skeleton-row.medium {
            width: 80%;
        }

        .skeleton-row.long {
            width: 100%;
        }

        /* Page Transition Effects */
        .page-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .page-transition.active {
            opacity: 1;
            pointer-events: auto;
        }

        .page-transition-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: white;
        }

        .transition-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .transition-text {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }

        /* Success Celebration Animation */
        .success-celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary-color);
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti:nth-child(2n) { background: var(--secondary-color); }
        .confetti:nth-child(3n) { background: #f39c12; }
        .confetti:nth-child(4n) { background: #e74c3c; }
        .confetti:nth-child(5n) { background: #2ecc71; }

        /* Double Tap Indicator */
        .double-tap-indicator {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 3px solid var(--primary-color);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.5);
            animation: double-tap-ripple 0.6s ease-out;
        }

        @keyframes double-tap-ripple {
            0% {
                opacity: 1;
                transform: scale(0.5);
            }
            100% {
                opacity: 0;
                transform: scale(2);
            }
        }

        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: #e74c3c;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transform: translateX(-50%) translateY(-30px);
            transition: all 0.3s ease;
        }

        .offline-indicator.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Enhanced Touch Feedback */
        .touch-feedback {
            position: relative;
            overflow: hidden;
        }

        .touch-feedback::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
            pointer-events: none;
        }

        .touch-feedback:active::after {
            width: 100px;
            height: 100px;
        }

        /* Scrollbar styling for mobile */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(103, 126, 234, 0.5);
            border-radius: 3px;
        }

        /* Theme Selector Panel */
        .theme-panel {
            margin: 20px 0;
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.08), rgba(142, 68, 173, 0.08));
            border-radius: 20px;
            border: 1px solid rgba(155, 89, 182, 0.2);
            backdrop-filter: blur(15px);
            overflow: hidden;
            animation: slideIn 0.8s ease-out;
        }

        body.dark-mode .theme-panel {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.08), rgba(142, 68, 173, 0.08));
            border: 1px solid rgba(155, 89, 182, 0.15);
        }

        .theme-header {
            padding: 20px;
            border-bottom: 1px solid rgba(155, 89, 182, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .theme-header h3 {
            margin: 0;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            font-weight: 600;
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-theme-btn {
            padding: 8px 16px;
            font-size: 12px;
            background: linear-gradient(45deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1));
            color: #8e44ad;
            border: 1px solid rgba(155, 89, 182, 0.3);
            min-height: 36px;
            transition: all 0.3s ease;
        }

        .toggle-theme-btn:hover {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            transform: scale(1.05);
        }

        body.dark-mode .toggle-theme-btn {
            background: linear-gradient(45deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1));
            color: #9b59b6;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }

        body.dark-mode .toggle-theme-btn:hover {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
        }

        .theme-content {
            padding: 20px;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .theme-item {
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            padding: 15px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .theme-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .theme-item.active {
            border-color: #9b59b6;
            box-shadow: 0 8px 25px rgba(155, 89, 182, 0.3);
        }

        body.dark-mode .theme-item {
            background: rgba(52, 73, 94, 0.8);
        }

        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        .theme-name {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        body.dark-mode .theme-name {
            color: #ecf0f1;
        }

        .theme-description {
            font-size: 11px;
            color: #7f8c8d;
            font-style: italic;
        }

        body.dark-mode .theme-description {
            color: #bdc3c7;
        }

        /* Theme Color Schemes */
        .theme-default .theme-preview {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .theme-ocean .theme-preview {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
        }

        .theme-sunset .theme-preview {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }

        .theme-forest .theme-preview {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
        }

        .theme-royal .theme-preview {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .theme-fire .theme-preview {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .theme-gold .theme-preview {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .theme-ice .theme-preview {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
        }

        /* Theme Variables */
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --primary-light: rgba(103, 126, 234, 0.1);
            --secondary-light: rgba(118, 75, 162, 0.1);
        }

        body.theme-ocean {
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --primary-light: rgba(79, 172, 254, 0.1);
            --secondary-light: rgba(0, 242, 254, 0.1);
        }

        body.theme-sunset {
            --primary-color: #f093fb;
            --secondary-color: #f5576c;
            --primary-light: rgba(240, 147, 251, 0.1);
            --secondary-light: rgba(245, 87, 108, 0.1);
        }

        body.theme-forest {
            --primary-color: #43e97b;
            --secondary-color: #38f9d7;
            --primary-light: rgba(67, 233, 123, 0.1);
            --secondary-light: rgba(56, 249, 215, 0.1);
        }

        body.theme-royal {
            --primary-color: #9b59b6;
            --secondary-color: #8e44ad;
            --primary-light: rgba(155, 89, 182, 0.1);
            --secondary-light: rgba(142, 68, 173, 0.1);
        }

        body.theme-fire {
            --primary-color: #ff6b6b;
            --secondary-color: #ee5a52;
            --primary-light: rgba(255, 107, 107, 0.1);
            --secondary-light: rgba(238, 90, 82, 0.1);
        }

        body.theme-gold {
            --primary-color: #f39c12;
            --secondary-color: #e67e22;
            --primary-light: rgba(243, 156, 18, 0.1);
            --secondary-light: rgba(230, 126, 34, 0.1);
        }

        body.theme-ice {
            --primary-color: #74b9ff;
            --secondary-color: #0984e3;
            --primary-light: rgba(116, 185, 255, 0.1);
            --secondary-light: rgba(9, 132, 227, 0.1);
        }

        /* Apply theme variables to existing elements */
        .stat-value, .analytics-header h3, .chart-select-row label, .dropdown-label {
            color: var(--primary-color) !important;
        }

        body.dark-mode .stat-value, body.dark-mode .analytics-header h3, 
        body.dark-mode .chart-select-row label, body.dark-mode .dropdown-label {
            color: var(--primary-color) !important;
        }

        .stat-card, .analytics-panel, .chart-type-btn, #forecastPeriod, #chartCategory {
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light)) !important;
        }

        .chart-type-btn.active {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)) !important;
        }

        th {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)) !important;
        }

        button:not(.delete-btn):not(.chart-type-btn) {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)) !important;
        }

        .insights-header h3 {
            background: linear-gradient(45deg, #2ecc71, #27ae60) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        h2 {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        body.dark-mode h2 {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        /* Theme transition effects */
        * {
            transition: background 0.5s ease, color 0.5s ease, border-color 0.5s ease !important;
        }

        /* Goals & Targets Panel */
        .goals-panel {
            margin: 20px 0;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.08), rgba(41, 128, 185, 0.08));
            border-radius: 20px;
            border: 1px solid rgba(52, 152, 219, 0.2);
            backdrop-filter: blur(15px);
            overflow: hidden;
            animation: slideIn 0.8s ease-out;
        }

        body.dark-mode .goals-panel {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.08), rgba(41, 128, 185, 0.08));
            border: 1px solid rgba(52, 152, 219, 0.15);
        }

        .goals-header {
            padding: 20px;
            border-bottom: 1px solid rgba(52, 152, 219, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .goals-header h3 {
            margin: 0;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            font-weight: 600;
            background: linear-gradient(45deg, #3498db, #2980b9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-goals-btn {
            padding: 8px 16px;
            font-size: 12px;
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
            color: #2980b9;
            border: 1px solid rgba(52, 152, 219, 0.3);
            min-height: 36px;
            transition: all 0.3s ease;
        }

        .toggle-goals-btn:hover {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            transform: scale(1.05);
        }

        body.dark-mode .toggle-goals-btn {
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        body.dark-mode .toggle-goals-btn:hover {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .goals-content {
            padding: 20px;
        }

        .goal-input-section {
            background: rgba(255,255,255,0.7);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        body.dark-mode .goal-input-section {
            background: rgba(52, 73, 94, 0.7);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .goal-input-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: end;
        }

        .goal-input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .goal-input-group label {
            font-size: 12px;
            font-weight: 600;
            color: #3498db;
        }

        body.dark-mode .goal-input-group label {
            color: #3498db;
        }

        .goal-input {
            padding: 10px 12px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            font-size: 13px;
            font-weight: 500;
            min-height: 38px;
        }

        .goal-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        body.dark-mode .goal-input {
            background: rgba(52, 73, 94, 0.9);
            color: #ecf0f1;
            border: 2px solid rgba(52, 152, 219, 0.3);
        }

        body.dark-mode .goal-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .add-goal-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            min-height: 38px;
            transition: all 0.3s ease;
        }

        .add-goal-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .smart-suggestions-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
        }

        .goals-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        /* Goals tooltips */
        .goal-item {
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            padding: 15px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border-left: 4px solid #3498db;
            position: relative;
            overflow: hidden;
            cursor: help;
        }

        .goal-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.15);
        }

        .goal-item::before {
            content: "🎯 Πατήστε για περισσότερες πληροφορίες σχετικά με αυτόν τον στόχο και πώς υπολογίζεται η πρόοδος.";
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: rgba(52, 152, 219, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.3;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            text-align: center;
            margin-bottom: 5px;
        }

        .goal-item:hover::before {
            opacity: 1;
            visibility: visible;
        }

        body.dark-mode .goal-item::before {
            background: rgba(52, 152, 219, 0.95);
        }

        /* Mobile goal tooltips */
        @media (max-width: 768px) {
            .goal-item::before {
                position: fixed;
                bottom: 40px;
                left: 20px;
                right: 20px;
                border-radius: 8px;
                font-size: 12px;
                padding: 12px 16px;
            }
        }

        body.dark-mode .goal-item {
            background: rgba(52, 73, 94, 0.8);
            border-left: 4px solid #3498db;
        }

        .goal-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-title {
            font-size: 14px;
            font-weight: 600;
            color: #2980b9;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.dark-mode .goal-title {
            color: #3498db;
        }

        .goal-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .goal-status.achieved {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .goal-status.in-progress {
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
        }

        .goal-status.at-risk {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .goal-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .goal-target {
            color: #7f8c8d;
            font-weight: 500;
        }

        body.dark-mode .goal-target {
            color: #bdc3c7;
        }

        .goal-current {
            color: #2c3e50;
            font-weight: 600;
            background: rgba(52, 152, 219, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
        }

        body.dark-mode .goal-current {
            color: #ecf0f1;
            background: rgba(52, 152, 219, 0.15);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill.achieved {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        .progress-fill.at-risk {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .progress-text {
            font-size: 11px;
            color: #7f8c8d;
            text-align: center;
            font-weight: 500;
        }

        body.dark-mode .progress-text {
            color: #bdc3c7;
        }

        .goal-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            justify-content: flex-end;
        }

        .goal-action-btn {
            background: rgba(52, 152, 219, 0.1);
            border: none;
            color: #3498db;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .goal-action-btn:hover {
            background: rgba(52, 152, 219, 0.2);
            transform: scale(1.05);
        }

        .goal-action-btn.delete {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .goal-action-btn.delete:hover {
            background: rgba(231, 76, 60, 0.2);
            transform: scale(1.05);
        }

        /* Goals Performance Summary */
        .goals-performance-summary {
            background: rgba(255,255,255,0.6);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }

        body.dark-mode .goals-performance-summary {
            background: rgba(52, 73, 94, 0.6);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .performance-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .performance-metric {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.8);
            border-radius: 8px;
            border: 1px solid rgba(52, 152, 219, 0.1);
        }

        body.dark-mode .performance-metric {
            background: rgba(52, 73, 94, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .metric-icon {
            font-size: 18px;
            font-weight: bold;
        }

        .metric-details {
            flex: 1;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            line-height: 1;
        }

        body.dark-mode .metric-value {
            color: #ecf0f1;
        }

        .metric-label {
            font-size: 10px;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            margin-top: 2px;
        }

        body.dark-mode .metric-label {
            color: #bdc3c7;
        }

        /* Mobile adjustments for goals */
        @media (max-width: 768px) {
            .goal-input-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .goals-grid {
                grid-template-columns: 1fr;
            }

            .goal-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }

        /* Desktop goals grid */
        @media (min-width: 768px) {
            .goals-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        /* iOS safe areas */
        @supports (padding: max(0px)) {
            .container {
                padding-left: max(10px, env(safe-area-inset-left));
                padding-right: max(10px, env(safe-area-inset-right));
                padding-top: max(10px, env(safe-area-inset-top));
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
        }

        /* Calculator Widget Styles */
        .calculator-widget {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 10000;
            min-width: 280px;
            backdrop-filter: blur(20px);
        }

        /* Haptic Feedback Class */
        .haptic-feedback {
            transition: transform 0.1s ease;
        }

        .haptic-feedback:active {
            transform: scale(0.95);
        }

        /* Smart Loading States */
        .smart-loading {
            position: relative;
            overflow: hidden;
        }

        .smart-loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.3), 
                transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Enhanced Swipe Indicators */
        .swipe-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: var(--primary-color);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .swipe-indicator.left {
            left: 10px;
        }

        .swipe-indicator.right {
            right: 10px;
        }

        .swipe-indicator.show {
            opacity: 1;
            transform: translateY(-50%) scale(1.2);
        }

        /* Mobile Context Menu */
        .mobile-context-menu {
            position: fixed;
            background: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 10000;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s ease;
            backdrop-filter: blur(20px);
            min-width: 200px;
        }

        .mobile-context-menu.show {
            opacity: 1;
            transform: scale(1);
        }

        .context-menu-item {
            padding: 16px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            font-size: 15px;
            font-weight: 500;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s ease;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .context-menu-item:hover {
            background: var(--hover-color);
        }

        .context-menu-item:first-child {
            border-radius: 15px 15px 0 0;
        }

        .context-menu-item:last-child {
            border-radius: 0 0 15px 15px;
        }

        .context-menu-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        /* Calculator Widget Styles */
        .calculator-widget {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 10000;
            min-width: 280px;
            backdrop-filter: blur(20px);
        }

        .calculator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: 14px 14px 0 0;
            color: white;
        }

        .calculator-header h3 {
            margin: 0;
            font-size: 16px;
        }

        .close-calc {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .close-calc:hover {
            background: rgba(255,255,255,0.2);
        }

        .calculator-display {
            padding: 20px;
            background: var(--card-background);
        }

        #calcDisplay {
            width: 100%;
            height: 50px;
            font-size: 24px;
            text-align: right;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            background: var(--background-color);
            color: var(--text-color);
            font-weight: bold;
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 20px;
        }

        .calculator-memory {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 0 20px 20px;
        }

        .calc-btn {
            height: 50px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .calc-btn.number {
            background: var(--card-background);
            border: 1px solid var(--border-color);
        }

        .calc-btn.number:hover {
            background: var(--hover-color);
            transform: translateY(-2px);
        }

        .calc-btn.operator {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .calc-btn.operator:hover {
            background: linear-gradient(45deg, #e67e22, #d35400);
            transform: translateY(-2px);
        }

        .calc-btn.equals {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .calc-btn.equals:hover {
            background: linear-gradient(45deg, #2ecc71, #16a085);
            transform: translateY(-2px);
        }

        .calc-btn.clear {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .calc-btn.clear:hover {
            background: linear-gradient(45deg, #c0392b, #a93226);
            transform: translateY(-2px);
        }

        .calc-btn.memory {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
            color: white;
            font-size: 12px;
        }

        .calc-btn.memory:hover {
            background: linear-gradient(45deg, #9b59b6, #a569bd);
            transform: translateY(-2px);
        }
        
        /* Touch feedback for mobile devices */
        .calc-btn:active {
            transform: scale(0.95);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 768px) {
            .calc-btn:active {
                transform: scale(0.95) !important;
                box-shadow: inset 0 2px 8px rgba(0,0,0,0.3) !important;
            }
            
            .calc-btn.number:active {
                background: linear-gradient(45deg, #2980b9, #3498db) !important;
            }
            
            .calc-btn.operator:active {
                background: linear-gradient(45deg, #e67e22, #f39c12) !important;
            }
            
            .calc-btn.equals:active {
                background: linear-gradient(45deg, #27ae60, #2ecc71) !important;
            }
            
            .calc-btn.clear:active {
                background: linear-gradient(45deg, #c0392b, #e74c3c) !important;
            }
        }

        .calc-btn.zero {
            grid-column: span 2;
        }

        /* Modern Language Toggle Button */
        .language-toggle {
            background: linear-gradient(135deg, #1976D2 0%, #2196F3 100%);
            border: none;
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            touch-action: manipulation;
            min-height: 44px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
        }

        .language-toggle:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .language-toggle:hover:before {
            left: 100%;
        }

        .language-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.25);
            background: linear-gradient(135deg, #2196F3 0%, #64B5F6 100%);
        }

        .language-toggle:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.25);
        }

        .language-toggle .flag-emoji {
            font-size: 18px;
            transition: transform 0.3s ease;
        }

        .language-toggle:hover .flag-emoji {
            transform: scale(1.2);
        }

        /* Dark mode styles for language toggle */
        body.dark-mode .language-toggle {
            background: linear-gradient(135deg, #1976D2 0%, #2196F3 100%);
            box-shadow: 0 2px 12px rgba(255,255,255,0.1);
        }

        body.dark-mode .language-toggle:hover {
            background: linear-gradient(135deg, #2196F3 0%, #64B5F6 100%);
            box-shadow: 0 4px 20px rgba(255,255,255,0.2);
        }

        /* Keyboard Shortcuts Modal Styles */
        .shortcuts-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .shortcuts-content {
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .shortcuts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: 14px 14px 0 0;
            color: white;
        }

        .shortcuts-header h3 {
            margin: 0;
            font-size: 20px;
        }

        .close-shortcuts {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .close-shortcuts:hover {
            background: rgba(255,255,255,0.2);
        }

        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .shortcut-category {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
        }

        .shortcut-category h4 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 16px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 8px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(var(--border-color), 0.3);
        }

        .shortcut-item:last-child {
            border-bottom: none;
        }

        .shortcut-key {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }

        .shortcut-desc {
            color: var(--text-color);
            font-size: 14px;
            flex: 1;
            margin-left: 15px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .calculator-widget {
                min-width: 95vw;
                max-height: 85vh;
                transform: translate(-50%, -50%);
                top: 50%;
                left: 50%;
                position: fixed;
            }
            
            .calculator-buttons {
                gap: 8px;
                padding: 15px;
            }
            
            .calc-btn {
                height: 55px;
                font-size: 18px;
                border-radius: 12px;
            }
            
            .calculator-memory {
                padding: 0 15px 15px;
                gap: 8px;
            }
            
            .calc-btn.memory {
                height: 45px;
                font-size: 14px;
            }
            
            #calcDisplay {
                height: 60px;
                font-size: 28px;
                border-radius: 12px;
            }
            
            .shortcuts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .shortcut-key {
                min-width: 70px;
                font-size: 11px;
            }
            
            .shortcut-desc {
                font-size: 13px;
                margin-left: 10px;
            }
            
            /* Hide shortcuts modal completely on mobile */
            .shortcuts-modal {
                display: none !important;
            }
            
            /* Enhanced Mobile Dropdown Styling */
            .dropdown-container {
                position: relative;
                z-index: 9999;
            }
            
            .dropdown-btn {
                width: 100% !important;
                min-height: 48px !important;
                font-size: 15px !important;
                font-weight: 600 !important;
                padding: 14px 20px !important;
                border-radius: 12px !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                color: white !important;
                border: none !important;
                box-shadow: 0 4px 15px rgba(103, 126, 234, 0.3) !important;
                transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
                position: relative !important;
                overflow: hidden !important;
                touch-action: manipulation !important;
                -webkit-tap-highlight-color: transparent !important;
                user-select: none !important;
            }
            
            .dropdown-btn:active {
                transform: scale(0.96) !important;
                box-shadow: 0 2px 8px rgba(103, 126, 234, 0.4) !important;
            }
            
            .dropdown-btn::before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: -100% !important;
                width: 100% !important;
                height: 100% !important;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent) !important;
                transition: left 0.5s ease !important;
            }
            
            .dropdown-btn:active::before {
                left: 100% !important;
            }
            
            .dropdown-arrow {
                margin-left: 8px !important;
                transition: transform 0.3s ease !important;
                font-size: 14px !important;
            }
            
            .dropdown-container.active .dropdown-arrow {
                transform: rotate(180deg) !important;
            }
            
            .dropdown-menu {
                position: absolute !important;
                top: calc(100% + 8px) !important;
                left: 0 !important;
                right: 0 !important;
                background: rgba(255, 255, 255, 0.98) !important;
                backdrop-filter: blur(20px) !important;
                border-radius: 15px !important;
                box-shadow: 0 8px 30px rgba(0,0,0,0.25) !important;
                border: 1px solid rgba(255,255,255,0.3) !important;
                z-index: 10000 !important;
                opacity: 0 !important;
                visibility: hidden !important;
                transform: translateY(-10px) scale(0.95) !important;
                transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
                max-height: 400px !important;
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
            }
            
            .dropdown-container.active .dropdown-menu {
                opacity: 1 !important;
                visibility: visible !important;
                transform: translateY(0) scale(1) !important;
            }
            
            .dropdown-item {
                display: flex !important;
                align-items: center !important;
                gap: 12px !important;
                padding: 15px 18px !important;
                cursor: pointer !important;
                transition: all 0.3s ease !important;
                font-size: 15px !important;
                color: #2c3e50 !important;
                border-radius: 10px !important;
                margin: 4px 8px !important;
                font-weight: 500 !important;
                min-height: 48px !important;
                touch-action: manipulation !important;
                -webkit-tap-highlight-color: transparent !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .dropdown-item:active {
                background: linear-gradient(135deg, rgba(103, 126, 234, 0.2), rgba(118, 75, 162, 0.2)) !important;
                color: #667eea !important;
                transform: scale(0.96) !important;
            }
            
            .dropdown-item::before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: -100% !important;
                width: 100% !important;
                height: 100% !important;
                background: linear-gradient(90deg, transparent, rgba(103, 126, 234, 0.1), transparent) !important;
                transition: left 0.3s ease !important;
            }
            
            .dropdown-item:active::before {
                left: 100% !important;
            }
            
            .dropdown-icon {
                font-size: 18px !important;
                width: 24px !important;
                text-align: center !important;
                flex-shrink: 0 !important;
            }
            
            .dropdown-divider {
                height: 1px !important;
                background: linear-gradient(90deg, transparent, rgba(0,0,0,0.1), transparent) !important;
                margin: 8px 16px !important;
            }
            
            /* Dark mode dropdown for mobile */
            body.dark-mode .dropdown-menu {
                background: rgba(44, 62, 80, 0.98) !important;
                border: 1px solid rgba(255,255,255,0.2) !important;
                box-shadow: 0 8px 30px rgba(0,0,0,0.4) !important;
            }
            
            body.dark-mode .dropdown-item {
                color: #ecf0f1 !important;
            }
            
            body.dark-mode .dropdown-item:active {
                background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2)) !important;
                color: #4facfe !important;
            }
            
            body.dark-mode .dropdown-divider {
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent) !important;
            }
        }

        /* Floating Subscription Button */
        .floating-subscription {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9999;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .floating-subscription:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 4px 20px rgba(var(--primary-color-rgb), 0.6); }
            100% { box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        }

        @media (max-width: 768px) {
            .floating-shortcuts {
                display: none !important;
            }
        }

        /* Footer Styles */
        .terms-footer {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding: 30px 20px 20px;
            margin-top: 40px;
            border-radius: 20px 20px 0 0;
            width: 100%;
            position: relative;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .footer-section h4 {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 5px 0;
            border-radius: 5px;
            cursor: pointer;
        }

        .footer-links a:hover {
            color: rgba(255, 255, 255, 1);
            background: rgba(255, 255, 255, 0.1);
            padding-left: 8px;
            transform: translateX(5px);
        }

        .footer-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
            line-height: 1.5;
        }

        .footer-secure {
            margin-top: 8px;
            padding: 6px 10px;
            background: rgba(46, 204, 113, 0.2);
            border-radius: 15px;
            color: #2ecc71;
            font-size: 10px;
            font-weight: 600;
            text-align: center;
        }

        /* Dark Mode Footer */
        body.dark-mode .terms-footer {
            background: rgba(52, 73, 94, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .footer-section h4 {
            color: #ecf0f1;
        }

        body.dark-mode .footer-links a {
            color: #bdc3c7;
        }

        body.dark-mode .footer-links a:hover {
            color: #ecf0f1;
            background: rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .footer-text {
            color: #95a5a6;
        }

        /* Mobile Footer Responsive */
        @media (max-width: 768px) {
            .terms-footer {
                padding: 20px 15px 15px;
                margin-top: 25px;
                border-radius: 15px 15px 0 0;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }

            .footer-section h4 {
                font-size: 13px;
                margin-bottom: 10px;
            }

            .footer-links {
                gap: 6px;
            }

            .footer-links a {
                font-size: 11px;
                padding: 8px 12px;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.1);
                min-height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }

            .footer-links a:hover {
                transform: scale(1.02);
                padding-left: 12px;
            }

            .footer-secure {
                margin-top: 10px;
                padding: 8px 12px;
                font-size: 9px;
            }
        }

        /* Ultra small screens (κινητά < 400px) */
        @media (max-width: 400px) {
            .terms-footer {
                padding: 15px 10px;
                margin-top: 20px;
            }

            .footer-links a {
                font-size: 10px;
                padding: 10px 8px;
                min-height: 40px;
            }

            .footer-section h4 {
                font-size: 12px;
            }

            .footer-text {
                font-size: 10px;
            }
        }
    </style>
</head>

<body>
    <!-- Top Controls -->
    <div class="top-controls">
        <button id="languageToggle" onclick="toggleLanguage()" title="Αλλαγή Γλώσσας">🇬🇷</button>
        <button id="darkModeToggle" onclick="toggleDarkMode()" title="Dark/Light Mode">🌙</button>
    </div>

    <div class="container">
        <div id="userArea">
            <div class="user-info">
                <img src="logo.png" alt="My Logo">
                <span>Καλώς ήρθες, <b id="userDisplay">Χρήστης</b></span>
            </div>
            <div class="user-buttons">
                <div class="dropdown-container">
                    <button class="dropdown-btn" id="actionsDropdownBtn">
                        ⚙️ Ενέργειες
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="dropdown-menu" id="actionsDropdown">
                        <div class="dropdown-item" onclick="document.getElementById('exportExcelBtn').click()">
                            <span class="dropdown-icon">📥</span>
                            <span>Εξαγωγή Excel</span>
                        </div>
                        <div class="dropdown-item" onclick="document.getElementById('exportPdfBtn').click()">
                            <span class="dropdown-icon">📄</span>
                            <span>Εξαγωγή PDF</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" onclick="document.getElementById('goalsBtn').click()">
                            <span class="dropdown-icon">🎯</span>
                            <span>Στόχοι & Targets</span>
                        </div>

                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" onclick="document.getElementById('themeBtn').click()">
                            <span class="dropdown-icon">🎨</span>
                            <span>Αλλαγή Θέματος</span>
                        </div>
                        <div class="dropdown-item" onclick="toggleCalculator()">
                            <span class="dropdown-icon">🔢</span>
                            <span class="translate">calculator</span>
                        </div>
                        <div class="dropdown-item shortcuts-mobile-hide" onclick="showKeyboardShortcuts()">
                            <span class="dropdown-icon">⌨️</span>
                            <span>Πλήκτρα Συντόμευσης</span>
                        </div>
                    </div>
                </div>
                <button id="exportExcelBtn" style="display: none;">📥 Excel</button>
                <button id="exportPdfBtn" style="display: none;">📥 PDF</button>
                <button id="goalsBtn" style="display: none;">🎯 Στόχοι</button>
                <button id="themeBtn" style="display: none;">🎨 Θέματα</button>
                <button id="calculatorBtn" style="display: none;">🔢 <span class="translate">calculator</span></button>
                <button id="shortcutsBtn" style="display: none;">⌨️ Συντομεύσεις</button>
                <button id="logoutBtn">🚪 Έξοδος</button>
            </div>
        </div>

        <h2>Κέντρο Στατιστικών</h2>

        <div class="category-input-section">
            <div id="categoryMessage"></div>
            <div class="input-row">
                <input type="text" id="categoryName" placeholder="Όνομα Κατηγορίας">
                <select id="yearSelect"></select>
                <button id="addCategoryBtn">Προσθήκη</button>
            </div>
        </div>

        <div class="table-container">
            <div class="table-wrapper" id="tableContainer"></div>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title" id="chartTitle">📊 Αναλυτικά Στοιχεία Πωλήσεων</div>
                <div class="chart-controls">
                    <div class="chart-select-row">
                        <div class="chart-select-container">
                            <label class="dropdown-label" for="chartCategory">
                                📊 Επιλογή Κατηγορίας:
                            </label>
                            <select id="chartCategory" data-advanced-analytics>
                                <option value="">🏢 Όλες οι Κατηγορίες</option>
                            </select>
                        </div>
                        <div class="chart-select-container">
                            <label class="dropdown-label" for="forecastPeriod">
                                🔮 Περίοδος Πρόβλεψης:
                            </label>
                            <select id="forecastPeriod" data-ai-prediction title="Επιλέξτε πόσους μήνες στο μέλλον θέλετε να προβλέψετε τις πωλήσεις">
                                <option value="3">📅 Βραχυπρόθεσμη (3 μήνες) - Υψηλή ακρίβεια 🎯</option>
                                <option value="6">📊 Μεσοπρόθεσμη (6 μήνες) - Καλή ακρίβεια ✅</option>
                                <option value="12">📈 Ετήσια πρόβλεψη (12 μήνες) - Μέτρια ακρίβεια ⚖️</option>
                                <option value="24">🚀 Μακροπρόθεσμη (2 χρόνια) - Εκτιμητική 🔍</option>
                            </select>
                            <small>💡 Μικρότερες περίοδοι = μεγαλύτερη ακρίβεια πρόβλεψης</small>
                        </div>
                    </div>
                    <div class="chart-buttons-row">
                        <button id="compareBtn">📊 Σύγκριση</button>
                        <button id="forecastBtn" data-ai-prediction="true">🔮 AI Πρόβλεψη</button>
                        <button id="downloadChartBtn">📥 Γράφημα</button>
                    </div>
                    <div class="chart-type-buttons">
                        <button class="chart-type-btn active" data-type="line" id="lineChartBtn">Γραμμή</button>
                        <button class="chart-type-btn" data-type="bar" id="barChartBtn">Στήλες</button>
                        <button class="chart-type-btn" data-type="doughnut" id="doughnutChartBtn">Κύκλος</button>
                    </div>
                </div>
            </div>
            
            <div class="chart-wrapper">
                <canvas id="salesChart"></canvas>
                <div class="loading-spinner" id="loadingSpinner"></div>
            </div>
            
            <div class="chart-stats" id="chartStats">
                <div class="stat-card" data-tooltip="💰 Άθροισμα όλων των πωλήσεων για την επιλεγμένη περίοδο. Δείχνει τη συνολική απόδοση της επιχείρησης.">
                    <div class="stat-value" id="totalSales">0</div>
                    <div class="stat-label" id="totalSalesLabel">Συνολικές Πωλήσεις</div>
                </div>
                <div class="stat-card" data-tooltip="📊 Μέσος όρος πωλήσεων ανά μήνα. Βοηθά στον υπολογισμό της μηνιαίας απόδοσης και στη σύγκριση με στόχους.">
                    <div class="stat-value" id="avgSales">0</div>
                    <div class="stat-label" id="avgSalesLabel">Μέσος Όρος</div>
                </div>
                <div class="stat-card" data-tooltip="🏆 Ο μήνας με τις υψηλότερες πωλήσεις. Χρήσιμο για τον εντοπισμό εποχικών τάσεων και peak περιόδων.">
                    <div class="stat-value" id="bestMonth">-</div>
                    <div class="stat-label" id="bestMonthLabel">Καλύτερος Μήνας</div>
                </div>
                <div class="stat-card" data-tooltip="📈 Ποσοστιαία αλλαγή πωλήσεων σε σχέση με την προηγούμενη περίοδο. Θετικό = ανάπτυξη, Αρνητικό = μείωση.">
                    <div class="stat-value" id="growthRate">0%</div>
                    <div class="stat-label" id="growthRateLabel">Ρυθμός Ανάπτυξης</div>
                </div>
                <div class="stat-card" data-advanced-analytics="true" data-tooltip="💹 Βαθμολογία που δείχνει πόσο αποδοτική είναι η επιχείρηση. Υπολογίζεται από την ανάπτυξη και τη σταθερότητα.">
                    <div class="stat-value" id="roiScore">0%</div>
                    <div class="stat-label" id="performanceLabel">📈 Βαθμός Απόδοσης</div>
                </div>
                <div class="stat-card" data-advanced-analytics="true" data-tooltip="🌊 Μετρά πόσο επηρεάζονται οι πωλήσεις από εποχικές αλλαγές. Υψηλή τιμή = μεγάλη εποχική διακύμανση.">
                    <div class="stat-value" id="seasonalityIndex">0.0</div>
                    <div class="stat-label" id="seasonalityLabel">🌊 Εποχικότητα</div>
                </div>
                <div class="stat-card" data-advanced-analytics="true" data-tooltip="📊 Δείχνει πόσο ισχυρή είναι η τάση ανάπτυξης ή μείωσης. Υψηλή = σταθερή τάση, Χαμηλή = ασταθής απόδοση.">
                    <div class="stat-value" id="trendStrength">-</div>
                    <div class="stat-label" id="trendStrengthLabel">📊 Ισχύς Τάσης</div>
                </div>
                <div class="stat-card" data-advanced-analytics="true" data-tooltip="⚡ Μετρά πόσο ασταθείς είναι οι πωλήσεις. Υψηλή αστάθεια = απρόβλεπτες αλλαγές, Χαμηλή = σταθερές πωλήσεις.">
                    <div class="stat-value" id="volatilityIndex">0%</div>
                    <div class="stat-label" id="volatilityLabel">⚡ Αστάθεια</div>
                </div>
            </div>
            
            <!-- Goals & Targets Panel -->
            <div class="goals-panel" id="goalsPanel" style="display: none;">
                <div class="goals-header">
                    <h3>🎯 <span class="translate" data-translate-key="goalsTargetsTitle"></span>Στόχοι & Επιδόσεις</span></h3>
                    <button class="toggle-goals-btn" id="toggleGoalsBtn">📈 <span class="translate" data-translate-key="manageGoals">Διαχείριση Στόχων</span></button>
                </div>
                <div class="goals-content" id="goalsContent">
                    <div class="goal-input-section">
                        <div class="goal-input-row">
                            <div class="goal-input-group">
                                <label for="goalCategory">📊 <span class="translate" data-translate-key="goalCategory">Κατηγορία</span>:</label>
                                <select id="goalCategory" class="goal-input">
                                    <option value=""><span class="translate" data-translate-key="allCategories">Όλες οι Κατηγορίες</span></option>
                                </select>
                            </div>
                            <div class="goal-input-group">
                                <label for="goalTarget">🎯 <span class="translate" data-translate-key="goalTarget">Στόχος</span>:</label>
                                <input type="number" id="goalTarget" class="goal-input" min="0">
                            </div>
                            <div class="goal-input-group">
                                <label for="goalPeriod">📅 <span class="translate" data-translate-key="goalPeriod">Περίοδος</span>:</label>
                                <select id="goalPeriod" class="goal-input">
                                    <option value="monthly"><span class="translate" data-translate-key="monthly">Μηνιαίος</span></option>
                                    <option value="quarterly"><span class="translate" data-translate-key="quarterly">Τριμηνιαίος</span></option>
                                    <option value="yearly"><span class="translate" data-translate-key="yearly">Ετήσιος</span></option>
                                </select>
                            </div>
                            <button class="add-goal-btn" id="addGoalBtn">➕ <span class="translate" data-translate-key="addGoal">Προσθήκη</span></button>
                            <button class="smart-suggestions-btn" id="smartSuggestionsBtn" onclick="showGoalSuggestions()" 
                                data-smart-suggestion="true"
                                style="background: linear-gradient(45deg, #9b59b6, #8e44ad); color: white; border: none; border-radius: 8px; padding: 10px 16px; font-size: 12px; font-weight: 600; cursor: pointer; min-height: 38px; transition: all 0.3s ease; margin-left: 10px;" 
                                data-translate-key="smartSuggestionsTooltip">💡 <span class="translate" data-translate-key="smartSuggestions">Έξυπνες Προτάσεις</span></button>
                        </div>
                    </div>
                    
                    <!-- Performance Summary -->
                    <div class="goals-performance-summary" id="goalsPerformanceSummary" style="margin-bottom: 20px;">
                        <!-- Performance metrics will be populated here -->
                    </div>
                    
                    <div class="goals-grid" id="goalsGrid">
                        <!-- Goals will be populated here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 15px; display: none;" id="noGoalsMessage">
                        <div style="color: #7f8c8d; font-style: italic; font-size: 14px;">
                            🎯 <span class="translate" data-translate-key="noGoalsYet">Δεν έχετε ορίσει στόχους ακόμα. Προσθέστε τον πρώτο σας στόχο!</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Theme Selector Panel -->
            <div class="theme-panel" id="themePanel" style="display: none;">
                <div class="theme-header">
                    <h3>🎨 <span class="translate">themeSelection</span></h3>
                    <button class="toggle-theme-btn" id="toggleThemeBtn">🎯 <span class="translate">selectStyle</span></button>
                </div>
                <div class="theme-content" id="themeContent">
                    <div class="theme-grid">
                        <div class="theme-item theme-default active" data-theme="default">
                            <div class="theme-preview"></div>
                            <div class="theme-name">🌟 <span class="translate">themeClassic</span></div>
                            <div class="theme-description translate">themeClassicDesc</div>
                        </div>
                        <div class="theme-item theme-ocean" data-theme="ocean">
                            <div class="theme-preview"></div>
                            <div class="theme-name">🌊 <span class="translate">themeOcean</span></div>
                            <div class="theme-description translate">themeOceanDesc</div>
                        </div>
                        <div class="theme-item theme-sunset" data-theme="sunset">
                            <div class="theme-preview"></div>
                            <div class="theme-name">🌅 <span class="translate">themeSunset</span></div>
                            <div class="theme-description translate">themeSunsetDesc</div>
                        </div>
                        <div class="theme-item theme-forest" data-theme="forest">
                            <div class="theme-preview"></div>
                            <div class="theme-name">🌲 <span class="translate">themeForest</span></div>
                            <div class="theme-description translate">themeForestDesc</div>
                        </div>
                        <div class="theme-item theme-royal" data-theme="royal">
                            <div class="theme-preview"></div>
                            <div class="theme-name">👑 <span class="translate">themeRoyal</span></div>
                            <div class="theme-description translate">themeRoyalDesc</div>
                        </div>
                        <div class="theme-item theme-fire" data-theme="fire">
                            <div class="theme-preview"></div>
                            <div class="theme-name">🔥 <span class="translate">themeFire</span></div>
                            <div class="theme-description translate">themeFireDesc</div>
                        </div>
                        <div class="theme-item theme-gold" data-theme="gold">
                            <div class="theme-preview"></div>
                            <div class="theme-name">✨ <span class="translate">themeGold</span></div>
                            <div class="theme-description translate">themeGoldDesc</div>
                        </div>
                        <div class="theme-item theme-ice" data-theme="ice">
                            <div class="theme-preview"></div>
                            <div class="theme-name">❄️ <span class="translate">themeIce</span></div>
                            <div class="theme-description translate">themeIceDesc</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="toggle-theme-btn" id="resetThemeBtn">🔄 <span class="translate">resetTheme</span></button>
                    </div>
                </div>
            </div>
            
            <!-- Smart Insights Panel -->
            <div class="insights-panel" data-smart-suggestion="true" id="insightsPanel">
                <div class="insights-header">
                    <h3>🔍 Έξυπνες Προτάσεις AI</h3>
                    <button class="refresh-insights-btn" id="toggleInsightsBtn" data-smart-suggestion="true">📊 Προβολή Λεπτομερειών</button>
                </div>
                <div class="insights-content" id="insightsContent" style="display: none;">
                    <div class="insights-loading" id="insightsLoading" style="display: none;">
                        <div class="spinner"></div>
                        <div>🧠 Το AI αναλύει τα δεδομένα σας...</div>
                    </div>
                    <div class="insights-grid" id="insightsGrid">
                        <!-- Insights will be populated here -->
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="refresh-insights-btn" id="refreshInsightsBtn" data-smart-suggestion="true">🔄 Ανανέωση Αναλύσεων</button>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Analytics Panel -->
            <div class="analytics-panel" data-advanced-analytics="true" id="analyticsPanel">
                <div class="analytics-header">
                    <h3 class="translate">advancedAnalytics</h3>
                    <button class="toggle-analytics-btn" id="toggleAnalyticsBtn" data-advanced-analytics="true">📊 <span class="translate">viewDetails</span></button>
                </div>
                <div class="analytics-content" id="analyticsContent" style="display: none;">
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <div class="analytics-title">📊 <span class="translate">performanceMetrics</span></div>
                            <div class="metric-row" data-tooltip-key="quarterlyGrowthTooltip">
                                <span class="metric-label translate">quarterlyGrowth</span>
                                <span class="metric-value" id="qoqGrowth">0%</span>
                            </div>
                            <div class="metric-row" data-tooltip-key="annualGrowthTooltip">
                                <span class="metric-label translate">annualGrowth</span>
                                <span class="metric-value" id="yoyGrowth">0%</span>
                            </div>
                            <div class="metric-row" data-tooltip-key="maxPerformanceTooltip">
                                <span class="metric-label translate">maxPerformance</span>
                                <span class="metric-value" id="peakPerformance">-</span>
                            </div>
                            <div class="metric-row" data-tooltip-key="consistencyScoreTooltip">
                                <span class="metric-label translate">consistencyScore</span>
                                <span class="metric-value" id="consistencyScore">0%</span>
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <div class="analytics-title">🎯 <span class="translate">marketAnalysis</span></div>
                            <div class="metric-row" data-tooltip-key="marketMomentumTooltip">
                                <span class="metric-label translate">marketMomentum</span>
                                <span class="metric-value" id="marketMomentum"><span class="translate">neutral</span></span>
                            </div>
                            <div class="metric-row" data-tooltip-key="trendDirectionTooltip">
                                <span class="metric-label translate">trendDirection</span>
                                <span class="metric-value" id="trendDirection"><span class="translate">stable</span></span>
                            </div>
                            <div class="metric-row" data-tooltip-key="riskLevelTooltip">
                                <span class="metric-label translate">riskLevel</span>
                                <span class="metric-value" id="riskLevel"><span class="translate">medium</span></span>
                            </div>
                            <div class="metric-row" data-tooltip-key="recoveryRateTooltip">
                                <span class="metric-label translate">recoveryRate</span>
                                <span class="metric-value" id="recoveryRate">0%</span>
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <div class="analytics-title">🔮 <span class="translate">predictiveEstimates</span></div>
                            <div class="metric-row" data-tooltip-key="forecastAccuracyTooltip">
                                <span class="metric-label translate">forecastAccuracy</span>
                                <span class="metric-value" id="forecastAccuracy">85%</span>
                            </div>
                            <div class="metric-row" data-tooltip-key="nextQuarterOutlookTooltip">
                                <span class="metric-label translate">nextQuarterOutlook</span>
                                <span class="metric-value" id="nextQuarterOutlook"><span class="translate">positive</span></span>
                            </div>
                            <div class="metric-row" data-tooltip-key="seasonalityImpactTooltip">
                                <span class="metric-label translate">seasonalityImpact</span>
                                <span class="metric-value" id="seasonalityImpact"><span class="translate">medium</span></span>
                            </div>
                            <div class="metric-row" data-tooltip-key="modelConfidenceTooltip">
                                <span class="metric-label translate">modelConfidence</span>
                                <span class="metric-value" id="modelConfidence"><span class="translate">high</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <div class="notification-content">
            <div class="notification-icon" id="notificationIcon">🔔</div>
            <div class="notification-text" id="notificationText"></div>
        </div>
    </div>

    <!-- Calculator Widget -->
    <div id="calculatorWidget" class="calculator-widget" style="display: none;">
        <div class="calculator-header">
            <h3>🔢 <span class="translate">calculator</span></h3>
            <button onclick="toggleCalculator()" class="close-calc">✕</button>
        </div>
        <div class="calculator-display">
            <input type="text" id="calcDisplay" readonly value="0">
        </div>
        <div class="calculator-buttons">
            <button onclick="clearCalc()" class="calc-btn clear">C</button>
            <button onclick="clearEntry()" class="calc-btn clear">CE</button>
            <button onclick="deleteLast()" class="calc-btn operator">⌫</button>
            <button onclick="appendOperator('/')" class="calc-btn operator">÷</button>
            
            <button onclick="appendNumber('7')" class="calc-btn number">7</button>
            <button onclick="appendNumber('8')" class="calc-btn number">8</button>
            <button onclick="appendNumber('9')" class="calc-btn number">9</button>
            <button onclick="appendOperator('*')" class="calc-btn operator">×</button>
            
            <button onclick="appendNumber('4')" class="calc-btn number">4</button>
            <button onclick="appendNumber('5')" class="calc-btn number">5</button>
            <button onclick="appendNumber('6')" class="calc-btn number">6</button>
            <button onclick="appendOperator('-')" class="calc-btn operator">-</button>
            
            <button onclick="appendNumber('1')" class="calc-btn number">1</button>
            <button onclick="appendNumber('2')" class="calc-btn number">2</button>
            <button onclick="appendNumber('3')" class="calc-btn number">3</button>
            <button onclick="appendOperator('+')" class="calc-btn operator">+</button>
            
            <button onclick="appendNumber('0')" class="calc-btn number zero">0</button>
            <button onclick="appendDecimal()" class="calc-btn number">.</button>
            <button onclick="calculate()" class="calc-btn equals">=</button>
        </div>
        <div class="calculator-memory">
            <button onclick="memoryStore()" class="calc-btn memory">MS</button>
            <button onclick="memoryRecall()" class="calc-btn memory">MR</button>
            <button onclick="memoryClear()" class="calc-btn memory">MC</button>
            <button onclick="memoryAdd()" class="calc-btn memory">M+</button>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutsModal" class="shortcuts-modal" style="display: none;">
        <div class="shortcuts-content">
            <div class="shortcuts-header">
                <h3 id="shortcutsTitle">⌨️ Πλήκτρα Συντόμευσης</h3>
                <button onclick="closeShortcuts()" class="close-shortcuts">✕</button>
            </div>
            <div class="shortcuts-grid">
                <div class="shortcut-category">
                    <h4 id="shortcutGeneralTitle">🏢 Γενικά</h4>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + N</span>
                        <span class="shortcut-desc" id="shortcutNewCategory">Νέα Κατηγορία</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + S</span>
                        <span class="shortcut-desc" id="shortcutSave">Αποθήκευση</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + D</span>
                        <span class="shortcut-desc" id="shortcutDarkMode">Dark Mode</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Esc</span>
                        <span class="shortcut-desc" id="shortcutCloseModal">Κλείσιμο Modal</span>
                    </div>
                </div>
                
                <div class="shortcut-category">
                    <h4 id="shortcutChartsTitle">📊 Γραφήματα</h4>
                    <div class="shortcut-item">
                        <span class="shortcut-key">1, 2, 3, 4</span>
                        <span class="shortcut-desc" id="shortcutChangeChartType">Αλλαγή Τύπου Γραφήματος</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + F</span>
                        <span class="shortcut-desc" id="shortcutForecast">Πρόβλεψη</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + C</span>
                        <span class="shortcut-desc" id="shortcutComparison">Σύγκριση</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + G</span>
                        <span class="shortcut-desc" id="shortcutGoals">Στόχοι</span>
                    </div>
                </div>
                
                <div class="shortcut-category">
                    <h4 id="shortcutExportTitle">📤 Εξαγωγή</h4>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + E</span>
                        <span class="shortcut-desc" id="shortcutExcel">Excel</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + P</span>
                        <span class="shortcut-desc" id="shortcutPDF">PDF</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + I</span>
                        <span class="shortcut-desc" id="shortcutDownloadChart">Λήψη Γραφήματος</span>
                    </div>
                </div>
                
                <div class="shortcut-category">
                    <h4 id="shortcutToolsTitle">🔧 Εργαλεία</h4>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + K</span>
                        <span class="shortcut-desc" id="shortcutCalculator">Αριθμομηχανή</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + ?</span>
                        <span class="shortcut-desc" id="shortcutThisMenu">Αυτό το Μενού</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + T</span>
                        <span class="shortcut-desc" id="shortcutChangeTheme">Αλλαγή Θέματος</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + R</span>
                        <span class="shortcut-desc" id="shortcutRefreshInsights">Ανανέωση AI Insights</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + A</span>
                        <span class="shortcut-desc" id="shortcutToggleAnalytics">Toggle Analytics</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Ctrl + J</span>
                        <span class="shortcut-desc" id="shortcutToggleInsights">Toggle AI Insights</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">H</span>
                        <span class="shortcut-desc" id="shortcutHelp">Βοήθεια (Αυτό το Μενού)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Subscription Button -->
    <div id="floatingSubscription" class="floating-subscription" onclick="window.location.href='subscription.html'" title="💼 Συνδρομή - Αναβάθμιση σε Plus">
        💼
    </div>

    <script>
        // Initialize data storage
        const salesData = { [new Date().getFullYear()]: {} };
        let selectedYear = new Date().getFullYear();
        let chart;
        let currentChartType = 'line';
        let currentLanguage = localStorage.getItem('language') || 'el'; // Default to Greek
        
        // Language translations
        const translations = {
            el: {
                // UI Elements
                welcome: 'Καλώς ήρθες',
                user: 'Χρήστης',
                actions: 'Ενέργειες',
                exportExcel: 'Εξαγωγή Excel',
                exportPdf: 'Εξαγωγή PDF',
                goalsTargets: 'Στόχοι & Targets',
                subscription: 'Συνδρομή',
                changeTheme: 'Αλλαγή Θέματος',
                changeLanguage: 'Αλλαγή Γλώσσας',
                calculator: 'Αριθμομηχανή',
                shortcuts: 'Πλήκτρα Συντόμευσης',
                resetTheme: 'Επαναφορά Προεπιλογής',
                calculatorActivated: 'Αριθμομηχανή ενεργοποιήθηκε!',
                logout: 'Έξοδος',
                statisticsCenter: 'Κέντρο Στατιστικών',
                categoryName: 'Όνομα Κατηγορίας',
                add: 'Προσθήκη',
                
                // Months
                months: ["Ιαν", "Φεβ", "Μαρ", "Απρ", "Μάι", "Ιουν", "Ιουλ", "Αυγ", "Σεπ", "Οκτ", "Νοε", "Δεκ"],
                
                // Table headers
                category: 'Κατηγορία',
                total: 'Σύνολο',
                actions_table: 'Ενέργειες',
                
                // Messages
                categoryExists: 'Η κατηγορία υπάρχει ήδη!',
                categoryAdded: 'Η κατηγορία προστέθηκε επιτυχώς!',
                categoryDeleted: 'Η κατηγορία διαγράφηκε!',
                dataExported: 'Τα δεδομένα εξήχθησαν επιτυχώς!',
                
                // Chart
                salesChart: 'Γραφικό Πωλήσεων',
                selectCategory: 'Επιλέξτε κατηγορία',
                allCategories: 'Όλες οι Κατηγορίες',
                chartLine: 'Γραμμικό',
                chartBar: 'Ραβδογράφημα',
                chartDoughnut: 'Κυκλικό',
                comparison: 'Σύγκριση',
                forecast: 'AI Πρόβλεψη',
                downloadChart: 'Γράφημα',
                
                // Notifications
                selectCategoryComparison: 'Παρακαλώ επιλέξτε κατηγορία για σύγκριση.',
                comparisonCompleted: 'Σύγκριση ολοκληρώθηκε!',
                
                // Forecast popup
                forecastAnalysis: 'Ανάλυση Πρόβλεψης',
                months_period: 'Μηνών',
                period: 'Περίοδος',
                totalForecast: 'Συνολική Πρόβλεψη',
                avgPerMonth: 'Μέσος Όρος/Μήνα',
                confidence: 'Εμπιστοσύνη',
                trend: 'Τάση',
                trendUp: 'Ανοδική',
                trendDown: 'Καθοδική',
                maxValue: 'Μέγιστη Τιμή',
                forecastNote: 'Η πρόβλεψη συνδυάζει ανάλυση τάσης, εποχικά μοτίβα και εκθετική εξομάλυνση',
                forecastDisclaimer: 'Σημείωση: Μεγαλύτερες περίοδοι έχουν μικρότερη ακρίβεια',
                close: 'Κλείσιμο',
                
                // Tooltips
                totalSalesTooltip: 'Άθροισμα όλων των πωλήσεων για την επιλεγμένη περίοδο. Δείχνει τη συνολική απόδοση της επιχείρησης.',
                avgSalesTooltip: 'Μέσος όρος πωλήσεων ανά μήνα. Βοηθά στον υπολογισμό της μηνιαίας απόδοσης και στη σύγκριση με στόχους.',
                bestMonthTooltip: 'Ο μήνας με τις υψηλότερες πωλήσεις. Χρήσιμο για τον εντοπισμό εποχικών τάσεων και peak περιόδων.',
                growthTooltip: 'Ποσοστιαία αλλαγή πωλήσεων σε σχέση με την προηγούμενη περίοδο. Θετικό = ανάπτυξη, Αρνητικό = μείωση.',
                performanceTooltip: 'Βαθμολογία που δείχνει πόσο αποδοτική είναι η επιχείρηση. Υπολογίζεται από την ανάπτυξη και τη σταθερότητα.',
                seasonalityTooltip: 'Μετρά πόσο επηρεάζονται οι πωλήσεις από εποχικές αλλαγές. Υψηλή τιμή = μεγάλη εποχική διακύμανση.',
                trendStrengthTooltip: 'Δείχνει πόσο ισχυρή είναι η τάση ανάπτυξης ή μείωσης. Υψηλή = σταθερή τάση, Χαμηλή = ασταθής απόδοση.',
                volatilityTooltip: 'Μετρά πόσο ασταθείς είναι οι πωλήσεις. Υψηλή αστάθεια = απρόβλεπτες αλλαγές, Χαμηλή = σταθερές πωλήσεις.',
                
                // Forecast periods
                forecastShortTerm: 'Βραχυπρόθεσμη (3 μήνες) - Υψηλή ακρίβεια',
                forecastMediumTerm: 'Μεσοπρόθεσμη (6 μήνες) - Καλή ακρίβεια',
                forecastLongTerm: 'Ετήσια πρόβλεψη (12 μήνες) - Μέτρια ακρίβεια',
                forecastExtended: 'Μακροπρόθεσμη (2 χρόνια) - Εκτιμητική',
                forecastPeriodLabel: 'Περίοδος Πρόβλεψης:',
                forecastTooltip: 'Επιλέξτε πόσους μήνες στο μέλλον θέλετε να προβλέψετε τις πωλήσεις',
                forecastAccuracyNote: 'Μικρότερες περίοδοι = μεγαλύτερη ακρίβεια πρόβλεψης',
                categorySelectionLabel: 'Επιλογή Κατηγορίας:',
                
                // Forecast chart labels
                trendForecastLabel: 'Πρόβλεψη Τάσης',
                seasonalForecastLabel: 'Πρόβλεψη Εποχικότητας',
                optimizedForecastLabel: 'Βέλτιστη Πρόβλεψη',
                
                // Stat card labels
                totalSalesLabel: 'Συνολικές Πωλήσεις',
                avgSalesLabel: 'Μέσος Όρος',
                bestMonthLabel: 'Καλύτερος Μήνας',
                growthRateLabel: 'Ρυθμός Ανάπτυξης',
                performanceLabel: 'Βαθμός Απόδοσης',
                seasonalityLabel: 'Εποχικότητα',
                trendStrengthLabel: 'Ισχύς Τάσης',
                volatilityLabel: 'Αστάθεια',
                
                // Trend strength values
                strongUpward: 'Ισχυρή Ανοδική',
                strongDownward: 'Ισχυρή Καθοδική',
                moderateUpward: 'Μέτρια Ανοδική',
                moderateDownward: 'Μέτρια Καθοδική',
                weakUpward: 'Ασθενής Ανοδική',
                weakDownward: 'Ασθενής Καθοδική',
                sideways: 'Πλευρική',
                insufficientData: 'Ανεπαρκή Δεδομένα',
                
                // AI Insights
                smartInsights: 'Έξυπνες Προτάσεις AI',
                viewDetails: 'Προβολή Λεπτομερειών',
                hideDetails: 'Απόκρυψη Λεπτομερειών',
                aiAnalyzing: 'Το AI αναλύει τα δεδομένα σας...',
                refreshAnalysis: 'Ανανέωση Αναλύσεων',
                
                // Insight titles and actions
                explosiveGrowth: 'Εκρηκτική Ανάπτυξη',
                positivetrend: 'Θετική Τάση',
                sharpDecline: 'Απότομη Πτώση',
                downwardTrend: 'Καθοδική Τάση',
                strongSeasonality: 'Ισχυρή Εποχικότητα',
                winterDemand: 'Χειμερινή Ζήτηση',
                summerPeak: 'Καλοκαιρινή Αιχμή',
                springGrowth: 'Ανοιξιάτικη Ανάπτυξη',
                autumnSlowdown: 'Φθινοπωρινή Επιβράδυνση',
                stagnation: 'Στασιμότητα',
                volatility: 'Υψηλή Αστάθεια',
                marketLeader: 'Ηγέτης Αγοράς',
                underperformer: 'Χαμηλή Απόδοση',
                balancedPortfolio: 'Ισορροπημένο Χαρτοφυλάκιο',
                concentrationRisk: 'Κίνδυνος Συγκέντρωσης',
                
                // Insight actions
                increaseInventory: 'Συνιστάται: Αύξηση αποθέματος και marketing budget για αυτήν την κατηγορία',
                maintainStrategy: 'Συνιστάται: Διατήρηση της τρέχουσας στρατηγικής',
                immediateAction: 'Άμεση δράση: Ανάλυση αιτιών και αναθεώρηση στρατηγικής',
                reviewMarketing: 'Συνιστάται: Εξέταση νέων στρατηγικών marketing',
                prepareInventory: 'Προγραμματίστε αύξηση αποθέματος πριν τον',
                holidayOffers: 'Ετοιμάστε ειδικές προσφορές για τις γιορτές',
                summerCampaign: 'Σχεδιάστε καλοκαιρινή καμπάνια marketing',
                springPromotion: 'Αξιοποιήστε την ανοιξιάτικη ενέργεια με νέα προϊόντα',
                autumnStrategy: 'Προετοιμαστείτε για φθινοπωρινή στρατηγική',
                findGrowthOpportunities: 'Αναζητήστε ευκαιρίες ανάπτυξης',
                stabilizeOperations: 'Εστιάστε στη σταθεροποίηση των λειτουργιών',
                capitalizeSuccess: 'Αξιοποιήστε την επιτυχία αυτής της κατηγορίας',
                improvePerformance: 'Βελτιώστε την απόδοση αυτής της κατηγορίας',
                maintainBalance: 'Διατηρήστε την ισορροπία στο χαρτοφυλάκιό σας',
                diversifyPortfolio: 'Διαφοροποιήστε το χαρτοφυλάκιό σας',
                
                // Advanced Analytics
                advancedAnalytics: 'Προηγμένα Αναλυτικά Στοιχεία',
                performanceMetrics: 'Μετρικές Απόδοσης',
                marketAnalysis: 'Ανάλυση Αγοράς',
                predictiveEstimates: 'Προβλεπτικές Εκτιμήσεις',
                
                // Performance metrics
                quarterlyGrowth: 'Τριμηνιαία Ανάπτυξη:',
                annualGrowth: 'Ετήσια Ανάπτυξη:',
                maxPerformance: 'Μέγιστη Απόδοση:',
                consistencyScore: 'Βαθμός Συνέπειας:',
                
                // Market analysis
                marketMomentum: 'Δυναμική Αγοράς:',
                trendDirection: 'Κατεύθυνση Τάσης:',
                riskLevel: 'Επίπεδο Κινδύνου:',
                recoveryRate: 'Ρυθμός Ανάκαμψης:',
                
                // Predictive estimates
                forecastAccuracy: 'Ακρίβεια Πρόβλεψης:',
                nextQuarterOutlook: 'Προοπτικές Τριμήνου:',
                seasonalityImpact: 'Επίδραση Εποχικότητας:',
                modelConfidence: 'Εμπιστοσύνη Μοντέλου:',
                
                // Values for analytics
                neutral: 'Ουδέτερη',
                positive: 'Θετική',
                negative: 'Αρνητική',
                stable: 'Σταθερή',
                upward: 'Ανοδική',
                downward: 'Καθοδική',
                high: 'Υψηλή',
                medium: 'Μέτρια',
                low: 'Χαμηλή',
                excellent: 'Εξαιρετικές',
                good: 'Καλές',
                poor: 'Φτωχές',
                
                // Extended values for analytics
                strongPositive: 'Ισχυρά Θετική',
                strongNegative: 'Ισχυρά Αρνητική',
                strongUpward: 'Ισχυρά Ανοδική',
                veryHigh: 'Πολύ Υψηλό',
                veryPositive: 'Πολύ Θετικές',
                cautious: 'Προσεκτικές',
                neutral2: 'Ουδέτερες',
                minimal: 'Ελάχιστη',
                veryHigh2: 'Πολύ Υψηλή',
                
                // Tooltips for Advanced Analytics
                quarterlyGrowthTooltip: 'Ποσοστιαία αλλαγή πωλήσεων σε σχέση με το προηγούμενο τρίμηνο. Δείχνει βραχυπρόθεσμη τάση.',
                annualGrowthTooltip: 'Ποσοστιαία αλλαγή πωλήσεων σε σχέση με την ίδια περίοδο του προηγούμενου έτους. Δείχνει μακροπρόθεσμη τάση.',
                maxPerformanceTooltip: 'Η καλύτερη μηνιαία απόδοση που έχει καταγραφεί. Χρήσιμο για τον καθορισμό ρεαλιστικών στόχων.',
                consistencyScoreTooltip: 'Πόσο σταθερές είναι οι πωλήσεις μας. Υψηλός βαθμός = προβλέψιμη απόδοση, Χαμηλός = ασταθής.',
                marketMomentumTooltip: 'Η γενική κατεύθυνση της αγοράς. Θετική = ανοδική τάση, Αρνητική = καθοδική τάση, Ουδέτερη = σταθερή.',
                trendDirectionTooltip: 'Η γενική κατεύθυνση των πωλήσεων. Ανοδική = αύξηση, Καθοδική = μείωση, Σταθερή = χωρίς αλλαγή.',
                riskLevelTooltip: 'Αξιολόγηση κινδύνου βάσει αστάθειας πωλήσεων. Υψηλό = μεγάλος κίνδυνος, Χαμηλό = ασφαλής.',
                recoveryRateTooltip: 'Πόσο γρήγορα ανακάμπτει η επιχείρηση από δύσκολες περιόδους. Υψηλός = γρήγορη ανάκαμψη.',
                forecastAccuracyTooltip: 'Πόσο ακριβείς είναι οι προβλέψεις του AI μοντέλου μας. Υψηλή ακρίβεια = αξιόπιστες προβλέψεις.',
                nextQuarterOutlookTooltip: 'Πώς αναμένουμε να πάει η επιχείρηση τους επόμενους 3 μήνες. Βασίζεται στα τρέχοντα δεδομένα.',
                seasonalityImpactTooltip: 'Πόσο επηρεάζουν οι εποχές τις πωλήσεις. Υψηλή = μεγάλη διακύμανση ανά εποχή.',
                modelConfidenceTooltip: 'Πόσο σίγουρο είναι το AI για τις προβλέψεις του. Υψηλή εμπιστοσύνη = αξιόπιστα αποτελέσματα.',
                
                // Theme names
                themeSelection: 'Επιλογή Θέματος',
                selectStyle: 'Επιλογή Στυλ',
                themeClassic: 'Κλασικό',
                themeClassicDesc: 'Το αρχικό μπλε θέμα',
                themeDark: 'Σκοτεινό',
                themeDarkDesc: 'Μαύρο και στυλάτο',
                themeOcean: 'Ωκεανός',
                themeOceanDesc: 'Μπλε και γαλάζιο',
                themeSunset: 'Ηλιοβασίλεμα',
                themeSunsetDesc: 'Πορτοκαλί και ροζ',
                themeForest: 'Δάσος',
                themeForestDesc: 'Πράσινο και φυσικό',
                themeRoyal: 'Βασιλικό',
                themeRoyalDesc: 'Μοβ και πολυτελές',
                themeFire: 'Φωτιά',
                themeFireDesc: 'Κόκκινο και δυναμικό',
                themeGold: 'Χρυσό',
                themeGoldDesc: 'Πορτοκαλί και ζεστό',
                themeIce: 'Παγωμένο',
                themeIceDesc: 'Γαλάζιο και κρύο',
                themeApplied: 'εφαρμόστηκε!',
                selectFavoriteTheme: 'Επιλέξτε το αγαπημένο σας θέμα!',
                themePanelHidden: 'Πάνελ θεμάτων κρύφτηκε',
                
                // Goals & Targets
                goalsTargetsTitle: 'Στόχοι & Επιδόσεις',
                manageGoals: 'Διαχείριση Στόχων',
                goalCategory: 'Κατηγορία',
                goalTarget: 'Στόχος',
                goalPeriod: 'Περίοδος',
                allCategories: 'Όλες οι Κατηγορίες',
                monthly: 'Μηνιαίος',
                quarterly: 'Τριμηνιαίος',
                yearly: 'Ετήσιος',
                addGoal: 'Προσθήκη',
                goalAdded: 'προστέθηκε!',
                goalDeleted: 'Στόχος διαγράφηκε!',
                goalsPanelHidden: 'Πάνελ στόχων κρύφτηκε',
                setYourGoals: 'Ορίστε τους στόχους σας!',
                noGoalsYet: 'Δεν έχετε ορίσει στόχους ακόμα. Προσθέστε τον πρώτο σας στόχο!',
                enterValidTarget: 'Παρακαλώ εισάγετε έγκυρο στόχο.',
                targetPlaceholder: 'π.χ. 50000',
                goalStatus: 'Κατάσταση',
                achieved: 'Επιτεύχθηκε',
                inProgress: 'Σε Εξέλιξη',
                atRisk: 'Κίνδυνος',
                targetLabel: 'Στόχος:',
                currentLabel: 'Τρέχον:',
                ofTarget: 'του στόχου',
                deleteGoal: 'Διαγραφή',
                deleteGoalTooltip: 'Διαγραφή στόχου',
                smartSuggestions: 'Έξυπνες Προτάσεις',
                smartSuggestionsTooltip: 'Έξυπνες προτάσεις στόχων βασισμένες στα δεδομένα σας',
                
                // Cell editing notifications
                valueUpdated: 'Τιμή ενημερώθηκε!',
                categoryNameUpdated: 'Όνομα κατηγορίας ενημερώθηκε!',
                excelExportCompleted: 'Εξαγωγή Excel ολοκληρώθηκε!',
                pdfExportCompleted: 'Εξαγωγή PDF ολοκληρώθηκε!',
                
                // Footer Terms Translations
                terms_policies: 'Όροι & Πολιτικές',
                support: 'Υποστήριξη',
                company: 'Εταιρεία',
                terms_of_use: 'Όροι Χρήσης',
                privacy_policy: 'Πολιτική Απορρήτου',
                refund_policy: 'Πολιτική Επιστροφών',
                contact_us: 'Επικοινωνία',
                help_center: 'Κέντρο Βοήθειας',
                faq: 'Συχνές Ερωτήσεις',
                copyright: '© 2025 Business Tracker. Όλα τα δικαιώματα διατηρούνται.',
                secure_encrypted: '🔒 Ασφαλές & Κρυπτογραφημένο',
                terms_title: 'Όροι Χρήσης',
                terms_section1: 'Περιγραφή Υπηρεσίας',
                terms_desc1: 'Οι πληροφορίες, στατιστικά και προβλέψεις που παρουσιάζονται σε αυτήν την ιστοσελίδα παρέχονται αποκλειστικά για ενημερωτικούς σκοπούς.Παρά τις προσπάθειες για την εξασφάλιση της ακρίβειας των δεδομένων, δεν παρέχεται καμία εγγύηση ως προς την πληρότητα, ακρίβεια ή επικαιρότητά τους. Ο δημιουργός/ιδιοκτήτης της ιστοσελίδας δεν φέρει καμία ευθύνη για οποιαδήποτε ζημιά ή απώλεια, άμεση ή έμμεση, που ενδέχεται να προκύψει από τη χρήση ή την ερμηνεία των στοιχείων που παρέχονται.Με την πρόσβαση και χρήση της παρούσας ιστοσελίδας αποδέχεστε ότι ενεργείτε αποκλειστικά με δική σας ευθύνη. ',
                terms_section2: 'Όροι Πληρωμής',
                terms_desc2: 'Η πληρωμή επεξεργάζεται μηνιαίως μέσω Stripe. Η συνδρομή θα ανανεώνεται αυτόματα εκτός αν ακυρωθεί πριν την ημερομηνία ανανέωσης.',
                terms_section3: 'Πολιτική Ακύρωσης',
                terms_desc3: 'Μπορείτε να ακυρώσετε τη συνδρομή σας οποιαδήποτε στιγμή μέσω της σελίδας συνδρομής. Δεν θα παρασχεθούν επιστροφές χρημάτων για μερική χρήση του μήνα.',
                terms_section4: 'Ευθύνες Χρήστη',
                terms_desc4: 'Οι χρήστες είναι υπεύθυνοι για τη διατήρηση της ασφάλειας του λογαριασμού, την ακρίβεια των δεδομένων και την τήρηση των κανόνων της πλατφόρμας.',
                privacy_title: 'Πολιτική Απορρήτου',
                privacy_section1: 'Συλλογή Δεδομένων',
                privacy_desc1: 'Συλλέγουμε επιχειρηματικά δεδομένα που εισάγετε, αναλυτικά χρήσης και πληροφορίες λογαριασμού απαραίτητες για την παροχή υπηρεσιών.',
                privacy_section2: 'Χρήση Δεδομένων',
                privacy_desc2: 'Τα επιχειρηματικά σας δεδομένα χρησιμοποιούνται αποκλειστικά για την παροχή αναλυτικών, προβλέψεων και insights. Δεν μοιραζόμαστε ή πουλάμε τις επιχειρηματικές σας πληροφορίες.',
                privacy_section3: 'Ασφάλεια Δεδομένων',
                privacy_desc3: 'Όλα τα δεδομένα κρυπτογραφούνται και αποθηκεύονται με ασφάλεια στο Firebase με μέτρα ασφαλείας βιομηχανικού επιπέδου. Τα τοπικά δεδομένα αποθηκεύονται μόνο στον browser σας.',
                privacy_section4: 'Τα Δικαιώματά Σας',
                privacy_desc4: 'Έχετε το δικαίωμα να εξάγετε, να τροποποιήσετε ή να διαγράψετε τα επιχειρηματικά σας δεδομένα ανά πάσα στιγμή μέσω του dashboard ή επικοινωνώντας με την υποστήριξη.',
                refund_title: 'Πολιτική Επιστροφών',
                refund_section1: 'Γενική Πολιτική',
                refund_desc1: 'Λόγω της φύσης της υπηρεσίας analytics, οι επιστροφές χρημάτων εξετάζονται σε κάθε περίπτωση ξεχωριστά για τεχνικά προβλήματα που εμποδίζουν τη χρήση της υπηρεσίας.',
                refund_section2: 'Δοκιμαστική Περίοδος',
                refund_desc2: 'Αν έχετε ενεργή δοκιμή, μπορείτε να ακυρώσετε πριν τελειώσει για να αποφύγετε χρεώσεις. Επικοινωνήστε με την υποστήριξη για βοήθεια με τη διαχείριση της δοκιμής.',
                refund_section3: 'Ειδικές Περιστάσεις',
                refund_desc3: 'Οι επιστροφές χρημάτων μπορεί να παρασχεθούν για επιβεβαιωμένα τεχνικά προβλήματα, σφάλματα χρέωσης ή διακοπές υπηρεσίας που επηρεάζουν τη δυνατότητά σας να χρησιμοποιήσετε την πλατφόρμα.',
                refund_section4: 'Επικοινωνία Υποστήριξης',
                refund_desc4: 'Για αιτήματα επιστροφής χρημάτων, επικοινωνήστε με την ομάδα υποστήριξής μας με τα στοιχεία του λογαριασμού σας, πληροφορίες συνδρομής και λεπτομερή αιτιολόγηση του αιτήματος.',
                contact_title: 'Επικοινωνία Υποστήριξης',
                contact_email: 'Υποστήριξη Email',
                contact_response: 'Απάντηση εντός 24 ωρών',
                contact_live: 'Live Chat',
                contact_available: 'Διαθέσιμο Δευτέρα-Παρασκευή 9πμ-6μμ EST',
                contact_start_chat: 'Ξεκινήστε Chat',
                contact_phone: 'Τεχνική Υποστήριξη',
                contact_business: 'Μόνο ώρες λειτουργίας',
                help_title: 'Κέντρο Βοήθειας',
                help_data: '📊 Διαχείριση Δεδομένων',
                help_data_desc: 'Προσθήκη δεδομένων, επεξεργασία τιμών, εισαγωγή/εξαγωγή',
                help_analytics: '📈 Analytics & Γραφήματα',
                help_analytics_desc: 'Κατανόηση γραφημάτων, προβλέψεις, insights',
                help_account: '👤 Λογαριασμός & Χρέωση',
                help_account_desc: 'Διαχείριση συνδρομής, χρέωση, ρυθμίσεις λογαριασμού',
                help_technical: '⚙️ Τεχνική Υποστήριξη',
                help_technical_desc: 'Προβλήματα browser, απόδοση, αντιμετώπιση προβλημάτων',
                faq_title: 'Συχνές Ερωτήσεις',
                faq_q1: 'Πώς προσθέτω δεδομένα πωλήσεων;',
                faq_a1: 'Κάντε κλικ σε οποιοδήποτε κελί του πίνακα για να επεξεργαστείτε τιμές απευθείας. Χρησιμοποιήστε το κουμπί "Προσθήκη Κατηγορίας" για νέες κατηγορίες προϊόντων.',
                faq_q2: 'Πόσο ακριβείς είναι οι προβλέψεις;',
                faq_a2: 'Οι προβλέψεις χρησιμοποιούν προηγμένους αλγόριθμους που συνδυάζουν ανάλυση τάσεων, εποχιακά μοτίβα και ιστορικά δεδομένα. Η ακρίβεια βελτιώνεται με περισσότερα δεδομένα.',
                faq_q3: 'Μπορώ να εξάγω τα δεδομένα μου;',
                faq_a3: 'Ναι, χρησιμοποιήστε τα κουμπιά Εξαγωγής για να κατεβάσετε τα δεδομένα σας σε μορφή Excel ή PDF. Τα δεδομένα σας αποθηκεύονται επίσης αυτόματα.',
                faq_q4: 'Τι είναι τα Smart Insights;',
                faq_a4: 'Ανάλυση με τεχνητή νοημοσύνη που εντοπίζει αυτόματα τάσεις, ευκαιρίες και πιθανά προβλήματα στα επιχειρηματικά σας δεδομένα.',
                faq_q5: 'Είναι ασφαλή τα επιχειρηματικά μου δεδομένα;',
                faq_a5: 'Ναι, όλα τα δεδομένα κρυπτογραφούνται και αποθηκεύονται με ασφάλεια. Μπορείτε επίσης να εργαστείτε offline με τοπική αποθήκευση ως backup.',
                chat_starting: 'Ξεκινά το live chat...',
                chat_demo: 'Live chat demo - Επικοινωνήστε με την υποστήριξη για πραγματική βοήθεια',
                
                // Comparison and forecast notifications
                noDataFoundForCategory: 'Δεν βρέθηκαν δεδομένα για την κατηγορία',
                noDataFoundForCategoryYear: 'Δεν βρέθηκαν δεδομένα για την κατηγορία',
                selectCategoryForForecast: 'Παρακαλώ επιλέξτε κατηγορία για πρόβλεψη.',
                noChartToDownload: 'Δεν υπάρχει γράφημα για λήψη.',
                chartDownloadedSuccessfully: 'Το γράφημα κατέβηκε επιτυχώς!',
                
                // System notifications
                advancedAnalyticsActivated: 'Προηγμένη Ανάλυση ενεργοποιήθηκε!',
                keyboardShortcutsNew: 'Νέο: Συντομεύσεις πληκτρολογίου! Πατήστε H για βοήθεια',
                autoUpdateSystemActive: 'Σύστημα Αυτόματης Ενημέρωσης ενεργό!',
                liveUpdatesActive: 'Ζωντανές Ενημερώσεις: Κάθε αλλαγή ενημερώνει αυτόματα!',
                dataRefreshed: 'Δεδομένα ανανεώθηκαν!',
                memoryClearedShortcut: 'Μνήμη καθαρίστηκε',
                keyboardShortcutsShown: 'Συντομεύσεις πληκτρολογίου εμφανίστηκαν!',
                dataSavedShortcut: 'Δεδομένα αποθηκεύτηκαν!',
                modalsClosed: 'Τα παράθυρα έκλεισαν',
                
                // Additional system notifications
                forecastCompleted: 'Πρόβλεψη ολοκληρώθηκε!',
                forecastCompletedMonths: 'Πρόβλεψη {months} μηνών ολοκληρώθηκε!',
                welcome: 'Καλώς ήρθες',
                saved: 'Αποθηκεύτηκε:',
                memory: 'Μνήμη:',
                chart: 'Γράφημα:',
                statsCard: 'Κάρτα στατιστικών ✨',
                chartViewToggle: 'Εναλλαγή προβολής γραφήματος 📊',
                connectionRestored: 'Σύνδεση αποκαταστάθηκε! 🌐',
                offlineMode: 'Λειτουργία εκτός σύνδεσης 📴',
                dataSynced: 'Συγχρονίστηκαν δεδομένα! 🔄',
                newVersionAvailable: 'Νέα έκδοση διαθέσιμη! 🔄',
                installationStarted: 'Εγκατάσταση ξεκίνησε! 🎉',
                
                // Language selection
                selectLanguage: 'Επιλέξτε Γλώσσα',
                languageChanged: 'Η γλώσσα άλλαξε επιτυχώς!',
                
                // Keyboard shortcuts
                keyboardShortcuts: 'Πλήκτρα Συντόμευσης',
                shortcutGeneral: 'Γενικά',
                shortcutCharts: 'Γραφήματα',
                shortcutExport: 'Εξαγωγή',
                shortcutTools: 'Εργαλεία',
                shortcutNewCategory: 'Νέα Κατηγορία',
                shortcutSave: 'Αποθήκευση',
                shortcutDarkMode: 'Dark Mode',
                shortcutCloseModal: 'Κλείσιμο Modal',
                shortcutChangeChartType: 'Αλλαγή Τύπου Γραφήματος',
                shortcutForecast: 'Πρόβλεψη',
                shortcutComparison: 'Σύγκριση',
                shortcutGoals: 'Στόχοι',
                shortcutExcel: 'Excel',
                shortcutPDF: 'PDF',
                shortcutDownloadChart: 'Λήψη Γραφήματος',
                shortcutCalculator: 'Αριθμομηχανή',
                shortcutThisMenu: 'Αυτό το Μενού',
                shortcutChangeTheme: 'Αλλαγή Θέματος',
                shortcutRefreshInsights: 'Ανανέωση AI Insights',
                shortcutToggleAnalytics: 'Toggle Analytics',
                shortcutToggleInsights: 'Toggle AI Insights',
                shortcutHelp: 'Βοήθεια (Αυτό το Μενού)',
                
                // Floating button tooltip
                shortcutsTooltip: 'Ctrl + ? για Shortcuts',
                
                // Language toggle
                changeToEnglish: 'Αλλαγή σε Αγγλικά',
                changeToGreek: 'Change to Greek'
            },
            en: {
                // UI Elements
                welcome: 'Welcome',
                user: 'User',
                actions: 'Actions',
                exportExcel: 'Export Excel',
                exportPdf: 'Export PDF',
                goalsTargets: 'Goals & Targets',
                subscription: 'Subscription',
                changeTheme: 'Change Theme',
                changeLanguage: 'Change Language',
                calculator: 'Calculator',
                shortcuts: 'Keyboard Shortcuts',
                resetTheme: 'Reset Default',
                calculatorActivated: 'Calculator activated!',
                logout: 'Logout',
                statisticsCenter: 'Statistics Center',
                categoryName: 'Category Name',
                add: 'Add',
                
                // Months
                months: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                
                // Table headers
                category: 'Category',
                total: 'Total',
                actions_table: 'Actions',
                
                // Messages
                categoryExists: 'Category already exists!',
                categoryAdded: 'Category added successfully!',
                categoryDeleted: 'Category deleted!',
                dataExported: 'Data exported successfully!',
                
                // Chart
                salesChart: 'Sales Chart',
                selectCategory: 'Select category',
                allCategories: 'All Categories',
                chartLine: 'Line Chart',
                chartBar: 'Bar Chart',
                chartDoughnut: 'Doughnut Chart',
                comparison: 'Comparison',
                forecast: 'AI Forecast',
                downloadChart: 'Chart',
                
                // Notifications
                selectCategoryComparison: 'Please select a category for comparison.',
                comparisonCompleted: 'Comparison completed!',
                
                // Forecast popup
                forecastAnalysis: 'Forecast Analysis',
                months_period: 'Months',
                period: 'Period',
                totalForecast: 'Total Forecast',
                avgPerMonth: 'Average/Month',
                confidence: 'Confidence',
                trend: 'Trend',
                trendUp: 'Upward',
                trendDown: 'Downward',
                maxValue: 'Maximum Value',
                forecastNote: 'Forecast combines trend analysis, seasonal patterns and exponential smoothing',
                forecastDisclaimer: 'Note: Longer periods have lower accuracy',
                close: 'Close',
                
                // Tooltips
                totalSalesTooltip: 'Sum of all sales for the selected period. Shows total business performance.',
                avgSalesTooltip: 'Average sales per month. Helps calculate monthly performance and compare with targets.',
                bestMonthTooltip: 'Month with highest sales. Useful for identifying seasonal trends and peak periods.',
                growthTooltip: 'Percentage change in sales compared to previous period. Positive = growth, Negative = decline.',
                performanceTooltip: 'Score showing how efficient the business is. Calculated from growth and stability.',
                seasonalityTooltip: 'Measures how much sales are affected by seasonal changes. High value = large seasonal variation.',
                trendStrengthTooltip: 'Shows how strong the growth or decline trend is. High = steady trend, Low = unstable performance.',
                volatilityTooltip: 'Measures how unstable sales are. High volatility = unpredictable changes, Low = stable sales.',
                
                // Forecast periods
                forecastShortTerm: 'Short-term (3 months) - High accuracy',
                forecastMediumTerm: 'Medium-term (6 months) - Good accuracy',
                forecastLongTerm: 'Annual forecast (12 months) - Moderate accuracy',
                forecastExtended: 'Long-term (2 years) - Estimated',
                forecastPeriodLabel: 'Forecast Period:',
                forecastTooltip: 'Select how many months in the future you want to predict sales',
                forecastAccuracyNote: 'Shorter periods = higher forecast accuracy',
                categorySelectionLabel: 'Category Selection:',
                
                // Forecast chart labels
                trendForecastLabel: 'Trend Forecast',
                seasonalForecastLabel: 'Seasonal Forecast',
                optimizedForecastLabel: 'Optimized Forecast',
                
                // Stat card labels
                totalSalesLabel: 'Total Sales',
                avgSalesLabel: 'Average',
                bestMonthLabel: 'Best Month',
                growthRateLabel: 'Growth Rate',
                performanceLabel: 'Performance Score',
                seasonalityLabel: 'Seasonality',
                trendStrengthLabel: 'Trend Strength',
                volatilityLabel: 'Volatility',
                
                // Trend strength values
                strongUpward: 'Strong Upward',
                strongDownward: 'Strong Downward',
                moderateUpward: 'Moderate Upward',
                moderateDownward: 'Moderate Downward',
                weakUpward: 'Weak Upward',
                weakDownward: 'Weak Downward',
                sideways: 'Sideways',
                insufficientData: 'Insufficient Data',
                
                // AI Insights
                smartInsights: 'Smart AI Insights',
                viewDetails: 'View Details',
                hideDetails: 'Hide Details',
                aiAnalyzing: 'AI is analyzing your data...',
                refreshAnalysis: 'Refresh Analysis',
                
                // Insight titles and actions
                explosiveGrowth: 'Explosive Growth',
                positivetrend: 'Positive Trend',
                sharpDecline: 'Sharp Decline',
                downwardTrend: 'Downward Trend',
                strongSeasonality: 'Strong Seasonality',
                winterDemand: 'Winter Demand',
                summerPeak: 'Summer Peak',
                springGrowth: 'Spring Growth',
                autumnSlowdown: 'Autumn Slowdown',
                stagnation: 'Stagnation',
                volatility: 'High Volatility',
                marketLeader: 'Market Leader',
                underperformer: 'Underperformer',
                balancedPortfolio: 'Balanced Portfolio',
                concentrationRisk: 'Concentration Risk',
                
                // Insight actions
                increaseInventory: 'Recommended: Increase inventory and marketing budget for this category',
                maintainStrategy: 'Recommended: Maintain current strategy',
                immediateAction: 'Immediate action: Analyze causes and revise strategy',
                reviewMarketing: 'Recommended: Consider new marketing strategies',
                prepareInventory: 'Schedule inventory increase before',
                holidayOffers: 'Prepare special holiday offers',
                summerCampaign: 'Design summer marketing campaign',
                springPromotion: 'Leverage spring energy with new products',
                autumnStrategy: 'Prepare autumn strategy',
                findGrowthOpportunities: 'Look for growth opportunities',
                stabilizeOperations: 'Focus on stabilizing operations',
                capitalizeSuccess: 'Capitalize on this category\'s success',
                improvePerformance: 'Improve this category\'s performance',
                maintainBalance: 'Maintain balance in your portfolio',
                diversifyPortfolio: 'Diversify your portfolio',
                
                // Advanced Analytics
                advancedAnalytics: 'Advanced Analytics',
                performanceMetrics: 'Performance Metrics',
                marketAnalysis: 'Market Analysis',
                predictiveEstimates: 'Predictive Estimates',
                
                // Performance metrics
                quarterlyGrowth: 'Quarterly Growth:',
                annualGrowth: 'Annual Growth:',
                maxPerformance: 'Peak Performance:',
                consistencyScore: 'Consistency Score:',
                
                // Market analysis
                marketMomentum: 'Market Momentum:',
                trendDirection: 'Trend Direction:',
                riskLevel: 'Risk Level:',
                recoveryRate: 'Recovery Rate:',
                
                // Predictive estimates
                forecastAccuracy: 'Forecast Accuracy:',
                nextQuarterOutlook: 'Next Quarter Outlook:',
                seasonalityImpact: 'Seasonality Impact:',
                modelConfidence: 'Model Confidence:',
                
                // Values for analytics
                neutral: 'Neutral',
                positive: 'Positive',
                negative: 'Negative',
                stable: 'Stable',
                upward: 'Upward',
                downward: 'Downward',
                high: 'High',
                medium: 'Medium',
                low: 'Low',
                excellent: 'Excellent',
                good: 'Good',
                poor: 'Poor',
                
                // Extended values for analytics
                strongPositive: 'Strongly Positive',
                strongNegative: 'Strongly Negative',
                strongUpward: 'Strongly Upward',
                veryHigh: 'Very High',
                veryPositive: 'Very Positive',
                cautious: 'Cautious',
                neutral2: 'Neutral',
                minimal: 'Minimal',
                veryHigh2: 'Very High',
                
                // Tooltips for Advanced Analytics
                quarterlyGrowthTooltip: 'Percentage change in sales compared to the previous quarter. Shows short-term trends.',
                annualGrowthTooltip: 'Percentage change in sales compared to the same period last year. Shows long-term trends.',
                maxPerformanceTooltip: 'The best monthly performance on record. Useful for setting realistic targets.',
                consistencyScoreTooltip: 'How stable our sales are. High score = predictable performance, Low = unstable.',
                marketMomentumTooltip: 'The general direction of the market. Positive = upward trend, Negative = downward trend, Neutral = stable.',
                trendDirectionTooltip: 'The general direction of sales. Upward = increase, Downward = decrease, Stable = no change.',
                riskLevelTooltip: 'Risk assessment based on sales volatility. High = high risk, Low = safe.',
                recoveryRateTooltip: 'How quickly the business recovers from difficult periods. High = fast recovery.',
                forecastAccuracyTooltip: 'How accurate our AI model predictions are. High accuracy = reliable forecasts.',
                nextQuarterOutlookTooltip: 'How we expect the business to perform in the next 3 months. Based on current data.',
                seasonalityImpactTooltip: 'How much seasons affect sales. High = large seasonal variation.',
                modelConfidenceTooltip: 'How confident the AI is about its predictions. High confidence = reliable results.',
                
                // Theme names
                themeSelection: 'Theme Selection',
                selectStyle: 'Select Style',
                themeClassic: 'Classic',
                themeClassicDesc: 'The original blue theme',
                themeDark: 'Dark',
                themeDarkDesc: 'Black and stylish',
                themeOcean: 'Ocean',
                themeOceanDesc: 'Blue and aqua',
                themeSunset: 'Sunset',
                themeSunsetDesc: 'Orange and pink',
                themeForest: 'Forest',
                themeForestDesc: 'Green and natural',
                themeRoyal: 'Royal',
                themeRoyalDesc: 'Purple and luxurious',
                themeFire: 'Fire',
                themeFireDesc: 'Red and dynamic',
                themeGold: 'Gold',
                themeGoldDesc: 'Orange and warm',
                themeIce: 'Ice',
                themeIceDesc: 'Light blue and cold',
                themeApplied: 'applied!',
                selectFavoriteTheme: 'Select your favorite theme!',
                themePanelHidden: 'Theme panel hidden',
                
                // Goals & Targets  
                goalsTargetsTitle: 'Goals & Performance',
                manageGoals: 'Manage Goals',
                goalCategory: 'Category',
                goalTarget: 'Target',
                goalPeriod: 'Period',
                allCategories: 'All Categories',
                monthly: 'Monthly',
                quarterly: 'Quarterly',
                yearly: 'Yearly',
                addGoal: 'Add',
                goalAdded: 'added!',
                goalDeleted: 'Goal deleted!',
                goalsPanelHidden: 'Goals panel hidden',
                setYourGoals: 'Set your goals!',
                noGoalsYet: 'You haven\'t set any goals yet. Add your first goal!',
                enterValidTarget: 'Please enter a valid target.',
                targetPlaceholder: 'e.g. 50000',
                goalStatus: 'Status',
                achieved: 'Achieved',
                inProgress: 'In Progress',
                atRisk: 'At Risk',
                targetLabel: 'Target:',
                currentLabel: 'Current:',
                ofTarget: 'of target',
                deleteGoal: 'Delete',
                deleteGoalTooltip: 'Delete goal',
                smartSuggestions: 'Smart Suggestions',
                smartSuggestionsTooltip: 'Smart goal suggestions based on your data',
                
                // Cell editing notifications
                valueUpdated: 'Value updated!',
                categoryNameUpdated: 'Category name updated!',
                excelExportCompleted: 'Excel export completed!',
                pdfExportCompleted: 'PDF export completed!',
                
                // Footer Terms Translations
                terms_policies: 'Terms & Policies',
                support: 'Support',
                company: 'Company',
                terms_of_use: 'Terms of Use',
                privacy_policy: 'Privacy Policy',
                refund_policy: 'Refund Policy',
                contact_us: 'Contact Us',
                help_center: 'Help Center',
                faq: 'FAQ',
                copyright: '© 2025 Business Tracker. All rights reserved.',
                secure_encrypted: '🔒 Secure & Encrypted',
                terms_title: 'Terms of Use',
                terms_section1: 'Service Description',
                terms_desc1: 'This service provides business analytics and tracking tools for a monthly subscription fee. The service includes comprehensive data analysis and forecasting capabilities.',
                terms_section2: 'Payment Terms',
                terms_desc2: 'Payment is processed monthly via Stripe. The subscription will automatically renew unless cancelled before the renewal date.',
                terms_section3: 'Cancellation Policy',
                terms_desc3: 'You may cancel your subscription at any time through the subscription page. No refunds will be provided for partial month usage.',
                terms_section4: 'User Responsibilities',
                terms_desc4: 'Users are responsible for maintaining account security, data accuracy, and following platform guidelines.',
                privacy_title: 'Privacy Policy',
                privacy_section1: 'Data Collection',
                privacy_desc1: 'We collect business data that you input, usage analytics, and account information necessary for service provision.',
                privacy_section2: 'Data Usage',
                privacy_desc2: 'Your business data is used solely for providing analytics, forecasting, and insights. We do not share or sell your business information.',
                privacy_section3: 'Data Security',
                privacy_desc3: 'All data is encrypted and stored securely in Firebase with industry-standard security measures. Local data is stored in your browser only.',
                privacy_section4: 'Your Rights',
                privacy_desc4: 'You have the right to export, modify, or delete your business data at any time through the dashboard or by contacting support.',
                refund_title: 'Refund Policy',
                refund_section1: 'General Policy',
                refund_desc1: 'Due to the nature of our analytics service, refunds are considered on a case-by-case basis for technical issues that prevent service use.',
                refund_section2: 'Trial Period',
                refund_desc2: 'If you have an active trial, you can cancel before it ends to avoid charges. Contact support for assistance with trial management.',
                refund_section3: 'Special Circumstances',
                refund_desc3: 'Refunds may be provided for verified technical issues, billing errors, or service outages affecting your ability to use the platform.',
                refund_section4: 'Contact Support',
                refund_desc4: 'For refund requests, contact our support team with your account details, subscription information, and detailed reason for the request.',
                contact_title: 'Contact Support',
                contact_email: 'Email Support',
                contact_response: 'Response within 24 hours',
                contact_live: 'Live Chat',
                contact_available: 'Available Monday-Friday 9AM-6PM EST',
                contact_start_chat: 'Start Chat',
                contact_phone: 'Technical Support',
                contact_business: 'Business hours only',
                help_title: 'Help Center',
                help_data: '📊 Data Management',
                help_data_desc: 'Adding data, editing values, importing/exporting',
                help_analytics: '📈 Analytics & Charts',
                help_analytics_desc: 'Understanding charts, forecasting, insights',
                help_account: '👤 Account & Billing',
                help_account_desc: 'Subscription management, billing, account settings',
                help_technical: '⚙️ Technical Support',
                help_technical_desc: 'Browser issues, performance, troubleshooting',
                faq_title: 'Frequently Asked Questions',
                faq_q1: 'How do I add sales data?',
                faq_a1: 'Click on any cell in the table to edit values directly. Use the "Add Category" button to create new product categories.',
                faq_q2: 'How accurate are the forecasts?',
                faq_a2: 'Forecasts use advanced algorithms combining trend analysis, seasonal patterns, and historical data. Accuracy improves with more data.',
                faq_q3: 'Can I export my data?',
                faq_a3: 'Yes, use the Export buttons to download your data in Excel or PDF format. Your data is also automatically saved.',
                faq_q4: 'What are Smart Insights?',
                faq_a4: 'AI-powered analysis that identifies trends, opportunities, and potential issues in your business data automatically.',
                faq_q5: 'Is my business data secure?',
                faq_a5: 'Yes, all data is encrypted and stored securely. You can also work offline with local storage as backup.',
                chat_starting: 'Starting live chat...',
                chat_demo: 'Live chat demo - Contact support for real assistance',
                
                // Comparison and forecast notifications
                noDataFoundForCategory: 'No data found for category',
                noDataFoundForCategoryYear: 'No data found for category',
                selectCategoryForForecast: 'Please select a category for forecast.',
                noChartToDownload: 'No chart available for download.',
                chartDownloadedSuccessfully: 'Chart downloaded successfully!',
                
                // System notifications
                advancedAnalyticsActivated: 'Advanced Analytics activated!',
                keyboardShortcutsNew: 'New: Keyboard shortcuts! Press H for help',
                autoUpdateSystemActive: 'Auto-Update System active!',
                liveUpdatesActive: 'Live Updates: Every change updates automatically!',
                dataRefreshed: 'Data refreshed!',
                memoryClearedShortcut: 'Memory cleared',
                keyboardShortcutsShown: 'Keyboard shortcuts shown!',
                dataSavedShortcut: 'Data saved!',
                modalsClosed: 'Modals closed',
                
                // Additional system notifications
                forecastCompleted: 'Forecast completed!',
                forecastCompletedMonths: 'Forecast {months} months completed!',
                welcome: 'Welcome',
                saved: 'Saved:',
                memory: 'Memory:',
                chart: 'Chart:',
                statsCard: 'Stats card ✨',
                chartViewToggle: 'Chart view toggle 📊',
                connectionRestored: 'Connection restored! 🌐',
                offlineMode: 'Offline mode 📴',
                dataSynced: 'Data synced! 🔄',
                newVersionAvailable: 'New version available! 🔄',
                installationStarted: 'Installation started! 🎉',
                
                // Language selection
                selectLanguage: 'Select Language',
                languageChanged: 'Language changed successfully!',
                
                // Keyboard shortcuts
                keyboardShortcuts: 'Keyboard Shortcuts',
                shortcutGeneral: 'General',
                shortcutCharts: 'Charts',
                shortcutExport: 'Export',
                shortcutTools: 'Tools',
                shortcutNewCategory: 'New Category',
                shortcutSave: 'Save',
                shortcutDarkMode: 'Dark Mode',
                shortcutCloseModal: 'Close Modal',
                shortcutChangeChartType: 'Change Chart Type',
                shortcutForecast: 'Forecast',
                shortcutComparison: 'Comparison',
                shortcutGoals: 'Goals',
                shortcutExcel: 'Excel',
                shortcutPDF: 'PDF',
                shortcutDownloadChart: 'Download Chart',
                shortcutCalculator: 'Calculator',
                shortcutThisMenu: 'This Menu',
                shortcutChangeTheme: 'Change Theme',
                shortcutRefreshInsights: 'Refresh AI Insights',
                shortcutToggleAnalytics: 'Toggle Analytics',
                shortcutToggleInsights: 'Toggle AI Insights',
                shortcutHelp: 'Help (This Menu)',
                
                // Floating button tooltip
                shortcutsTooltip: 'Ctrl + ? for Shortcuts',
                
                // Language toggle
                changeToEnglish: 'Change to English',
                changeToGreek: 'Αλλαγή σε Ελληνικά'
            }
        };
        
        // Static month keys for data storage (never change these)
        const monthKeys = ['Ιαν', 'Φεβ', 'Μαρ', 'Απρ', 'Μάι', 'Ιουν', 'Ιουλ', 'Αυγ', 'Σεπ', 'Οκτ', 'Νοε', 'Δεκ'];
        
        // Dynamic month labels for display (changes with language)
        let months = translations[currentLanguage].months;
        
        const modernColors = [
            '#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe',
            '#43e97b', '#38f9d7', '#ffecd2', '#fcb69f', '#a8edea', '#fed6e3'
        ];

        // Utility functions
        const saveToLocalStorage = () => {
            localStorage.setItem('salesData', JSON.stringify(salesData));
            console.log('✅ Data saved to localStorage');
        };

        const updateTooltips = () => {
            const t = translations[currentLanguage];
            
            // Stats card tooltips
            const statCards = document.querySelectorAll('.stat-card');
            if (statCards.length >= 8) {
                statCards[0].setAttribute('data-tooltip', `💰 ${t.totalSalesTooltip}`);
                statCards[1].setAttribute('data-tooltip', `📊 ${t.avgSalesTooltip}`);
                statCards[2].setAttribute('data-tooltip', `🏆 ${t.bestMonthTooltip}`);
                statCards[3].setAttribute('data-tooltip', `📈 ${t.growthTooltip}`);
                statCards[4].setAttribute('data-tooltip', `💹 ${t.performanceTooltip}`);
                statCards[5].setAttribute('data-tooltip', `🌊 ${t.seasonalityTooltip}`);
                statCards[6].setAttribute('data-tooltip', `📊 ${t.trendStrengthTooltip}`);
                statCards[7].setAttribute('data-tooltip', `⚡ ${t.volatilityTooltip}`);
            }
            
            // Advanced Analytics tooltips
            const analyticsRows = document.querySelectorAll('[data-tooltip-key]');
            analyticsRows.forEach(row => {
                const tooltipKey = row.getAttribute('data-tooltip-key');
                if (t[tooltipKey]) {
                    // Add appropriate emoji prefix based on tooltip type
                    let emoji = '📊';
                    if (tooltipKey.includes('quarterly') || tooltipKey.includes('annual')) emoji = '📈';
                    if (tooltipKey.includes('maxPerformance')) emoji = '🏆';
                    if (tooltipKey.includes('consistency')) emoji = '🎯';
                    if (tooltipKey.includes('momentum')) emoji = '🚀';
                    if (tooltipKey.includes('trend')) emoji = '📊';
                    if (tooltipKey.includes('risk')) emoji = '⚠️';
                    if (tooltipKey.includes('recovery')) emoji = '💪';
                    if (tooltipKey.includes('forecast')) emoji = '🎯';
                    if (tooltipKey.includes('quarter')) emoji = '📅';
                    if (tooltipKey.includes('seasonality')) emoji = '🌦️';
                    if (tooltipKey.includes('model')) emoji = '🤖';
                    
                    row.setAttribute('data-tooltip', `${emoji} ${t[tooltipKey]}`);
                }
            });
        };

        const updateStatLabels = () => {
            const t = translations[currentLanguage];
            
            // Update stat card labels
            const totalSalesLabel = document.getElementById('totalSalesLabel');
            if (totalSalesLabel) totalSalesLabel.textContent = t.totalSalesLabel;
            
            const avgSalesLabel = document.getElementById('avgSalesLabel');
            if (avgSalesLabel) avgSalesLabel.textContent = t.avgSalesLabel;
            
            const bestMonthLabel = document.getElementById('bestMonthLabel');
            if (bestMonthLabel) bestMonthLabel.textContent = t.bestMonthLabel;
            
            const growthRateLabel = document.getElementById('growthRateLabel');
            if (growthRateLabel) growthRateLabel.textContent = t.growthRateLabel;
            
            const performanceLabel = document.getElementById('performanceLabel');
            if (performanceLabel) performanceLabel.textContent = `📈 ${t.performanceLabel}`;
            
            const seasonalityLabel = document.getElementById('seasonalityLabel');
            if (seasonalityLabel) seasonalityLabel.textContent = `🌊 ${t.seasonalityLabel}`;
            
            const trendStrengthLabel = document.getElementById('trendStrengthLabel');
            if (trendStrengthLabel) trendStrengthLabel.textContent = `📊 ${t.trendStrengthLabel}`;
            
            const volatilityLabel = document.getElementById('volatilityLabel');
            if (volatilityLabel) volatilityLabel.textContent = `⚡ ${t.volatilityLabel}`;
        };

        const updateForecastPeriodDropdown = () => {
            const t = translations[currentLanguage];
            const forecastSelect = document.getElementById('forecastPeriod');
            const forecastLabel = document.querySelector('label[for="forecastPeriod"]');
            const categoryLabel = document.querySelector('label[for="chartCategory"]');
            const forecastNote = forecastSelect?.nextElementSibling;
            
            if (forecastSelect) {
                const currentValue = forecastSelect.value || '3';
                forecastSelect.innerHTML = `
                    <option value="3">📅 ${t.forecastShortTerm} 🎯</option>
                    <option value="6">📊 ${t.forecastMediumTerm} ✅</option>
                    <option value="12">📈 ${t.forecastLongTerm} ⚖️</option>
                    <option value="24">🚀 ${t.forecastExtended} 🔍</option>
                `;
                forecastSelect.value = currentValue;
                forecastSelect.title = t.forecastTooltip;
            }
            
            if (forecastLabel) {
                forecastLabel.innerHTML = `🔮 ${t.forecastPeriodLabel}`;
            }
            
            if (categoryLabel) {
                categoryLabel.innerHTML = `📊 ${t.categorySelectionLabel}`;
            }
            
            if (forecastNote && forecastNote.tagName === 'SMALL') {
                forecastNote.textContent = `💡 ${t.forecastAccuracyNote}`;
            }
        };

        // Language functions
        const toggleLanguage = () => {
            const newLang = currentLanguage === 'el' ? 'en' : 'el';
            changeLanguage(newLang);
            
            // Show notification
            const message = newLang === 'el' ? '🇬🇷 Ελληνικά ενεργοποιήθηκαν!' : '🇺🇸 English activated!';
            showNotification(message, 'info', 2000);
        };

        const updateLanguageToggleButton = () => {
            const toggleButton = document.getElementById('languageToggle');
            const t = translations[currentLanguage];
            
            if (toggleButton) {
                if (currentLanguage === 'el') {
                    toggleButton.textContent = '🇺🇸';
                    toggleButton.title = t.changeToEnglish || 'Switch to English';
                } else {
                    toggleButton.textContent = '🇬🇷';
                    toggleButton.title = t.changeToGreek || 'Αλλαγή σε Ελληνικά';
                }
            }
        };

        const changeLanguage = (lang) => {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            document.documentElement.lang = lang;
            updateUILanguage();
            // Update display months without affecting data storage
            months = translations[currentLanguage].months;
            if (chart) {
                updateChart();
            }
            showNotification(translations[currentLanguage].languageChanged, 'success');
        };

        const updateUILanguage = () => {
            const t = translations[currentLanguage];
            
            // Update text content
            document.querySelector('.user-info span').innerHTML = `${t.welcome}, <b id="userDisplay">${t.user}</b>`;
            document.querySelector('#actionsDropdownBtn').innerHTML = `⚙️ ${t.actions} <span class="dropdown-arrow">▼</span>`;
            document.querySelector('h2').textContent = t.statisticsCenter;
            document.querySelector('#categoryName').placeholder = t.categoryName;
            document.querySelector('#addCategoryBtn').textContent = t.add;
            document.querySelector('#chartTitle').textContent = `📊 ${t.salesChart}`;
            
            // Update dropdown items
            const dropdownItems = document.querySelectorAll('.dropdown-item span:last-child');
            dropdownItems[0].textContent = t.exportExcel;
            dropdownItems[1].textContent = t.exportPdf;
            dropdownItems[2].textContent = t.goalsTargets;
            dropdownItems[3].textContent = t.changeTheme;
            dropdownItems[4].textContent = t.calculator;
            if (dropdownItems[5]) dropdownItems[5].textContent = t.shortcuts;
            
            // Update chart type buttons
            const lineBtn = document.getElementById('lineChartBtn');
            if (lineBtn) lineBtn.textContent = t.chartLine;
            
            const barBtn = document.getElementById('barChartBtn');
            if (barBtn) barBtn.textContent = t.chartBar;
            
            const doughnutBtn = document.getElementById('doughnutChartBtn');
            if (doughnutBtn) doughnutBtn.textContent = t.chartDoughnut;
            
            // Update chart control buttons
            const compareBtn = document.getElementById('compareBtn');
            if (compareBtn) compareBtn.textContent = `📊 ${t.comparison}`;
            
            const forecastBtn = document.getElementById('forecastBtn');
            if (forecastBtn) forecastBtn.textContent = `🔮 ${t.forecast}`;
            
            const downloadBtn = document.getElementById('downloadChartBtn');
            if (downloadBtn) downloadBtn.textContent = `📥 ${t.downloadChart}`;
            
            // Update logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) logoutBtn.textContent = `🚪 ${t.logout}`;
            
            // Update insights panel
            const insightsTitle = document.querySelector('#insightsPanel .insights-header h3');
            if (insightsTitle) insightsTitle.textContent = `🔍 ${t.smartInsights}`;
            
            const toggleInsightsBtn = document.getElementById('toggleInsightsBtn');
            if (toggleInsightsBtn) toggleInsightsBtn.textContent = `📊 ${t.viewDetails}`;
            
            const aiAnalyzingDiv = document.querySelector('#insightsLoading div:last-child');
            if (aiAnalyzingDiv) aiAnalyzingDiv.textContent = `🧠 ${t.aiAnalyzing}`;
            
            const refreshInsightsBtn = document.getElementById('refreshInsightsBtn');
            if (refreshInsightsBtn) refreshInsightsBtn.textContent = `🔄 ${t.refreshAnalysis}`;
            
            // Update analytics panel
            const analyticsTitle = document.querySelector('#analyticsPanel .analytics-header h3');
            if (analyticsTitle) analyticsTitle.textContent = `🧠 ${currentLanguage === 'el' ? 'Προηγμένα Αναλυτικά Στοιχεία' : 'Advanced Analytics'}`;
            
            const toggleAnalyticsBtn = document.getElementById('toggleAnalyticsBtn');
            if (toggleAnalyticsBtn) {
                const isVisible = document.getElementById('analyticsContent').style.display !== 'none';
                toggleAnalyticsBtn.textContent = `📊 ${isVisible ? t.hideDetails : t.viewDetails}`;
            }
            
            // Update insights toggle button state
            const insightsToggleBtn = document.getElementById('toggleInsightsBtn');
            if (insightsToggleBtn) {
                const isVisible = document.getElementById('insightsContent').style.display !== 'none';
                insightsToggleBtn.textContent = `📊 ${isVisible ? t.hideDetails : t.viewDetails}`;
            }
            
            // Update tooltips
            updateTooltips();
            
            // Update stat labels
            updateStatLabels();
            
            // Update forecast period dropdown
            updateForecastPeriodDropdown();
            
            // Update table if it exists
            renderTable();
            
            // Update category dropdown
            populateCategoryDropdown();
            
            // Update goals panel elements
            updateGoalsPanel();
            
            // Update keyboard shortcuts modal
            updateKeyboardShortcutsModal();
            
            // Update language toggle button
            updateLanguageToggleButton();
            
            // Update all translated spans
            updateAllTranslatedElements();
            
            // Update theme panel toggle button if exists
            const toggleThemeBtn = document.getElementById('toggleThemeBtn');
            if (toggleThemeBtn) {
                const themeSpan = toggleThemeBtn.querySelector('.translate');
                if (themeSpan) {
                    themeSpan.textContent = t.selectStyle;
                }
            }
        };

        const updateKeyboardShortcutsModal = () => {
            const t = translations[currentLanguage];
            
            // Update modal title and category headers
            const shortcutsTitle = document.getElementById('shortcutsTitle');
            if (shortcutsTitle) shortcutsTitle.textContent = `⌨️ ${t.keyboardShortcuts}`;
            
            const generalTitle = document.getElementById('shortcutGeneralTitle');
            if (generalTitle) generalTitle.textContent = `🏢 ${t.shortcutGeneral}`;
            
            const chartsTitle = document.getElementById('shortcutChartsTitle');
            if (chartsTitle) chartsTitle.textContent = `📊 ${t.shortcutCharts}`;
            
            const exportTitle = document.getElementById('shortcutExportTitle');
            if (exportTitle) exportTitle.textContent = `📤 ${t.shortcutExport}`;
            
            const toolsTitle = document.getElementById('shortcutToolsTitle');
            if (toolsTitle) toolsTitle.textContent = `🔧 ${t.shortcutTools}`;
            
            // Update shortcut descriptions
            const shortcutElements = {
                'shortcutNewCategory': t.shortcutNewCategory,
                'shortcutSave': t.shortcutSave,
                'shortcutDarkMode': t.shortcutDarkMode,
                'shortcutCloseModal': t.shortcutCloseModal,
                'shortcutChangeChartType': t.shortcutChangeChartType,
                'shortcutForecast': t.shortcutForecast,
                'shortcutComparison': t.shortcutComparison,
                'shortcutGoals': t.shortcutGoals,
                'shortcutExcel': t.shortcutExcel,
                'shortcutPDF': t.shortcutPDF,
                'shortcutDownloadChart': t.shortcutDownloadChart,
                'shortcutCalculator': t.shortcutCalculator,
                'shortcutThisMenu': t.shortcutThisMenu,
                'shortcutChangeTheme': t.shortcutChangeTheme,
                'shortcutRefreshInsights': t.shortcutRefreshInsights,
                'shortcutToggleAnalytics': t.shortcutToggleAnalytics,
                'shortcutToggleInsights': t.shortcutToggleInsights,
                'shortcutHelp': t.shortcutHelp
            };
            
            Object.keys(shortcutElements).forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = shortcutElements[id];
            });
            
            // Update floating subscription button tooltip
            const floatingSubscription = document.getElementById('floatingSubscription');
            if (floatingSubscription) {
                floatingSubscription.title = currentLanguage === 'el' ? 
                    '💼 Συνδρομή - Αναβάθμιση σε Plus' : 
                    '💼 Subscription - Upgrade to Plus';
            }
        };

        const updateGoalsPanel = () => {
            const t = translations[currentLanguage];
            
            // Update goal input placeholder
            const goalTargetInput = document.getElementById('goalTarget');
            if (goalTargetInput) {
                goalTargetInput.placeholder = t.targetPlaceholder;
            }
            
            // Update goal period options
            const goalPeriodSelect = document.getElementById('goalPeriod');
            if (goalPeriodSelect) {
                const currentValue = goalPeriodSelect.value || 'monthly';
                goalPeriodSelect.innerHTML = `
                    <option value="monthly">${t.monthly}</option>
                    <option value="quarterly">${t.quarterly}</option>
                    <option value="yearly">${t.yearly}</option>
                `;
                goalPeriodSelect.value = currentValue;
            }
            
            // Update goals toggle button
            const toggleGoalsBtn = document.getElementById('toggleGoalsBtn');
            if (toggleGoalsBtn) {
                const goalsSpan = toggleGoalsBtn.querySelector('.translate');
                if (goalsSpan) {
                    goalsSpan.textContent = t.manageGoals;
                }
            }
            
            // Update smart suggestions button
            const smartSuggestionsBtn = document.getElementById('smartSuggestionsBtn');
            if (smartSuggestionsBtn) {
                const smartSpan = smartSuggestionsBtn.querySelector('.translate');
                if (smartSpan) {
                    smartSpan.textContent = t.smartSuggestions;
                }
                smartSuggestionsBtn.title = t.smartSuggestionsTooltip;
            }
            
            // Refresh goals display if panel is visible
            const goalsPanel = document.getElementById('goalsPanel');
            if (goalsPanel && goalsPanel.style.display !== 'none') {
                populateGoalCategoryDropdown();
                renderGoals();
            }
        };

        const updateAllTranslatedElements = () => {
            const t = translations[currentLanguage];
            
            // Update all elements with class 'translate'
            document.querySelectorAll('.translate').forEach(element => {
                // Check if element has a data-translate-key attribute
                const key = element.getAttribute('data-translate-key') || element.textContent.trim();
                if (t[key]) {
                    element.textContent = t[key];
                } else {
                    // For span elements that contain translation keys
                    const spanParent = element.parentNode;
                    if (spanParent && spanParent.innerHTML.includes('class="translate"')) {
                        const key = element.textContent.trim();
                        if (t[key]) {
                            element.textContent = t[key];
                        }
                    }
                }
            });
        };

        const updateTableHeaders = () => {
            const table = document.querySelector('table');
            if (table) {
                const headers = table.querySelectorAll('th');
                if (headers.length > 0) {
                    const t = translations[currentLanguage];
                    headers[0].textContent = t.category;
                    // Update month headers
                    for (let i = 1; i <= 12; i++) {
                        if (headers[i]) headers[i].textContent = t.months[i-1];
                    }
                    if (headers[13]) headers[13].textContent = t.total;
                    if (headers[14]) headers[14].textContent = t.actions_table;
                }
            }
        };

        const showLanguageSelector = () => {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                border-radius: 16px;
                padding: 30px;
                max-width: 400px;
                width: 90%;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            `;
            
            if (document.body.classList.contains('dark-mode')) {
                content.style.background = '#2c3e50';
                content.style.color = '#ecf0f1';
            }
            
            content.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #667eea;">${translations[currentLanguage].selectLanguage}</h3>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="selectLanguage('el')" style="
                        padding: 15px 25px;
                        border: 2px solid ${currentLanguage === 'el' ? '#667eea' : 'rgba(0,0,0,0.2)'};
                        background: ${currentLanguage === 'el' ? '#667eea' : 'white'};
                        color: ${currentLanguage === 'el' ? 'white' : '#2c3e50'};
                        border-radius: 12px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        min-width: 120px;
                    ">🇬🇷 Ελληνικά</button>
                    <button onclick="selectLanguage('en')" style="
                        padding: 15px 25px;
                        border: 2px solid ${currentLanguage === 'en' ? '#667eea' : 'rgba(0,0,0,0.2)'};
                        background: ${currentLanguage === 'en' ? '#667eea' : 'white'};
                        color: ${currentLanguage === 'en' ? 'white' : '#2c3e50'};
                        border-radius: 12px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        min-width: 120px;
                    ">🇺🇸 English</button>
                </div>
                <button onclick="closeLanguageSelector()" style="
                    margin-top: 20px;
                    padding: 10px 20px;
                    background: #e74c3c;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 600;
                ">✕ Close</button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Add global functions for the modal
            window.selectLanguage = (lang) => {
                changeLanguage(lang);
                closeLanguageSelector();
            };
            
            window.closeLanguageSelector = () => {
                document.body.removeChild(modal);
                delete window.selectLanguage;
                delete window.closeLanguageSelector;
            };
            
            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeLanguageSelector();
                }
            });
        };

        const showLoading = () => {
            document.getElementById('loadingSpinner').style.display = 'block';
        };

        const hideLoading = () => {
            document.getElementById('loadingSpinner').style.display = 'none';
        };

        function showNotification(message, type = 'success', duration = 3000) {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const text = document.getElementById('notificationText');

            // Set notification content
            text.textContent = message;

            // Set icon based on type
            const icons = {
                success: '🎉',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };
            icon.textContent = icons[type] || icons.success;

            // Set notification type class
            notification.className = `notification ${type}`;

            // Show notification with fade animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // Auto hide after duration
            setTimeout(() => {
                hideNotification();
            }, duration);
        }

        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('show');
        }

        // Dark mode toggle
        const toggleDarkMode = () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            updateChart();
            updateDarkModeButton();
            
            // Show notification
            const currentLang = localStorage.getItem('language') || 'el';
            const message = isDark ? 
                (currentLang === 'el' ? '🌙 Dark Mode ενεργοποιήθηκε!' : '🌙 Dark Mode activated!') :
                (currentLang === 'el' ? '☀️ Light Mode ενεργοποιήθηκε!' : '☀️ Light Mode activated!');
            showNotification(message, 'info', 2000);
        };

        // Update dark mode button
        const updateDarkModeButton = () => {
            const toggle = document.getElementById('darkModeToggle');
            if (toggle) {
                const isDarkMode = document.body.classList.contains('dark-mode');
                toggle.textContent = isDarkMode ? '☀️' : '🌙';
                toggle.title = isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode';
            }
        };

        // Theme management
        let currentTheme = 'default';
        
        const applyTheme = (theme) => {
            // Remove all theme classes
            document.body.classList.remove('theme-default', 'theme-ocean', 'theme-sunset', 'theme-forest', 'theme-royal', 'theme-fire', 'theme-gold', 'theme-ice');
            
            // Add new theme class
            if (theme !== 'default') {
                document.body.classList.add(`theme-${theme}`);
            }
            
            currentTheme = theme;
            localStorage.setItem('selectedTheme', theme);
            
            // Update active theme indicator
            document.querySelectorAll('.theme-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
            
            // Update chart if it exists
            if (chart) {
                updateChart();
            }
            
            const t = translations[currentLanguage];
            showNotification(`🎨 ${t.themeSelection} "${getThemeName(theme)}" ${t.themeApplied}`, "success");
        };
        
        const getThemeName = (theme) => {
            const t = translations[currentLanguage];
            const themeKeys = {
                'default': 'themeClassic',
                'ocean': 'themeOcean', 
                'sunset': 'themeSunset',
                'forest': 'themeForest',
                'royal': 'themeRoyal',
                'fire': 'themeFire',
                'gold': 'themeGold',
                'ice': 'themeIce'
            };
            return t[themeKeys[theme]] || t.themeClassic;
        };
        
        const toggleThemePanel = () => {
            const panel = document.getElementById('themePanel');
            const isVisible = panel.style.display !== 'none';
            const t = translations[currentLanguage];
            
            if (isVisible) {
                panel.style.display = 'none';
                showNotification(`🎨 ${t.themePanelHidden}`, "info", 1500);
            } else {
                panel.style.display = 'block';
                panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                showNotification(`🎨 ${t.selectFavoriteTheme}`, "info", 2000);
            }
        };
        
        // Goals & Targets management
        let goalsData = JSON.parse(localStorage.getItem('goalsData')) || [];
        
        const addGoal = () => {
            const category = document.getElementById('goalCategory').value;
            const target = parseFloat(document.getElementById('goalTarget').value);
            const period = document.getElementById('goalPeriod').value;
            const t = translations[currentLanguage];
            
            if (!target || target <= 0) {
                showNotification(`⚠️ ${t.enterValidTarget}`, "warning");
                return;
            }
            
            const goalName = category || t.allCategories;
            const periodText = t[period];
            
            const newGoal = {
                id: Date.now(),
                category: category,
                categoryName: goalName,
                target: target,
                period: period,
                periodText: periodText,
                created: new Date().toISOString()
            };
            
            goalsData.push(newGoal);
            localStorage.setItem('goalsData', JSON.stringify(goalsData));
            
            // Clear inputs
            document.getElementById('goalTarget').value = '';
            
            renderGoals();
            showNotification(`🎯 ${t.goalTarget} "${goalName} - ${target.toLocaleString()}" ${t.goalAdded}`, "success");
        };
        
        const deleteGoal = (goalId) => {
            const t = translations[currentLanguage];
            goalsData = goalsData.filter(goal => goal.id !== goalId);
            localStorage.setItem('goalsData', JSON.stringify(goalsData));
            renderGoals();
            showNotification(`🗑️ ${t.goalDeleted}`, "success");
        };
        
        const calculateGoalProgress = (goal) => {
            const currentDate = new Date();
            let current = 0;
            
            if (goal.period === 'monthly') {
                const currentMonthKey = monthKeys[currentDate.getMonth()];
                if (goal.category) {
                    current = salesData[selectedYear][goal.category]?.sales[currentMonthKey] || 0;
                } else {
                    // Sum all categories for current month
                    Object.keys(salesData[selectedYear]).forEach(cat => {
                        current += salesData[selectedYear][cat].sales[currentMonthKey] || 0;
                    });
                }
            } else if (goal.period === 'quarterly') {
                const quarter = Math.floor(currentDate.getMonth() / 3);
                const quarterMonths = [
                    ['Ιαν', 'Φεβ', 'Μαρ'],
                    ['Απρ', 'Μάι', 'Ιουν'],
                    ['Ιουλ', 'Αυγ', 'Σεπ'],
                    ['Οκτ', 'Νοε', 'Δεκ']
                ][quarter];
                
                if (goal.category) {
                    quarterMonths.forEach(monthKey => {
                        current += salesData[selectedYear][goal.category]?.sales[monthKey] || 0;
                    });
                } else {
                    Object.keys(salesData[selectedYear]).forEach(cat => {
                        quarterMonths.forEach(monthKey => {
                            current += salesData[selectedYear][cat].sales[monthKey] || 0;
                        });
                    });
                }
            } else { // yearly
                if (goal.category) {
                    monthKeys.forEach(monthKey => {
                        current += salesData[selectedYear][goal.category]?.sales[monthKey] || 0;
                    });
                } else {
                    Object.keys(salesData[selectedYear]).forEach(cat => {
                        monthKeys.forEach(monthKey => {
                            current += salesData[selectedYear][cat].sales[monthKey] || 0;
                        });
                    });
                }
            }
            
            const percentage = (current / goal.target * 100);
            let status = 'in-progress';
            if (percentage >= 100) status = 'achieved';
            else if (percentage < 50) status = 'at-risk';
            
            return { current, percentage: Math.min(percentage, 100), status };
        };
        
        const renderGoals = () => {
            const container = document.getElementById('goalsGrid');
            const noGoalsMsg = document.getElementById('noGoalsMessage');
            const t = translations[currentLanguage];
            
            if (goalsData.length === 0) {
                container.innerHTML = '';
                noGoalsMsg.style.display = 'block';
                return;
            }
            
            noGoalsMsg.style.display = 'none';
            
            let html = '';
            goalsData.forEach(goal => {
                const progress = calculateGoalProgress(goal);
                const statusText = t[progress.status] || progress.status;
                
                const statusIcon = {
                    'achieved': '✅',
                    'in-progress': '⏳',
                    'at-risk': '⚠️'
                }[progress.status];
                
                // Check for newly achieved goals
                if (progress.status === 'achieved' && !goal.celebrated) {
                    goal.celebrated = true;
                    localStorage.setItem('goalsData', JSON.stringify(goalsData));
                    setTimeout(() => {
                        const displayName = goal.category ? goal.category : t.allCategories;
                        celebrateGoalAchievement(`${displayName} - ${t[goal.period]}`);
                    }, 500);
                }
                
                // Update goal names to use current language
                const displayCategoryName = goal.category ? goal.category : t.allCategories;
                const displayPeriodText = t[goal.period] || goal.periodText;
                
                // Calculate time remaining
                const now = new Date();
                let timeRemaining = '';
                if (goal.period === 'monthly') {
                    const daysLeft = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate() - now.getDate();
                    timeRemaining = `${daysLeft} ${currentLanguage === 'el' ? 'μέρες' : 'days'}`;
                } else if (goal.period === 'quarterly') {
                    const quarterEnd = new Date(now.getFullYear(), (Math.floor(now.getMonth() / 3) + 1) * 3, 0);
                    const daysLeft = Math.ceil((quarterEnd - now) / (1000 * 60 * 60 * 24));
                    timeRemaining = `${daysLeft} ${currentLanguage === 'el' ? 'μέρες' : 'days'}`;
                } else { // yearly
                    const yearEnd = new Date(now.getFullYear(), 11, 31);
                    const daysLeft = Math.ceil((yearEnd - now) / (1000 * 60 * 60 * 24));
                    timeRemaining = `${daysLeft} ${currentLanguage === 'el' ? 'μέρες' : 'days'}`;
                }
                
                html += `
                    <div class="goal-item" data-goal-id="${goal.id}">
                        <div class="goal-header-row">
                            <div class="goal-title">
                                ${statusIcon} ${displayCategoryName} - ${displayPeriodText}
                            </div>
                            <div class="goal-status ${progress.status}">${statusText}</div>
                        </div>
                        <div class="goal-details">
                            <div class="goal-target">${t.targetLabel} ${goal.target.toLocaleString()}€</div>
                            <div class="goal-current">${t.currentLabel} ${progress.current.toLocaleString()}€</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill ${progress.status}" style="width: ${progress.percentage}%"></div>
                        </div>
                        <div class="progress-text">${progress.percentage.toFixed(1)}% ${t.ofTarget}</div>
                        <div class="goal-time-remaining" style="font-size: 11px; color: #7f8c8d; text-align: center; margin-top: 5px;">
                            ⏰ ${timeRemaining} ${currentLanguage === 'el' ? 'απομένουν' : 'remaining'}
                        </div>
                        <div class="goal-actions">
                            <button class="goal-action-btn delete" onclick="deleteGoal(${goal.id})" title="${t.deleteGoalTooltip}">🗑️ ${t.deleteGoal}</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Update performance summary
            updateGoalsPerformanceSummary();
        };
        
        const toggleGoalsPanel = () => {
            const panel = document.getElementById('goalsPanel');
            const isVisible = panel.style.display !== 'none';
            const t = translations[currentLanguage];
            
            if (isVisible) {
                panel.style.display = 'none';
                showNotification(`🎯 ${t.goalsPanelHidden}`, "info", 1500);
            } else {
                panel.style.display = 'block';
                panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                populateGoalCategoryDropdown();
                renderGoals();
                updateGoalsPerformanceSummary();
                showNotification(`🎯 ${t.setYourGoals}`, "info", 2000);
            }
        };

        // Goal celebration function
        const celebrateGoalAchievement = (goalName) => {
            const t = translations[currentLanguage];
            
            // Create celebration modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: linear-gradient(135deg, #667eea, #764ba2);
                border-radius: 20px;
                padding: 40px;
                max-width: 400px;
                width: 90%;
                text-align: center;
                color: white;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                animation: celebrationBounce 0.6s ease;
            `;
            
            content.innerHTML = `
                <div style="font-size: 60px; margin-bottom: 20px;">🎉</div>
                <h2 style="margin-bottom: 20px; font-size: 24px;">${currentLanguage === 'el' ? 'Συγχαρητήρια!' : 'Congratulations!'}</h2>
                <p style="font-size: 16px; margin-bottom: 30px;">
                    ${currentLanguage === 'el' ? 
                        `Επιτύχατε τον στόχο σας: "${goalName}"!` : 
                        `You achieved your goal: "${goalName}"!`}
                </p>
                <button onclick="closeCelebration()" style="
                    background: rgba(255,255,255,0.2);
                    color: white;
                    border: 2px solid white;
                    border-radius: 12px;
                    padding: 12px 24px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">✨ ${currentLanguage === 'el' ? 'Τέλεια!' : 'Awesome!'}</button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Add celebration styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes celebrationBounce {
                    0% { transform: scale(0.3) rotate(0deg); opacity: 0; }
                    50% { transform: scale(1.1) rotate(5deg); }
                    100% { transform: scale(1) rotate(0deg); opacity: 1; }
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Global close function
            window.closeCelebration = () => {
                document.body.removeChild(modal);
                document.head.removeChild(style);
                delete window.closeCelebration;
            };
            
            // Auto close after 5 seconds
            setTimeout(() => {
                if (window.closeCelebration) {
                    closeCelebration();
                }
            }, 5000);
        };

        // Performance tracking for goals
        const getGoalPerformanceData = () => {
            const t = translations[currentLanguage];
            if (goalsData.length === 0) return null;
            
            let totalGoals = goalsData.length;
            let achievedGoals = 0;
            let atRiskGoals = 0;
            let averageProgress = 0;
            
            goalsData.forEach(goal => {
                const progress = calculateGoalProgress(goal);
                averageProgress += progress.percentage;
                
                if (progress.status === 'achieved') achievedGoals++;
                if (progress.status === 'at-risk') atRiskGoals++;
            });
            
            averageProgress = averageProgress / totalGoals;
            
            return {
                totalGoals,
                achievedGoals,
                atRiskGoals,
                averageProgress: Math.round(averageProgress),
                achievementRate: Math.round((achievedGoals / totalGoals) * 100)
            };
        };

        const updateGoalsPerformanceSummary = () => {
            const performanceData = getGoalPerformanceData();
            const summaryElement = document.getElementById('goalsPerformanceSummary');
            const t = translations[currentLanguage];
            
            if (!summaryElement || !performanceData) return;
            
            const { totalGoals, achievedGoals, atRiskGoals, averageProgress, achievementRate } = performanceData;
            
            let performanceIcon = '📊';
            let performanceColor = '#f39c12';
            
            if (achievementRate >= 70) {
                performanceIcon = '🏆';
                performanceColor = '#27ae60';
            } else if (achievementRate >= 40) {
                performanceIcon = '📈';
                performanceColor = '#3498db';
            } else {
                performanceIcon = '⚠️';
                performanceColor = '#e74c3c';
            }
            
            summaryElement.innerHTML = `
                <div class="performance-summary-grid">
                    <div class="performance-metric">
                        <div class="metric-icon" style="color: ${performanceColor}">${performanceIcon}</div>
                        <div class="metric-details">
                            <div class="metric-value">${totalGoals}</div>
                            <div class="metric-label">${currentLanguage === 'el' ? 'Σύνολο Στόχων' : 'Total Goals'}</div>
                        </div>
                    </div>
                    <div class="performance-metric">
                        <div class="metric-icon" style="color: #27ae60">✅</div>
                        <div class="metric-details">
                            <div class="metric-value">${achievedGoals}</div>
                            <div class="metric-label">${currentLanguage === 'el' ? 'Επιτεύχθηκαν' : 'Achieved'}</div>
                        </div>
                    </div>
                    <div class="performance-metric">
                        <div class="metric-icon" style="color: #e74c3c">⚠️</div>
                        <div class="metric-details">
                            <div class="metric-value">${atRiskGoals}</div>
                            <div class="metric-label">${currentLanguage === 'el' ? 'Σε Κίνδυνο' : 'At Risk'}</div>
                        </div>
                    </div>
                    <div class="performance-metric">
                        <div class="metric-icon" style="color: #3498db">📊</div>
                        <div class="metric-details">
                            <div class="metric-value">${averageProgress}%</div>
                            <div class="metric-label">${currentLanguage === 'el' ? 'Μέση Πρόοδος' : 'Avg Progress'}</div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Smart goal suggestions
        const generateGoalSuggestions = () => {
            const suggestions = [];
            
            Object.keys(salesData[selectedYear]).forEach(category => {
                const categoryData = salesData[selectedYear][category].sales;
                let total = 0;
                let monthsWithData = 0;
                
                monthKeys.forEach(monthKey => {
                    const value = categoryData[monthKey] || 0;
                    if (value > 0) {
                        total += value;
                        monthsWithData++;
                    }
                });
                
                if (monthsWithData > 0) {
                    const avgMonthly = total / monthsWithData;
                    const suggestedMonthly = Math.ceil(avgMonthly * 1.2); // 20% growth target
                    const suggestedQuarterly = Math.ceil(avgMonthly * 3 * 1.15); // 15% growth for quarterly
                    const suggestedYearly = Math.ceil(avgMonthly * 12 * 1.1); // 10% growth for yearly
                    
                    suggestions.push({
                        category,
                        monthly: suggestedMonthly,
                        quarterly: suggestedQuarterly,
                        yearly: suggestedYearly,
                        avgMonthly: Math.round(avgMonthly)
                    });
                }
            });
            
            return suggestions;
        };

        const showGoalSuggestions = () => {
            const suggestions = generateGoalSuggestions();
            
            if (suggestions.length === 0) {
                showNotification(
                    currentLanguage === 'el' ? 
                    "📊 Προσθέστε πρώτα δεδομένα πωλήσεων για προτάσεις στόχων" :
                    "📊 Add sales data first to get goal suggestions", 
                    "info", 3000
                );
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.7); z-index: 10000; display: flex;
                justify-content: center; align-items: center; overflow-y: auto;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; border-radius: 16px; padding: 30px;
                max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;
                text-align: left; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            `;
            
            if (document.body.classList.contains('dark-mode')) {
                content.style.background = '#2c3e50';
                content.style.color = '#ecf0f1';
            }
            
            let suggestionsHtml = `
                <h3 style="margin-bottom: 20px; color: #667eea; text-align: center;">
                    💡 ${currentLanguage === 'el' ? 'Έξυπνες Προτάσεις Στόχων' : 'Smart Goal Suggestions'}
                </h3>
            `;
            
            suggestions.forEach(suggestion => {
                suggestionsHtml += `
                    <div style="background: rgba(102, 126, 234, 0.1); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #667eea;">${suggestion.category}</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <button onclick="applyGoalSuggestion('${suggestion.category}', ${suggestion.monthly}, 'monthly')" 
                                style="padding: 8px 12px; background: rgba(46, 204, 113, 0.1); color: #27ae60; border: 1px solid rgba(46, 204, 113, 0.3); border-radius: 6px; cursor: pointer; font-size: 11px;">
                                📅 ${currentLanguage === 'el' ? 'Μηνιαίος' : 'Monthly'}: ${suggestion.monthly.toLocaleString()}€
                            </button>
                            <button onclick="applyGoalSuggestion('${suggestion.category}', ${suggestion.quarterly}, 'quarterly')" 
                                style="padding: 8px 12px; background: rgba(52, 152, 219, 0.1); color: #3498db; border: 1px solid rgba(52, 152, 219, 0.3); border-radius: 6px; cursor: pointer; font-size: 11px;">
                                📊 ${currentLanguage === 'el' ? 'Τριμηνιαίος' : 'Quarterly'}: ${suggestion.quarterly.toLocaleString()}€
                            </button>
                        </div>
                    </div>
                `;
            });
            
            suggestionsHtml += `
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="closeSuggestions()" style="
                        background: #e74c3c; color: white; border: none; border-radius: 8px;
                        padding: 10px 20px; cursor: pointer; font-weight: 600;
                    ">✕ ${currentLanguage === 'el' ? 'Κλείσιμο' : 'Close'}</button>
                </div>
            `;
            
            content.innerHTML = suggestionsHtml;
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Global functions for the modal
            window.applyGoalSuggestion = (category, target, period) => {
                document.getElementById('goalCategory').value = category;
                document.getElementById('goalTarget').value = target;
                document.getElementById('goalPeriod').value = period;
                closeSuggestions();
                showNotification(
                    currentLanguage === 'el' ? 
                    `💡 Στόχος εφαρμόστηκε! Πατήστε "Προσθήκη"` :
                    `💡 Goal applied! Click "Add"`, 
                    "success", 3000
                );
            };
            
            window.closeSuggestions = () => {
                document.body.removeChild(modal);
                delete window.applyGoalSuggestion;
                delete window.closeSuggestions;
            };
        };

        // Function to update goals when data changes
        const updateGoalsWhenDataChanges = () => {
            const goalsPanel = document.getElementById('goalsPanel');
            if (goalsPanel && goalsPanel.style.display !== 'none' && goalsData.length > 0) {
                renderGoals();
            }
        };

        const populateGoalCategoryDropdown = () => {
            const select = document.getElementById('goalCategory');
            const t = translations[currentLanguage];
            select.innerHTML = `<option value="">${t.allCategories}</option>`;
            
            Object.keys(salesData[selectedYear]).forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option);
            });
        };

        const resetTheme = () => {
            applyTheme('default');
        };

        // Category management
        const addCategory = () => {
            const catInput = document.getElementById('categoryName');
            const category = catInput.value.trim();
            const t = translations[currentLanguage];
            
            if (!category) {
                const warningMsg = currentLanguage === 'el' ? 
                    "⚠️ Παρακαλώ εισάγετε έγκυρο όνομα κατηγορίας." :
                    "⚠️ Please enter a valid category name.";
                showNotification(warningMsg, "warning");
                return;
            }
            
            if (salesData[selectedYear][category]) {
                const msg = document.getElementById('categoryMessage');
                msg.textContent = `⚠️ ${t.categoryExists}`;
                msg.style.display = 'block';
                setTimeout(() => {
                    msg.style.display = 'none';
                }, 3000);
                return;
            }

            salesData[selectedYear][category] = { sales: {} };
            catInput.value = "";
            
            // Save to both Firebase and localStorage
            saveToFirebase();
            saveToLocalStorage();
            
            renderTable();
            populateCategoryDropdown();
            updateChart();
            updateGoalsWhenDataChanges();
            showNotification(`✅ ${t.categoryAdded}`, "success");
        };
const deleteCategory = (category, rowElement) => {
    const t = translations[currentLanguage];
    
    // Add haptic feedback and visual indicator
    if (navigator.vibrate) {
        navigator.vibrate([50, 30, 50]); // Short vibration pattern
    }
    
    // Add deletion animation class
    rowElement.classList.add('fade-out');
    
    // Show immediate feedback
    const deletingMsg = currentLanguage === 'el' ? 
        "🗑️ Διαγραφή κατηγορίας..." :
        "🗑️ Deleting category...";
    showNotification(deletingMsg, "warning", 1000);
    
    // Delete data after animation starts
    setTimeout(() => {
        delete salesData[selectedYear][category];
        
        // Save to both Firebase and localStorage
        saveToFirebase();
        saveToLocalStorage();
    }, 200);
    
    // Remove element and update UI after animation completes
    setTimeout(() => {
        rowElement.remove();
        populateCategoryDropdown();
        updateChart();
        updateGoalsWhenDataChanges();
        showNotification(`✅ ${t.categoryDeleted}`, "success");
    }, 600);
};

        // Table rendering
        const renderTable = () => {
            const container = document.getElementById('tableContainer');
            const t = translations[currentLanguage];
            let html = `<table><tr><th>${t.category}</th>${t.months.map(m => `<th>${m}</th>`).join('')}<th>${t.total}</th><th>${t.actions_table}</th></tr>`;
            
            Object.keys(salesData[selectedYear]).forEach(cat => {
                let total = 0;
                html += `<tr><td class="category-name">${cat}</td>`;
                monthKeys.forEach((monthKey, index) => {
                    const val = salesData[selectedYear][cat].sales[monthKey] || 0;
                    total += val;
                    html += `<td class="editable" data-month="${monthKey}">${val.toLocaleString()}</td>`;
                });
                html += `<td><strong>${total.toLocaleString()}</strong></td>`;
                html += `<td><button class="delete-btn" onclick="deleteCategory('${cat}', this.closest('tr'))">🗑️</button></td></tr>`;
            });
            html += `</table>`;
            
            // Add mobile help text
            const helpText = currentLanguage === 'el' ? 
                '💡 Πατήστε στα κελιά για επεξεργασία • Σύρετε οριζόντια για περισσότερες στήλες' :
                '💡 Tap cells to edit • Swipe horizontally for more columns';
            html += `<div class="table-help">${helpText}</div>`;
            
            container.innerHTML = html;

            // Add event listeners for editing
            document.querySelectorAll('.editable').forEach(cell => {
                cell.addEventListener('click', () => {
                    const [category, month] = getCellContext(cell);
                    editCell(cell, category, month);
                });
                
                // Add touch feedback
                cell.addEventListener('touchstart', () => {
                    cell.style.transform = 'scale(0.98)';
                });
                
                cell.addEventListener('touchend', () => {
                    setTimeout(() => {
                        cell.style.transform = 'scale(1)';
                    }, 150);
                });
            });

            document.querySelectorAll('.category-name').forEach(cell => {
                cell.addEventListener('click', () => {
                    editCategoryName(cell);
                });
                
                // Add touch feedback
                cell.addEventListener('touchstart', () => {
                    cell.style.transform = 'scale(0.98)';
                });
                
                cell.addEventListener('touchend', () => {
                    setTimeout(() => {
                        cell.style.transform = 'scale(1)';
                    }, 150);
                });
            });
            
            // Add scroll hint animation on mobile
            if (window.innerWidth < 768) {
                const tableWrapper = document.querySelector('.table-wrapper');
                setTimeout(() => {
                    if (tableWrapper.scrollWidth > tableWrapper.clientWidth) {
                        tableWrapper.scrollTo({ left: 50, behavior: 'smooth' });
                        setTimeout(() => {
                            tableWrapper.scrollTo({ left: 0, behavior: 'smooth' });
                        }, 1000);
                    }
                }, 500);
            }
        };

        const getCellContext = (cell) => {
            const row = cell.parentElement;
            const category = row.firstChild.textContent.trim();
            const monthKey = cell.getAttribute('data-month');
            return [category, monthKey];
        };

        const editCell = (cell, category, month) => {
            if (cell.querySelector('input')) return;
            
            // Add visual feedback for mobile
            cell.style.background = 'rgba(103, 126, 234, 0.2)';
            cell.style.transform = 'scale(1.05)';
            
            const currentValue = salesData[selectedYear][category].sales[month] || 0;
            const input = document.createElement('input');
            input.type = 'number';
            input.value = currentValue;
            input.style.width = '100%';
            input.style.border = '2px solid #667eea';
            input.style.background = 'white';
            input.style.color = '#2c3e50';
            input.style.textAlign = 'center';
            input.style.fontSize = '14px';
            input.style.padding = '8px 4px';
            input.style.borderRadius = '6px';
            input.style.fontWeight = '600';
            
            // Mobile-specific input attributes
            input.setAttribute('inputmode', 'numeric');
            input.setAttribute('pattern', '[0-9]*');
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveCellValue(cell, input, category, month);
                }
                if (e.key === 'Escape') {
                    e.preventDefault();
                    cell.textContent = (currentValue || 0).toLocaleString();
                    cell.style.background = '';
                    cell.style.transform = '';
                }
            });
            
            input.addEventListener('blur', () => {
                saveCellValue(cell, input, category, month);
            });
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();
            
            // Add mobile keyboard optimization
            if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                setTimeout(() => {
                    input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        };

        const saveCellValue = (cell, input, category, month) => {
            const newValue = parseFloat(input.value);
            salesData[selectedYear][category].sales[month] = isNaN(newValue) ? 0 : newValue;
            
            // Save to both Firebase and localStorage
            saveToFirebase();
            saveToLocalStorage();
            
            cell.textContent = (isNaN(newValue) ? 0 : newValue).toLocaleString();
            
            // Reset visual feedback
            cell.style.background = '';
            cell.style.transform = '';
            
            // Add success animation
            cell.style.background = 'rgba(46, 204, 113, 0.3)';
            setTimeout(() => {
                cell.style.background = '';
            }, 800);

            // Update total
            const row = cell.parentElement;
            let total = 0;
            monthKeys.forEach((monthKey) => {
                const val = salesData[selectedYear][category].sales[monthKey] || 0;
                total += val;
            });
            row.querySelector('td:nth-last-child(2)').innerHTML = `<strong>${total.toLocaleString()}</strong>`;
            updateChart();
            updateGoalsWhenDataChanges();
            
            // Mobile success feedback
            const t = translations[currentLanguage];
            showNotification(`✅ ${t.valueUpdated}`, "success", 1500);
        };

        const editCategoryName = (cell) => {
            const oldName = cell.textContent.trim();
            const input = document.createElement('input');
            input.type = 'text';
            input.value = oldName;
            input.style.width = '100%';
            input.style.border = 'none';
            input.style.background = 'transparent';
            input.style.color = 'inherit';
            input.style.textAlign = 'center';
            input.style.fontSize = '12px';
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveCategoryName(cell, input, oldName);
                }
            });
            
            input.addEventListener('blur', () => {
                saveCategoryName(cell, input, oldName);
            });
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();
        };

        const saveCategoryName = (cell, input, oldName) => {
            const newName = input.value.trim();
            if (newName && newName !== oldName && !salesData[selectedYear][newName]) {
                salesData[selectedYear][newName] = salesData[selectedYear][oldName];
                delete salesData[selectedYear][oldName];
                
                // Save to both Firebase and localStorage
                saveToFirebase();
                saveToLocalStorage();
                
                renderTable();
                populateCategoryDropdown();
                updateChart();
                const t = translations[currentLanguage];
                showNotification(`✅ ${t.categoryNameUpdated}`, "success");
            } else {
                cell.textContent = oldName;
            }
        };

        // Dropdown population
        const populateCategoryDropdown = () => {
            const dropdown = document.getElementById('chartCategory');
            const currentValue = dropdown.value;
            const t = translations[currentLanguage];
            dropdown.innerHTML = `<option value="">🏢 ${t.allCategories}</option>`;
            Object.keys(salesData[selectedYear]).forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = `📦 ${cat}`;
                dropdown.appendChild(option);
            });
            dropdown.value = currentValue;
        };

        const populateYearDropdown = () => {
            const yearSelect = document.getElementById('yearSelect');
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            
            for (let y = currentYear - 2; y <= currentYear + 5; y++) {
                const option = document.createElement('option');
                option.value = y;
                option.textContent = y;
                yearSelect.appendChild(option);
            }
            
            yearSelect.value = selectedYear;
            yearSelect.addEventListener('change', (e) => {
                selectedYear = parseInt(e.target.value);
                if (!salesData[selectedYear]) salesData[selectedYear] = {};
                renderTable();
                populateCategoryDropdown();
                updateChart();
            });
        };

        // Statistics calculation
        const calculateStats = () => {
            const selectedCategory = document.getElementById('chartCategory').value;
            let totalSales = 0;
            let monthlyTotals = [];
            let bestMonth = '';
            let bestValue = 0;
            let bestMonthIndex = 0;

            if (selectedCategory) {
                monthKeys.forEach((monthKey, index) => {
                    const value = salesData[selectedYear][selectedCategory]?.sales[monthKey] || 0;
                    totalSales += value;
                    monthlyTotals.push(value);
                    if (value > bestValue) {
                        bestValue = value;
                        bestMonth = months[index]; // Use display name for bestMonth
                        bestMonthIndex = index;
                    }
                });
            } else {
                monthKeys.forEach((monthKey, index) => {
                    let monthTotal = 0;
                    Object.keys(salesData[selectedYear]).forEach(cat => {
                        monthTotal += salesData[selectedYear][cat].sales[monthKey] || 0;
                    });
                    totalSales += monthTotal;
                    monthlyTotals.push(monthTotal);
                    if (monthTotal > bestValue) {
                        bestValue = monthTotal;
                        bestMonth = months[index]; // Use display name for bestMonth
                        bestMonthIndex = index;
                    }
                });
            }

            const avgSales = totalSales / 12;
            const growthRate = monthlyTotals.length > 1 ? 
                ((monthlyTotals[monthlyTotals.length - 1] - monthlyTotals[0]) / monthlyTotals[0] * 100) : 0;

            // Advanced analytics calculations
            const advancedMetrics = calculateAdvancedMetrics(monthlyTotals, selectedCategory);

            // Update basic stats
            document.getElementById('totalSales').textContent = totalSales.toLocaleString();
            document.getElementById('avgSales').textContent = Math.round(avgSales).toLocaleString();
            document.getElementById('bestMonth').textContent = bestMonth || '-';
            document.getElementById('growthRate').textContent = `${growthRate.toFixed(1)}%`;

            // Update advanced stats
            document.getElementById('roiScore').textContent = `${advancedMetrics.roiScore}%`;
            document.getElementById('seasonalityIndex').textContent = advancedMetrics.seasonalityIndex.toFixed(1);
            document.getElementById('trendStrength').textContent = advancedMetrics.trendStrength;
            document.getElementById('volatilityIndex').textContent = `${advancedMetrics.volatilityIndex}%`;

            // Update analytics panel
            updateAnalyticsPanel(advancedMetrics, monthlyTotals);
        };

        // Advanced metrics calculation
        const calculateAdvancedMetrics = (monthlyData, selectedCategory) => {
            // 1. ROI Score Calculation
            const roiScore = calculateROIScore(monthlyData);
            
            // 2. Seasonality Index
            const seasonalityIndex = calculateSeasonalityIndex(monthlyData);
            
            // 3. Trend Strength Analysis
            const trendStrength = calculateTrendStrength(monthlyData);
            
            // 4. Volatility Index
            const volatilityIndex = calculateVolatilityIndex(monthlyData);
            
            // 5. Additional performance metrics
            const performanceMetrics = calculatePerformanceMetrics(monthlyData);
            
            return {
                roiScore,
                seasonalityIndex,
                trendStrength,
                volatilityIndex,
                ...performanceMetrics
            };
        };

        const calculateROIScore = (data) => {
            if (data.length < 2) return 0;
            
            const initialInvestment = data[0] || 1; // Prevent division by zero
            const finalValue = data[data.length - 1];
            const roi = ((finalValue - initialInvestment) / initialInvestment) * 100;
            
            // Normalize ROI to 0-100 scale for display
            return Math.max(0, Math.min(100, 50 + roi));
        };

        const calculateSeasonalityIndex = (data) => {
            if (data.length < 4) return 0;
            
            const mean = data.reduce((a, b) => a + b, 0) / data.length;
            let seasonalVariance = 0;
            
            // Calculate seasonal patterns (quarterly)
            for (let i = 0; i < 4; i++) {
                const quarterData = data.filter((_, index) => index % 4 === i);
                const quarterMean = quarterData.reduce((a, b) => a + b, 0) / quarterData.length;
                seasonalVariance += Math.pow(quarterMean - mean, 2);
            }
            
            const seasonalityIndex = Math.sqrt(seasonalVariance / 4) / mean;
            return Math.min(5.0, seasonalityIndex); // Cap at 5.0 for display
        };

        const calculateTrendStrength = (data) => {
            if (data.length < 3) return translations[currentLanguage].insufficientData;
            
            // Linear regression to determine trend direction and strength
            const n = data.length;
            const x = Array.from({length: n}, (_, i) => i);
            const y = data;
            
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumXX = x.reduce((sum, xi) => sum + xi * xi, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const correlation = calculateCorrelation(x, y);
            
            // Determine strength based on slope and correlation
            const strength = Math.abs(correlation * slope);
            const t = translations[currentLanguage];
            
            if (strength > 100) return slope > 0 ? t.strongUpward : t.strongDownward;
            if (strength > 50) return slope > 0 ? t.moderateUpward : t.moderateDownward;
            if (strength > 10) return slope > 0 ? t.weakUpward : t.weakDownward;
            return t.sideways;
        };

        const calculateVolatilityIndex = (data) => {
            if (data.length < 2) return 0;
            
            const mean = data.reduce((a, b) => a + b, 0) / data.length;
            const variance = data.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / data.length;
            const standardDeviation = Math.sqrt(variance);
            
            // Calculate coefficient of variation as volatility percentage
            const volatility = mean > 0 ? (standardDeviation / mean) * 100 : 0;
            return Math.round(Math.min(100, volatility)); // Cap at 100%
        };

        const calculateCorrelation = (x, y) => {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumXX = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumYY = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumXX - sumX * sumX) * (n * sumYY - sumY * sumY));
            
            return denominator !== 0 ? numerator / denominator : 0;
        };

        // Smart Insights AI System
        const generateSmartInsights = () => {
            const insights = [];
            const selectedCategory = document.getElementById('chartCategory').value;
            const t = translations[currentLanguage];
            
            // Get data for analysis
            let monthlyData = [];
            let categories = Object.keys(salesData[selectedYear]);
            
            if (selectedCategory && salesData[selectedYear][selectedCategory]) {
                monthKeys.forEach(monthKey => {
                    monthlyData.push(salesData[selectedYear][selectedCategory].sales[monthKey] || 0);
                });
            } else {
                monthKeys.forEach(monthKey => {
                    let monthTotal = 0;
                    categories.forEach(cat => {
                        monthTotal += salesData[selectedYear][cat].sales[monthKey] || 0;
                    });
                    monthlyData.push(monthTotal);
                });
            }

            // Analyze trends and generate insights
            insights.push(...analyzeGrowthTrends(monthlyData, selectedCategory));
            insights.push(...analyzeSeasonalPatterns(monthlyData, selectedCategory));
            insights.push(...analyzePerformanceIssues(monthlyData, selectedCategory));
            insights.push(...analyzeOpportunities(monthlyData, selectedCategory));
            insights.push(...analyzeCategoryComparison(categories));
            
            return insights.sort((a, b) => {
                const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                return priorityOrder[b.priority] - priorityOrder[a.priority];
            });
        };

        const analyzeGrowthTrends = (data, category) => {
            const insights = [];
            const t = translations[currentLanguage];
            const recentMonths = data.slice(-3);
            const previousMonths = data.slice(-6, -3);
            
            const recentAvg = recentMonths.reduce((a, b) => a + b, 0) / 3;
            const previousAvg = previousMonths.reduce((a, b) => a + b, 0) / 3;
            const growthRate = previousAvg > 0 ? ((recentAvg - previousAvg) / previousAvg * 100) : 0;

            const categoryText = category ? (currentLanguage === 'el' ? `Η κατηγορία "${category}"` : `Category "${category}"`) : 
                               (currentLanguage === 'el' ? 'Οι συνολικές πωλήσεις σας' : 'Your total sales');

            if (growthRate > 20) {
                insights.push({
                    icon: '🚀',
                    title: t.explosiveGrowth,
                    description: `${categoryText} ${currentLanguage === 'el' ? 'παρουσιάζει εντυπωσιακή ανάπτυξη' : 'shows impressive growth'} ${growthRate.toFixed(1)}% ${currentLanguage === 'el' ? 'τους τελευταίους 3 μήνες!' : 'in the last 3 months!'}`,
                    action: `💡 ${t.increaseInventory}`,
                    priority: 'high'
                });
            } else if (growthRate > 10) {
                insights.push({
                    icon: '📈',
                    title: t.positivetrend,
                    description: `${currentLanguage === 'el' ? 'Παρατηρείται σταθερή ανάπτυξη' : 'Steady growth observed'} ${growthRate.toFixed(1)}% - ${currentLanguage === 'el' ? 'μια υγιής τάση που αξίζει προσοχή.' : 'a healthy trend worth attention.'}`,
                    action: `💡 ${t.maintainStrategy}`,
                    priority: 'medium'
                });
            } else if (growthRate < -15) {
                insights.push({
                    icon: '⚠️',
                    title: t.sharpDecline,
                    description: `${categoryText} ${currentLanguage === 'el' ? 'έχει μειωθεί κατά' : 'has decreased by'} ${Math.abs(growthRate).toFixed(1)}% ${currentLanguage === 'el' ? 'τους τελευταίους μήνες.' : 'in recent months.'}`,
                    action: `🎯 ${t.immediateAction}`,
                    priority: 'high'
                });
            } else if (growthRate < -5) {
                insights.push({
                    icon: '📉',
                    title: t.downwardTrend,
                    description: `${currentLanguage === 'el' ? 'Παρατηρείται μείωση' : 'Decline observed'} ${Math.abs(growthRate).toFixed(1)}% ${currentLanguage === 'el' ? 'που χρήζει προσοχής.' : 'that requires attention.'}`,
                    action: `💡 ${t.reviewMarketing}`,
                    priority: 'medium'
                });
            }

            return insights;
        };

        const analyzeSeasonalPatterns = (data, category) => {
            const insights = [];
            const t = translations[currentLanguage];
            const seasonalityIndex = calculateSeasonalityIndex(data);
            
            // Find best and worst months
            let bestMonthIndex = 0;
            let worstMonthIndex = 0;
            data.forEach((value, index) => {
                if (value > data[bestMonthIndex]) bestMonthIndex = index;
                if (value < data[worstMonthIndex]) worstMonthIndex = index;
            });

            const categoryText = category ? (currentLanguage === 'el' ? `Η κατηγορία "${category}"` : `Category "${category}"`) : 
                               (currentLanguage === 'el' ? 'Οι πωλήσεις σας' : 'Your sales');

            if (seasonalityIndex > 2) {
                insights.push({
                    icon: '🌊',
                    title: t.strongSeasonality,
                    description: `${categoryText} ${currentLanguage === 'el' ? 'παρουσιάζει έντονη εποχικότητα. Ο καλύτερος μήνας είναι' : 'shows strong seasonality. Best month is'} ${months[bestMonthIndex]} ${currentLanguage === 'el' ? 'και ο χειρότερος' : 'and worst is'} ${months[worstMonthIndex]}.`,
                    action: `📅 ${t.prepareInventory} ${months[bestMonthIndex]}`,
                    priority: 'medium'
                });
            }

            if (bestMonthIndex >= 10 || bestMonthIndex <= 1) { // Nov, Dec, Jan, Feb
                insights.push({
                    icon: '🎄',
                    title: t.winterDemand,
                    description: currentLanguage === 'el' ? 'Οι καλύτερες επιδόσεις παρατηρούνται κατά τη χειμερινή περίοδο.' : 'Best performance observed during winter period.',
                    action: `❄️ ${t.holidayOffers}`,
                    priority: 'low'
                });
            } else if (bestMonthIndex >= 5 && bestMonthIndex <= 8) { // Jun-Sep
                insights.push({
                    icon: '☀️',
                    title: t.summerPeak,
                    description: currentLanguage === 'el' ? 'Οι καλοκαιρινοί μήνες δείχνουν ισχυρή απόδοση.' : 'Summer months show strong performance.',
                    action: `🏖️ ${t.summerCampaign}`,
                    priority: 'low'
                });
            }

            return insights;
        };

        const analyzePerformanceIssues = (data, category) => {
            const insights = [];
            const t = translations[currentLanguage];
            const volatility = calculateVolatilityIndex(data);
            const zeroMonths = data.filter(val => val === 0).length;

            const categoryText = category ? (currentLanguage === 'el' ? `Η κατηγορία "${category}"` : `Category "${category}"`) : 
                               (currentLanguage === 'el' ? 'Οι πωλήσεις σας' : 'Your sales');

            if (volatility > 50) {
                insights.push({
                    icon: '⚡',
                    title: t.volatility,
                    description: `${categoryText} ${currentLanguage === 'el' ? 'παρουσιάζει υψηλή αστάθεια' : 'shows high volatility'} (${volatility}%), ${currentLanguage === 'el' ? 'που μπορεί να δημιουργήσει προβλήματα πρόβλεψης.' : 'which may create forecasting problems.'}`,
                    action: `🎯 ${t.stabilizeOperations}`,
                    priority: 'medium'
                });
            }

            if (zeroMonths > 3) {
                const monthsText = currentLanguage === 'el' ? 'μήνες χωρίς καταγεγραμμένες πωλήσεις' : 'months without recorded sales';
                insights.push({
                    icon: '🚫',
                    title: currentLanguage === 'el' ? 'Μήνες Χωρίς Πωλήσεις' : 'Months Without Sales',
                    description: `${currentLanguage === 'el' ? 'Υπάρχουν' : 'There are'} ${zeroMonths} ${monthsText}.`,
                    action: currentLanguage === 'el' ? '📝 Ελέγξτε αν υπάρχουν λείποντα δεδομένα ή περίοδοι αδράνειας' : '📝 Check for missing data or inactive periods',
                    priority: 'medium'
                });
            }

            return insights;
        };

        const analyzeOpportunities = (data, category) => {
            const insights = [];
            const t = translations[currentLanguage];
            const total = data.reduce((a, b) => a + b, 0);
            const avg = total / 12;
            const lastThreeMonths = data.slice(-3);
            const lastThreeAvg = lastThreeMonths.reduce((a, b) => a + b, 0) / 3;

            const categoryText = category ? (currentLanguage === 'el' ? `Η κατηγορία "${category}"` : `Category "${category}"`) : 
                               (currentLanguage === 'el' ? 'Οι πωλήσεις σας' : 'Your sales');

            if (lastThreeAvg < avg * 0.8) {
                insights.push({
                    icon: '💎',
                    title: currentLanguage === 'el' ? 'Ευκαιρία Ανάκαμψης' : 'Recovery Opportunity',
                    description: currentLanguage === 'el' ? 
                        'Οι τελευταίες επιδόσεις είναι κάτω από τον ετήσιο μέσο όρο. Υπάρχει δυναμικό για βελτίωση.' :
                        'Recent performance is below annual average. There is potential for improvement.',
                    action: `🚀 ${t.findGrowthOpportunities}`,
                    priority: 'medium'
                });
            }

            if (total > 0 && avg > 1000) {
                insights.push({
                    icon: '🏆',
                    title: currentLanguage === 'el' ? 'Υψηλή Απόδοση' : 'High Performance',
                    description: `${categoryText} ${currentLanguage === 'el' ? 'παρουσιάζει εξαιρετικές επιδόσεις με μέσο όρο' : 'shows excellent performance with average'} ${avg.toLocaleString()}.`,
                    action: `⭐ ${t.capitalizeSuccess}`,
                    priority: 'low'
                });
            }

            return insights;
        };

        const analyzeCategoryComparison = (categories) => {
            const insights = [];
            const t = translations[currentLanguage];
            
            if (categories.length > 1) {
                const categoryTotals = categories.map(cat => {
                    const total = monthKeys.reduce((sum, monthKey) => {
                        return sum + (salesData[selectedYear][cat].sales[monthKey] || 0);
                    }, 0);
                    return { category: cat, total };
                }).sort((a, b) => b.total - a.total);

                const topCategory = categoryTotals[0];
                const bottomCategory = categoryTotals[categoryTotals.length - 1];

                if (topCategory.total > bottomCategory.total * 3) {
                    insights.push({
                        icon: '⚖️',
                        title: currentLanguage === 'el' ? 'Ανισορροπία Κατηγοριών' : 'Category Imbalance',
                        description: currentLanguage === 'el' ? 
                            `Η κατηγορία "${topCategory.category}" υπερτερεί σημαντικά έναντι των άλλων (${(topCategory.total / bottomCategory.total).toFixed(1)}x περισσότερες πωλήσεις).` :
                            `Category "${topCategory.category}" significantly outperforms others (${(topCategory.total / bottomCategory.total).toFixed(1)}x more sales).`,
                        action: `🎯 ${t.diversifyPortfolio}`,
                        priority: 'medium'
                    });
                }

                if (categories.length >= 5) {
                    insights.push({
                        icon: '📊',
                        title: t.balancedPortfolio,
                        description: currentLanguage === 'el' ? 
                            `Διαχειρίζεστε ${categories.length} κατηγορίες - ένα υγιές διαφοροποιημένο portfolio.` :
                            `You manage ${categories.length} categories - a healthy diversified portfolio.`,
                        action: `✅ ${t.maintainBalance}`,
                        priority: 'low'
                    });
                }
            }

            return insights;
        };

        const renderSmartInsights = (insights) => {
            const grid = document.getElementById('insightsGrid');
            const t = translations[currentLanguage];
            
            if (insights.length === 0) {
                grid.innerHTML = `
                    <div class="insight-item low-priority">
                        <div class="insight-title">
                            <span class="insight-icon">📊</span>
                            ${currentLanguage === 'el' ? 'Ανάλυση Δεδομένων' : 'Data Analysis'}
                        </div>
                        <div class="insight-description">
                            ${currentLanguage === 'el' ? 
                                'Προσθέστε περισσότερα δεδομένα για να λαμβάνετε εξατομικευμένες συμβουλές από το AI σύστημα.' :
                                'Add more data to receive personalized insights from the AI system.'}
                        </div>
                        <div class="insight-action">
                            💡 ${currentLanguage === 'el' ? 'Συμπληρώστε τα μηνιαία δεδομένα πωλήσεων' : 'Complete monthly sales data'}
                        </div>
                    </div>
                `;
                return;
            }

            const priorityLabels = {
                'high': currentLanguage === 'el' ? 'ΕΠΕΙΓΟΝ' : 'URGENT',
                'medium': currentLanguage === 'el' ? 'ΜΕΤΡΙΟ' : 'MEDIUM', 
                'low': currentLanguage === 'el' ? 'ΠΛΗΡΟΦ.' : 'INFO'
            };

            grid.innerHTML = insights.map(insight => `
                <div class="insight-item ${insight.priority}-priority">
                    <div class="priority-badge ${insight.priority}">${priorityLabels[insight.priority]}</div>
                    <div class="insight-title">
                        <span class="insight-icon">${insight.icon}</span>
                        ${insight.title}
                    </div>
                    <div class="insight-description">
                        ${insight.description}
                    </div>
                    <div class="insight-action">
                        ${insight.action}
                    </div>
                </div>
            `).join('');
        };

        const refreshInsights = () => {
            const loading = document.getElementById('insightsLoading');
            const grid = document.getElementById('insightsGrid');
            const t = translations[currentLanguage];
            
            // Show loading
            loading.style.display = 'block';
            grid.style.opacity = '0.3';
            
            // Simulate AI processing time
            setTimeout(() => {
                const insights = generateSmartInsights();
                renderSmartInsights(insights);
                
                // Hide loading
                loading.style.display = 'none';
                grid.style.opacity = '1';
                
                const successMsg = currentLanguage === 'el' ? 
                    `🧠 AI ανέλυσε τα δεδομένα και βρήκε ${insights.length} προτάσεις!` :
                    `🧠 AI analyzed the data and found ${insights.length} insights!`;
                showNotification(successMsg, 'success');
            }, 1500);
        };

        const calculatePerformanceMetrics = (data) => {
            const qoqGrowth = calculateQuarterOverQuarterGrowth(data);
            const yoyGrowth = calculateYearOverYearGrowth(data);
            const peakPerformance = Math.max(...data);
            const consistencyScore = calculateConsistencyScore(data);
            const marketMomentum = determineMarketMomentum(data);
            const trendDirection = determineTrendDirection(data);
            const riskLevel = determineRiskLevel(data);
            const recoveryRate = calculateRecoveryRate(data);
            
            return {
                qoqGrowth,
                yoyGrowth,
                peakPerformance,
                consistencyScore,
                marketMomentum,
                trendDirection,
                riskLevel,
                recoveryRate
            };
        };

        const calculateQuarterOverQuarterGrowth = (data) => {
            if (data.length < 6) return 0;
            
            const q1 = data.slice(0, 3).reduce((a, b) => a + b, 0);
            const q2 = data.slice(3, 6).reduce((a, b) => a + b, 0);
            
            return q1 > 0 ? ((q2 - q1) / q1 * 100).toFixed(1) : 0;
        };

        const calculateYearOverYearGrowth = (data) => {
            const prevYear = selectedYear - 1;
            if (!salesData[prevYear]) return 0;
            
            const currentTotal = data.reduce((a, b) => a + b, 0);
            let prevTotal = 0;
            
            Object.keys(salesData[prevYear]).forEach(cat => {
                monthKeys.forEach(monthKey => {
                    prevTotal += salesData[prevYear][cat]?.sales[monthKey] || 0;
                });
            });
            
            return prevTotal > 0 ? ((currentTotal - prevTotal) / prevTotal * 100).toFixed(1) : 0;
        };

        const calculateConsistencyScore = (data) => {
            const mean = data.reduce((a, b) => a + b, 0) / data.length;
            const variance = data.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / data.length;
            const cv = mean > 0 ? Math.sqrt(variance) / mean : 1;
            
            return Math.round(Math.max(0, Math.min(100, (1 - cv) * 100)));
        };

        const determineMarketMomentum = (data) => {
            const recentTrend = data.slice(-3);
            const earlierTrend = data.slice(-6, -3);
            
            const recentAvg = recentTrend.reduce((a, b) => a + b, 0) / recentTrend.length;
            const earlierAvg = earlierTrend.reduce((a, b) => a + b, 0) / earlierTrend.length;
            
            const momentum = ((recentAvg - earlierAvg) / earlierAvg) * 100;
            
            if (momentum > 10) return 'strongPositive';
            if (momentum > 5) return 'positive';
            if (momentum > -5) return 'neutral';
            if (momentum > -10) return 'negative';
            return 'strongNegative';
        };

        const determineTrendDirection = (data) => {
            const slope = calculateLinearTrend(data, 1)[0] - data[data.length - 1];
            
            if (slope > 100) return 'strongUpward';
            if (slope > 0) return 'upward';
            if (slope > -100) return 'stable';
            return 'downward';
        };

        const determineRiskLevel = (data) => {
            const volatility = calculateVolatilityIndex(data);
            
            if (volatility < 15) return 'low';
            if (volatility < 30) return 'medium';
            if (volatility < 50) return 'high';
            return 'veryHigh';
        };

        const calculateRecoveryRate = (data) => {
            const minValue = Math.min(...data);
            const maxValue = Math.max(...data);
            const currentValue = data[data.length - 1];
            
            if (maxValue === minValue) return 0;
            
            const recoveryPercentage = ((currentValue - minValue) / (maxValue - minValue)) * 100;
            return Math.round(Math.max(0, Math.min(100, recoveryPercentage)));
        };

        const updateAnalyticsPanel = (metrics, data) => {
            const t = translations[currentLanguage];
            
            // Update performance metrics
            document.getElementById('qoqGrowth').textContent = `${metrics.qoqGrowth}%`;
            document.getElementById('yoyGrowth').textContent = `${metrics.yoyGrowth}%`;
            document.getElementById('peakPerformance').textContent = metrics.peakPerformance.toLocaleString();
            document.getElementById('consistencyScore').textContent = `${metrics.consistencyScore}%`;
            
            // Update market analysis with translations
            document.getElementById('marketMomentum').innerHTML = `<span class="translate">${metrics.marketMomentum}</span>`;
            document.getElementById('trendDirection').innerHTML = `<span class="translate">${metrics.trendDirection}</span>`;
            document.getElementById('riskLevel').innerHTML = `<span class="translate">${metrics.riskLevel}</span>`;
            document.getElementById('recoveryRate').textContent = `${metrics.recoveryRate}%`;
            
            // Update predictive insights with translations
            document.getElementById('forecastAccuracy').textContent = '85%'; // Could be calculated based on historical accuracy
            document.getElementById('nextQuarterOutlook').innerHTML = `<span class="translate">${determineNextQuarterOutlook(metrics)}</span>`;
            document.getElementById('seasonalityImpact').innerHTML = `<span class="translate">${determineSeasonalityImpact(metrics.seasonalityIndex)}</span>`;
            document.getElementById('modelConfidence').innerHTML = `<span class="translate">${determineModelConfidence(metrics)}</span>`;
            
            // Update all translated elements after setting new values
            updateAllTranslatedElements();
            
            // Update tooltips with correct language
            updateTooltips();
        };

        const determineNextQuarterOutlook = (metrics) => {
            if (metrics.marketMomentum === 'strongPositive') return 'veryPositive';
            if (metrics.marketMomentum === 'positive') return 'positive';
            if (metrics.marketMomentum === 'negative') return 'cautious';
            return 'neutral2';
        };

        const determineSeasonalityImpact = (index) => {
            if (index > 2.0) return 'high';
            if (index > 1.0) return 'medium';
            if (index > 0.5) return 'low';
            return 'minimal';
        };

        const determineModelConfidence = (metrics) => {
            const score = (metrics.consistencyScore + (100 - metrics.volatilityIndex)) / 2;
            if (score > 80) return 'veryHigh2';
            if (score > 60) return 'high';
            if (score > 40) return 'medium';
            return 'low';
        };

        // Chart management
        const updateChart = () => {
            showLoading();
            
            setTimeout(() => {
                const ctxElement = document.getElementById('salesChart');
                if (chart) chart.destroy();
                
                const ctx = ctxElement.getContext('2d');
                const selectedCategory = document.getElementById('chartCategory').value;
                const isDark = document.body.classList.contains('dark-mode');
                
                let datasets = [];
                let labels = translations[currentLanguage].months;
                
                if (currentChartType === 'doughnut') {
                    const categoryTotals = {};
                    Object.keys(salesData[selectedYear]).forEach(cat => {
                        categoryTotals[cat] = monthKeys.reduce((sum, monthKey) => {
                            return sum + (salesData[selectedYear][cat].sales[monthKey] || 0);
                        }, 0);
                    });
                    
                    labels = Object.keys(categoryTotals);
                    datasets = [{
                        data: Object.values(categoryTotals),
                        backgroundColor: modernColors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: isDark ? '#2c3e50' : '#ffffff',
                        hoverOffset: 10
                    }];
                } else {
                    if (selectedCategory) {
                        datasets = [{
                            label: selectedCategory,
                            data: monthKeys.map(monthKey => salesData[selectedYear][selectedCategory]?.sales[monthKey] || 0),
                            borderColor: modernColors[0],
                            backgroundColor: currentChartType === 'line' ? 
                                `${modernColors[0]}20` : modernColors[0],
                            fill: currentChartType === 'line',
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#ffffff',
                            pointBorderWidth: 2
                        }];
                    } else {
                        datasets = Object.keys(salesData[selectedYear]).map((cat, i) => ({
                            label: cat,
                            data: monthKeys.map(monthKey => salesData[selectedYear][cat].sales[monthKey] || 0),
                            borderColor: modernColors[i % modernColors.length],
                            backgroundColor: currentChartType === 'line' ? 
                                `${modernColors[i % modernColors.length]}20` : modernColors[i % modernColors.length],
                            fill: currentChartType === 'line',
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#ffffff',
                            pointBorderWidth: 2
                        }));
                    }
                }

                const chartConfig = {
                    type: currentChartType,
                    data: { labels, datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    color: isDark ? '#ecf0f1' : '#2c3e50',
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    padding: 15,
                                    font: {
                                        size: 12,
                                        weight: '600'
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: isDark ? 'rgba(44, 62, 80, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                                titleColor: isDark ? '#ecf0f1' : '#2c3e50',
                                bodyColor: isDark ? '#ecf0f1' : '#2c3e50',
                                borderColor: isDark ? '#4facfe' : '#667eea',
                                borderWidth: 1,
                                cornerRadius: 8,
                                displayColors: true,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y?.toLocaleString() || context.parsed}`;
                                    }
                                }
                            }
                        },
                        scales: currentChartType !== 'doughnut' ? {
                            x: {
                                grid: {
                                    color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                                    borderColor: isDark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)'
                                },
                                ticks: {
                                    color: isDark ? '#bdc3c7' : '#7f8c8d',
                                    font: {
                                        size: 10,
                                        weight: '500'
                                    }
                                }
                            },
                            y: {
                                grid: {
                                    color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                                    borderColor: isDark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)'
                                },
                                ticks: {
                                    color: isDark ? '#bdc3c7' : '#7f8c8d',
                                    font: {
                                        size: 10,
                                        weight: '500'
                                    },
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                },
                                beginAtZero: true
                            }
                        } : {},
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                };

                chart = new Chart(ctx, chartConfig);
                calculateStats();
                hideLoading();
            }, 300);
        };

        // Export functions
        const exportToExcel = () => {
            const ws_data = [];
            const header = ['Κατηγορία', ...months, 'Σύνολο'];
            ws_data.push(header);

            Object.keys(salesData[selectedYear]).forEach(cat => {
                const row = [];
                let total = 0;
                row.push(cat);
                monthKeys.forEach(monthKey => {
                    const val = salesData[selectedYear][cat].sales[monthKey] || 0;
                    row.push(val);
                    total += val;
                });
                row.push(total);
                ws_data.push(row);
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            XLSX.utils.book_append_sheet(wb, ws, "Sales");
            XLSX.writeFile(wb, `sales_data_${selectedYear}.xlsx`);
            const t = translations[currentLanguage];
            showNotification(`✅ ${t.excelExportCompleted}`, "success");
        };

        const exportToPDF = () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.text(`Πίνακας Πωλήσεων ${selectedYear}`, 14, 20);

            const tableData = [];
            const header = ['Κατηγορία', ...months, 'Σύνολο'];

            Object.keys(salesData[selectedYear]).forEach(cat => {
                const row = [];
                let total = 0;
                row.push(cat);
                monthKeys.forEach(monthKey => {
                    const val = salesData[selectedYear][cat].sales[monthKey] || 0;
                    row.push(val);
                    total += val;
                });
                row.push(total);
                tableData.push(row);
            });

            doc.autoTable({
                head: [header],
                body: tableData,
                startY: 30,
                styles: { fontSize: 7 },
                headStyles: { fillColor: [103, 126, 234] }
            });

            doc.save(`sales_data_${selectedYear}.pdf`);
            const t = translations[currentLanguage];
            showNotification(`✅ ${t.pdfExportCompleted}`, "success");
        };

        // Comparison and forecast
        const compareWithPreviousYear = () => {
            const selectedCategory = document.getElementById('chartCategory').value;
            const prevYear = selectedYear - 1;

            if (!selectedCategory) {
                showNotification(`⚠️ ${translations[currentLanguage].selectCategoryComparison}`, "warning");
                return;
            }

            if (!salesData[prevYear] || !salesData[prevYear][selectedCategory]) {
                const errorMsg = currentLanguage === 'en' 
                    ? `❌ ${t.noDataFoundForCategoryYear} "${selectedCategory}" for ${prevYear}.`
                    : `❌ ${t.noDataFoundForCategoryYear} "${selectedCategory}" το ${prevYear}.`;
                showNotification(errorMsg, "error");
                return;
            }

            showLoading();

            setTimeout(() => {
                const currentData = monthKeys.map(monthKey => salesData[selectedYear][selectedCategory]?.sales[monthKey] || 0);
                const previousData = monthKeys.map(monthKey => salesData[prevYear][selectedCategory]?.sales[monthKey] || 0);

                if (chart) chart.destroy();
                
                const ctx = document.getElementById('salesChart').getContext('2d');
                const isDark = document.body.classList.contains('dark-mode');

                chart = new Chart(ctx, {
                    type: currentChartType,
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: `${selectedCategory} ${selectedYear}`,
                                data: currentData,
                                borderColor: '#667eea',
                                backgroundColor: currentChartType === 'line' ? '#667eea33' : '#667eea',
                                fill: currentChartType === 'line',
                                tension: 0.4,
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            },
                            {
                                label: `${selectedCategory} ${prevYear}`,
                                data: previousData,
                                borderColor: '#f093fb',
                                backgroundColor: currentChartType === 'line' ? '#f093fb33' : '#f093fb',
                                fill: currentChartType === 'line',
                                tension: 0.4,
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                      plugins: {
    legend: {
        labels: {
            color: isDark ? '#ecf0f1' : '#2c3e50',
            font: { size: 12, weight: '600' },
            usePointStyle: true,      // <-- προσθέτεις αυτή τη γραμμή
            pointStyle: 'circle'      // <-- και αυτή τη γραμμή
        }
    }
}
                    }
                });
                hideLoading();
                showNotification(`✅ ${translations[currentLanguage].comparisonCompleted}`, "success");
            }, 300);
        };

        const forecast = () => {
            const t = translations[currentLanguage];
            const selectedCategory = document.getElementById('chartCategory').value;
            const forecastMonths = parseInt(document.getElementById('forecastPeriod').value);

            if (!selectedCategory) {
                showNotification(`⚠️ ${t.selectCategoryForForecast}`, "warning");
                return;
            }

            const sales = salesData[selectedYear][selectedCategory]?.sales || {};
            const actualData = monthKeys.map(monthKey => sales[monthKey] || 0);

            // Advanced forecasting algorithm
            const advancedForecast = calculateAdvancedForecast(actualData, forecastMonths);
            
            // Generate forecast labels dynamically
            const forecastLabels = [...months];
            for (let i = 1; i <= forecastMonths; i++) {
                const futureMonth = new Date(selectedYear + 1, i - 1);
                const monthName = futureMonth.toLocaleDateString('el-GR', { month: 'short' });
                const year = futureMonth.getFullYear();
                forecastLabels.push(`${monthName} ${year === selectedYear + 1 ? '(πρόβλ.)' : `(${year})`}`);
            }

            if (chart) chart.destroy();
            const ctx = document.getElementById('salesChart').getContext('2d');
            const isDark = document.body.classList.contains('dark-mode');

            chart = new Chart(ctx, {
                type: currentChartType,
                data: {
                    labels: forecastLabels,
                    datasets: [
                        {
                            label: `${selectedCategory} (${selectedYear})`,
                            data: [...actualData, ...Array(forecastMonths).fill(null)],
                            borderColor: '#667eea',
                            backgroundColor: currentChartType === 'line' ? '#667eea33' : '#667eea',
                            fill: currentChartType === 'line',
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: translations[currentLanguage].trendForecastLabel,
                            data: [...Array(12).fill(null), ...advancedForecast.trend],
                            borderColor: '#f093fb',
                            backgroundColor: currentChartType === 'line' ? '#f093fb33' : '#f093fb',
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: translations[currentLanguage].seasonalForecastLabel,
                            data: [...Array(12).fill(null), ...advancedForecast.seasonal],
                            borderColor: '#43e97b',
                            backgroundColor: currentChartType === 'line' ? '#43e97b33' : '#43e97b',
                            borderDash: [10, 5],
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: translations[currentLanguage].optimizedForecastLabel,
                            data: [...Array(12).fill(null), ...advancedForecast.optimized],
                            borderColor: '#ffecd2',
                            backgroundColor: currentChartType === 'line' ? '#ffecd233' : '#ffecd2',
                            borderDash: [2, 2],
                            fill: false,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: isDark ? '#ecf0f1' : '#2c3e50',
                                font: { size: 12, weight: '600' },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: isDark ? 'rgba(44, 62, 80, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                            titleColor: isDark ? '#ecf0f1' : '#2c3e50',
                            bodyColor: isDark ? '#ecf0f1' : '#2c3e50',
                            borderColor: isDark ? '#4facfe' : '#667eea',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    if (context.parsed.y === null) return null;
                                    let confidence = '';
                                    if (context.datasetIndex >= 1) {
                                        confidence = ` (${advancedForecast.confidence}% εμπιστοσύνη)`;
                                    }
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString()}${confidence}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: isDark ? '#bdc3c7' : '#7f8c8d',
                                maxTicksLimit: forecastMonths > 12 ? 20 : 15
                            }
                        },
                        y: {
                            grid: {
                                color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: isDark ? '#bdc3c7' : '#7f8c8d',
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Show forecast analysis
            showForecastAnalysis(advancedForecast, forecastMonths);
            showNotification(`🔮 ${t.forecastCompletedMonths.replace('{months}', forecastMonths)}`, "success");
        };

        // Advanced forecasting algorithm
        const calculateAdvancedForecast = (data, forecastMonths = 3) => {
            // 1. Linear Trend Analysis
            const trendForecast = calculateLinearTrend(data, forecastMonths);
            
            // 2. Seasonal Pattern Analysis
            const seasonalForecast = calculateSeasonalPattern(data, forecastMonths);
            
            // 3. Moving Average with Exponential Smoothing
            const smoothedForecast = calculateExponentialSmoothing(data, forecastMonths);
            
            // 4. Combine methods with weights
            const optimizedForecast = combineForecasts(trendForecast, seasonalForecast, smoothedForecast);
            
            // 5. Calculate confidence level (decreases with longer forecasts)
            const confidence = calculateConfidence(data, optimizedForecast, forecastMonths);
            
            return {
                trend: trendForecast,
                seasonal: seasonalForecast,
                smoothed: smoothedForecast,
                optimized: optimizedForecast,
                confidence: confidence
            };
        };

        const calculateLinearTrend = (data, forecastMonths) => {
            const n = data.length;
            const x = Array.from({length: n}, (_, i) => i + 1);
            const y = data;
            
            // Linear regression: y = ax + b
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumXX = x.reduce((sum, xi) => sum + xi * xi, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // Forecast for the requested number of months
            const forecast = [];
            for (let i = 1; i <= forecastMonths; i++) {
                forecast.push(Math.max(0, Math.round(slope * (n + i) + intercept)));
            }
            return forecast;
        };

        const calculateSeasonalPattern = (data, forecastMonths) => {
            const forecast = [];
            const avgGrowth = calculateAverageGrowth(data);
            
            for (let i = 0; i < forecastMonths; i++) {
                // Use seasonal pattern based on month of year
                const futureMonthIndex = i % 12;
                const seasonalMultiplier = 1 + Math.sin((futureMonthIndex * Math.PI) / 6) * 0.2; // Seasonal variation
                const baseValue = data[futureMonthIndex] || (data.reduce((a, b) => a + b, 0) / data.length);
                const growthFactor = 1 + (avgGrowth * (1 + i * 0.1));
                
                forecast.push(Math.round(baseValue * seasonalMultiplier * growthFactor));
            }
            
            return forecast;
        };

        const calculateExponentialSmoothing = (data, forecastMonths) => {
            const alpha = 0.3; // Smoothing factor
            let smoothed = data[0];
            
            for (let i = 1; i < data.length; i++) {
                smoothed = alpha * data[i] + (1 - alpha) * smoothed;
            }
            
            const avgGrowth = calculateAverageGrowth(data);
            const forecast = [];
            
            for (let i = 1; i <= forecastMonths; i++) {
                const growthFactor = 1 + (avgGrowth * i * 0.1);
                forecast.push(Math.round(smoothed * growthFactor));
            }
            
            return forecast;
        };

        const calculateAverageGrowth = (data) => {
            let growthRates = [];
            for (let i = 1; i < data.length; i++) {
                if (data[i - 1] > 0) {
                    growthRates.push((data[i] - data[i - 1]) / data[i - 1]);
                }
            }
            return growthRates.length > 0 ? growthRates.reduce((a, b) => a + b, 0) / growthRates.length : 0.05;
        };

        const combineForecasts = (trend, seasonal, smoothed) => {
            // Weighted combination: 40% trend, 30% seasonal, 30% smoothed
            const weights = [0.4, 0.3, 0.3];
            const forecastLength = trend.length;
            
            return Array.from({length: forecastLength}, (_, i) => 
                Math.round(
                    trend[i] * weights[0] + 
                    seasonal[i] * weights[1] + 
                    smoothed[i] * weights[2]
                )
            );
        };

        const calculateConfidence = (historicalData, forecast, forecastMonths) => {
            // Calculate prediction accuracy based on historical variance
            const mean = historicalData.reduce((a, b) => a + b, 0) / historicalData.length;
            const variance = historicalData.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / historicalData.length;
            const stdDev = Math.sqrt(variance);
            
            // Lower variance = higher confidence, longer forecast = lower confidence
            const baseConfidence = Math.max(60, Math.min(95, 90 - (stdDev / mean) * 100));
            const timeDecay = Math.max(0.3, 1 - (forecastMonths - 3) * 0.05); // Confidence decreases with time
            
            return Math.round(baseConfidence * timeDecay);
        };

        const showForecastAnalysis = (forecast, forecastMonths) => {
            // Update stats with forecast insights
            const forecastTotal = forecast.optimized.reduce((a, b) => a + b, 0);
            const avgForecast = Math.round(forecastTotal / forecastMonths);
            const t = translations[currentLanguage];
            
            // Determine period description
            const periodDesc = forecastMonths <= 3 ? `Q1 ${selectedYear + 1}` : 
                              forecastMonths <= 6 ? `H1 ${selectedYear + 1}` :
                              forecastMonths <= 12 ? `${selectedYear + 1}` :
                              `${selectedYear + 1}-${selectedYear + 2}`;
            
            // Temporary update of stats to show forecast
            const tempStats = document.createElement('div');
            tempStats.innerHTML = `
                <div style="
                    position: fixed; 
                    top: 50%; 
                    left: 50%; 
                    transform: translate(-50%, -50%);
                    background: ${document.body.classList.contains('dark-mode') ? 'rgba(44, 62, 80, 0.95)' : 'rgba(255, 255, 255, 0.95)'};
                    backdrop-filter: blur(20px);
                    border-radius: 16px;
                    padding: 20px;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                    z-index: 10000;
                    border: 1px solid rgba(255,255,255,0.2);
                    max-width: 90vw;
                    text-align: center;
                ">
                    <h3 style="margin-bottom: 15px; color: #667eea;">🔮 ${t.forecastAnalysis} ${forecastMonths} ${t.months_period}</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                        <div><strong>${t.period}:</strong> ${periodDesc}</div>
                        <div><strong>${t.totalForecast}:</strong> ${forecastTotal.toLocaleString()}</div>
                        <div><strong>${t.avgPerMonth}:</strong> ${avgForecast.toLocaleString()}</div>
                        <div><strong>${t.confidence}:</strong> ${forecast.confidence}%</div>
                        <div><strong>${t.trend}:</strong> ${forecast.optimized[forecast.optimized.length-1] > forecast.optimized[0] ? `📈 ${t.trendUp}` : `📉 ${t.trendDown}`}</div>
                        <div><strong>${t.maxValue}:</strong> ${Math.max(...forecast.optimized).toLocaleString()}</div>
                    </div>
                    <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 15px;">
                        ${t.forecastNote}<br>
                        <em>${t.forecastDisclaimer}</em>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: linear-gradient(45deg, #667eea, #764ba2);
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 8px;
                        cursor: pointer;
                    ">${t.close}</button>
                </div>
            `;
            
            document.body.appendChild(tempStats);
            
            // Auto-close after longer time for longer forecasts
            const closeTime = Math.min(15000, 8000 + forecastMonths * 100);
            setTimeout(() => {
                if (tempStats.parentElement) {
                    tempStats.remove();
                }
            }, closeTime);
        };

        const downloadChart = () => {
            if (!chart) {
                showNotification(`⚠️ ${t.noChartToDownload}`, "warning");
                return;
            }

            const imageLink = document.createElement('a');
            imageLink.href = chart.toBase64Image('image/png', 1);
            imageLink.download = `sales_chart_${selectedYear}.png`;
            imageLink.click();
            showNotification(`✅ ${t.chartDownloadedSuccessfully}`, "success");
        };

        // Initialize sample data
        const initializeSampleData = () => {
            console.log('Initializing sample data for year:', selectedYear);
            if (Object.keys(salesData[selectedYear]).length === 0) {
                salesData[selectedYear] = {
                    'Προϊόντα Α': {
                        sales: {
                            'Ιαν': 1200, 'Φεβ': 1350, 'Μαρ': 1100, 'Απρ': 1480,
                            'Μάι': 1650, 'Ιουν': 1750, 'Ιουλ': 1900, 'Αυγ': 1820,
                            'Σεπ': 1600, 'Οκτ': 1720, 'Νοε': 1850, 'Δεκ': 2100
                        }
                    },
                    'Υπηρεσίες Β': {
                        sales: {
                            'Ιαν': 800, 'Φεβ': 920, 'Μαρ': 850, 'Απρ': 1050,
                            'Μάι': 1150, 'Ιουν': 1200, 'Ιουλ': 1300, 'Αυγ': 1250,
                            'Σεπ': 1100, 'Οκτ': 1180, 'Νοε': 1320, 'Δεκ': 1450
                        }
                    }
                };
                console.log('Sample data initialized:', salesData[selectedYear]);
                saveToFirebase();
                saveToLocalStorage();
            }
        };

        // Ensure data consistency with month keys
        const validateDataConsistency = () => {
            Object.keys(salesData).forEach(year => {
                Object.keys(salesData[year]).forEach(category => {
                    const sales = salesData[year][category].sales;
                    // Ensure all month keys exist
                    monthKeys.forEach(monthKey => {
                        if (!(monthKey in sales)) {
                            sales[monthKey] = 0;
                        }
                    });
                });
            });
        };

        // Event listeners setup
        const setupEventListeners = () => {
            // Chart type buttons
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentChartType = e.target.dataset.type;
                    updateChart();
                });
            });

            // Main buttons
            document.getElementById('addCategoryBtn').addEventListener('click', addCategory);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);
            document.getElementById('compareBtn').addEventListener('click', compareWithPreviousYear);
            document.getElementById('forecastBtn').addEventListener('click', forecast);
            document.getElementById('downloadChartBtn').addEventListener('click', downloadChart);
            document.getElementById('calculatorBtn').addEventListener('click', toggleCalculator);
            document.getElementById('shortcutsBtn').addEventListener('click', showKeyboardShortcuts);
            
            document.getElementById('logoutBtn').addEventListener('click', () => {
                sessionStorage.removeItem('loggedInUser');
                window.location.href = 'index.html';
            });

            // Category input enter key
            document.getElementById('categoryName').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') addCategory();
            });

            // Dropdown functionality - Enhanced for mobile
            initializeMobileDropdown();
            
            // Initialize mobile tooltips
            initializeMobileTooltips();
            
            // Close dropdown when clicking/touching outside
            document.addEventListener('click', (e) => {
                const dropdownContainer = document.querySelector('.dropdown-container');
                if (dropdownContainer && !dropdownContainer.contains(e.target)) {
                    closeActionsDropdown();
                }
            });
            
            // Enhanced touch support for mobile devices
            document.addEventListener('touchend', (e) => {
                const dropdownContainer = document.querySelector('.dropdown-container');
                if (dropdownContainer && !dropdownContainer.contains(e.target)) {
                    closeActionsDropdown();
                }
            }, { passive: true });
            
            // Prevent zoom on double tap for iOS
            document.addEventListener('touchend', function(e) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            let lastTouchEnd = 0;

            // Chart category change
            document.getElementById('chartCategory').addEventListener('change', updateChart);

            // Touch improvements for mobile
            document.addEventListener('touchstart', function() {}, {passive: true});
            document.addEventListener('touchmove', function() {}, {passive: true});
        };

        const applySavedDarkMode = () => {
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
            }
            updateDarkModeButton();
        };

        // Load data from localStorage as fallback
        const loadFromLocalStorage = () => {
            console.log('Loading from localStorage...');
            const localData = localStorage.getItem('salesData');
            if (localData) {
                try {
                    const parsedData = JSON.parse(localData);
                    Object.keys(parsedData).forEach(year => {
                        salesData[year] = parsedData[year];
                    });
                    console.log('✅ Data loaded from localStorage:', salesData);
                    return true;
                } catch (error) {
                    console.error('❌ Error parsing localStorage data:', error);
                    return false;
                }
            }
            return false;
        };

        
function loadFromFirebase() {
    const rawEmail = sessionStorage.getItem('loggedInUser');
    console.log('Raw email from session:', rawEmail);
    
    let username;
    if (rawEmail && rawEmail.trim() !== '') {
        username = sanitizeKey(rawEmail);
    } else {
        // Χρησιμοποίησε default username αν δεν υπάρχει logged user
        username = 'default_user';
        sessionStorage.setItem('loggedInUser', 'default_user@example.com');
    }
    
    console.log('Using username for Firebase:', username);
    
    firebase.database().ref('salesData/' + username).once('value').then(snapshot => {
        const data = snapshot.val();
        console.log('Data loaded from Firebase:', data);
        
        if (data) {
            Object.keys(data).forEach(year => {
                salesData[year] = data[year];
            });
            // Ensure data consistency with month keys
            validateDataConsistency();
            // Ενημέρωσε το selectedYear αν δεν υπάρχει
            if (!salesData[selectedYear]) {
                selectedYear = Object.keys(salesData).sort().pop(); // τελευταίο διαθέσιμο έτος
            }
            populateYearDropdown();
            renderTable();
            populateCategoryDropdown();
            updateChart();
        } else {
            console.log('No data found, initializing sample data');
            initializeSampleData();
            populateYearDropdown();
            renderTable();
            populateCategoryDropdown();
            updateChart();
        }
    }).catch(error => {
        console.error('Firebase load error:', error);
        // Fallback σε localStorage αν το Firebase αποτύχει
        const localData = localStorage.getItem('salesData');
        if (localData) {
            const parsedData = JSON.parse(localData);
            Object.keys(parsedData).forEach(year => {
                salesData[year] = parsedData[year];
            });
            // Ensure data consistency with month keys
            validateDataConsistency();
        } else {
            initializeSampleData();
        }
        populateYearDropdown();
        renderTable();
        populateCategoryDropdown();
        updateChart();
    });
}
        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Application starting...');
            
            // Initialize language
            updateUILanguage();
            
            // Initialize language toggle button
            updateLanguageToggleButton();
            
            // Initialize dark mode
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            if (savedDarkMode) {
                document.body.classList.add('dark-mode');
            }
            updateDarkModeButton();
            
            // Set username
            const userDisplay = document.getElementById('userDisplay');
            let username = sessionStorage.getItem('loggedInUser') || translations[currentLanguage].user;
            
            // Αν δεν υπάρχει username, δημιούργησε ένα default
            if (!username || username === translations[currentLanguage].user) {
                username = 'default_user@example.com';
                sessionStorage.setItem('loggedInUser', username);
            }
            
            userDisplay.textContent = username.split('@')[0] || translations[currentLanguage].user;
            console.log('Username set to:', username);

            // Initialize functionality
            applySavedDarkMode();
            setupEventListeners();
            
            // Analytics panel toggle
            document.getElementById('toggleAnalyticsBtn').addEventListener('click', () => {
                const content = document.getElementById('analyticsContent');
                const btn = document.getElementById('toggleAnalyticsBtn');
                const t = translations[currentLanguage];
                
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    btn.textContent = `📊 ${t.hideDetails}`;
                } else {
                    content.style.display = 'none';
                    btn.textContent = `📊 ${t.viewDetails}`;
                }
            });

            // Smart Insights panel toggle
            document.getElementById('toggleInsightsBtn').addEventListener('click', () => {
                const content = document.getElementById('insightsContent');
                const btn = document.getElementById('toggleInsightsBtn');
                const t = translations[currentLanguage];
                
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    btn.textContent = `📊 ${t.hideDetails}`;
                    // Auto-refresh insights when panel is opened
                    if (!document.getElementById('insightsGrid').innerHTML.trim()) {
                        refreshInsights();
                    }
                } else {
                    content.style.display = 'none';
                    btn.textContent = `📊 ${t.viewDetails}`;
                }
            });

            // Smart Insights refresh button
            document.getElementById('refreshInsightsBtn').addEventListener('click', refreshInsights);
            
            // Initialize insights when data is loaded
            setTimeout(() => {
                // Only auto-generate if there's data
                const hasData = Object.keys(salesData[selectedYear]).length > 0;
                if (hasData) {
                    refreshInsights();
                }
            }, 1000);
            
            // Δοκίμασε να φορτώσεις από Firebase, αν αποτύχει χρησιμοποίησε localStorage
            console.log('📥 Loading data...');
            loadFromFirebase();

            console.log('Loaded salesData:', salesData);
            console.log('Selected year:', selectedYear);

            // Service Worker registration
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker.register("service-worker.js")
                    .then(() => console.log("✅ Service Worker εγγράφηκε επιτυχώς"))
                    .catch(error => console.error("❌ Σφάλμα Service Worker:", error));
            }

            // Listen for changes from other tabs
            window.addEventListener('storage', function(e) {
                if (e.key === 'language') {
                    const newLang = e.newValue;
                    if (newLang && newLang !== currentLanguage) {
                        changeLanguage(newLang);
                    }
                } else if (e.key === 'darkMode') {
                    const isDarkMode = e.newValue === 'true';
                    if (isDarkMode) {
                        document.body.classList.add('dark-mode');
                    } else {
                        document.body.classList.remove('dark-mode');
                    }
                    updateDarkModeButton();
                    updateChart();
                }
            });

            // Welcome message
            setTimeout(() => {
                showNotification(`🧠 ${t.advancedAnalyticsActivated}`, "success");
                showNotification(`🎉 ${t.welcome}, ${username.split('@')[0]}!`, "success");
                showNotification(`⌨️ ${t.keyboardShortcutsNew}`, "info");
                showNotification(`🚀 ${t.autoUpdateSystemActive}`, "info");
                showNotification(`🔄 ${t.liveUpdatesActive}`, "success");
            }, 1000);
            
            // Auto-save κάθε 30 δευτερόλεπτα
            setInterval(() => {
                saveToLocalStorage();
                console.log('💾 Auto-save to localStorage');
            }, 30000);
        });

        // Responsive chart resize
        window.addEventListener('resize', () => {
            if (chart) {
                setTimeout(() => {
                    chart.resize();
                }, 100);
            }
        });

        function saveToFirebase() {
            const rawEmail = sessionStorage.getItem('loggedInUser');
            console.log('Saving with email:', rawEmail);
            
            let username;
            if (rawEmail && rawEmail.trim() !== '') {
                username = sanitizeKey(rawEmail);
            } else {
                // Χρησιμοποίησε default username αν δεν υπάρχει logged user
                username = 'default_user';
                sessionStorage.setItem('loggedInUser', 'default_user@example.com');
            }
            
            console.log('Saving to Firebase with username:', username);
            console.log('Data being saved:', salesData);
            
            // Αποθήκευση στο Firebase
            firebase.database().ref('salesData/' + username).set(salesData).then(() => {
                console.log('✅ Data saved to Firebase successfully');
            }).catch(error => {
                console.error('❌ Firebase save error:', error);
            });
            
            // Backup στο localStorage
            localStorage.setItem('salesData', JSON.stringify(salesData));
            localStorage.setItem('salesData_backup_' + username, JSON.stringify(salesData));
        }
// filepath: [dashboard.html](http://_vscodecontentref_/0)
function sanitizeKey(email) {
    // Αντικαθιστά . # $ [ ] με _
    return email.replace(/[.#$\[\]]/g, '_');
}
        // Make functions globally available
        window.deleteCategory = deleteCategory;
        window.deleteGoal = deleteGoal;
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile tooltip handling for stat cards
            if (window.innerWidth <= 768) {
                // Enhanced mobile tooltip functionality
                const statCards = document.querySelectorAll('.stat-card');
                
                statCards.forEach(card => {
                    // Touch event handling for mobile tooltips
                    card.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        
                        // Hide all other tooltips first
                        statCards.forEach(otherCard => {
                            if (otherCard !== this) {
                                otherCard.classList.remove('tooltip-active');
                            }
                        });
                        
                        // Toggle current tooltip
                        this.classList.toggle('tooltip-active');
                        
                        // Auto-hide after 4 seconds
                        if (this.classList.contains('tooltip-active')) {
                            setTimeout(() => {
                                this.classList.remove('tooltip-active');
                            }, 4000);
                        }
                    });
                    
                    // Click event for mobile
                    card.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Same logic as touch
                        statCards.forEach(otherCard => {
                            if (otherCard !== this) {
                                otherCard.classList.remove('tooltip-active');
                            }
                        });
                        
                        this.classList.toggle('tooltip-active');
                        
                        if (this.classList.contains('tooltip-active')) {
                            setTimeout(() => {
                                this.classList.remove('tooltip-active');
                            }, 4000);
                        }
                    });
                });
                
                // Hide tooltips when tapping elsewhere
                document.addEventListener('touchstart', function(e) {
                    if (!e.target.closest('.stat-card')) {
                        statCards.forEach(card => {
                            card.classList.remove('tooltip-active');
                        });
                    }
                });
            }
            
            // Initialize theme from localStorage
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            applyTheme(savedTheme);
            
            // Goals & Targets event listeners
            document.getElementById('goalsBtn').addEventListener('click', toggleGoalsPanel);
            document.getElementById('toggleGoalsBtn').addEventListener('click', toggleGoalsPanel);
            document.getElementById('addGoalBtn').addEventListener('click', addGoal);
            
            // Enter key for goal input
            document.getElementById('goalTarget').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    addGoal();
                }
            });
            
            // Theme selector event listeners
            document.getElementById('themeBtn').addEventListener('click', toggleThemePanel);
            document.getElementById('toggleThemeBtn').addEventListener('click', toggleThemePanel);
            document.getElementById('resetThemeBtn').addEventListener('click', resetTheme);
            
            // Theme selection
            document.querySelectorAll('.theme-item').forEach(item => {
                item.addEventListener('click', () => {
                    const theme = item.dataset.theme;
                    applyTheme(theme);
                });
            });
            
            // Existing event listeners
            document.getElementById('addCategoryBtn').addEventListener('click', addCategory);
            document.getElementById('darkModeBtn').addEventListener('click', toggleDarkMode);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);
            document.getElementById('compareBtn').addEventListener('click', compareData);
            document.getElementById('forecastBtn').addEventListener('click', generateForecast);
            document.getElementById('downloadChartBtn').addEventListener('click', downloadChart);
            document.getElementById('toggleAnalyticsBtn').addEventListener('click', toggleAnalytics);
            document.getElementById('toggleInsightsBtn').addEventListener('click', toggleInsights);
            document.getElementById('refreshInsightsBtn').addEventListener('click', refreshInsights);
            
            // Chart type buttons
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentChartType = btn.dataset.type;
                    updateChart();
                });
            });
            
            // Category and year change handlers
            document.getElementById('chartCategory').addEventListener('change', updateChart);
            document.getElementById('yearSelect').addEventListener('change', (e) => {
                selectedYear = parseInt(e.target.value);
                if (!salesData[selectedYear]) {
                    salesData[selectedYear] = {};
                }
                renderTable();
                populateCategoryDropdown();
                updateChart();
            });
            
            // Enter key handlers
            document.getElementById('categoryName').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    addCategory();
                }
            });
            
            // Initialize everything
            populateYearDropdown();
            loadFromFirebaseAndLocalStorage();
            
            // Mobile-specific initializations
            if (isMobile) {
                initPullToRefresh();
                addSwipeToDelete();
                
                // Add mobile class to body
                document.body.classList.add('mobile-device');
                
                // Optimize animations for mobile
                document.documentElement.style.setProperty('--animation-duration', '0.2s');
            }
            
            // Load dark mode preference
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
    <!-- ...existing code... -->
    <!-- Firebase App (core) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <!-- Firebase Database -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <script>
      // Your web app's Firebase configuration
     const firebaseConfig = {
  apiKey: "AIzaSyAijCPbtrRW440GrPpcFtcNwN3gRpnZlLc",
  authDomain: "i-managment.firebaseapp.com",
  databaseURL: "https://i-managment-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "i-managment",
  storageBucket: "i-managment.firebasestorage.app",
  messagingSenderId: "413163256377",
  appId: "1:413163256377:web:4c8624b3b9d8243d7aebe8"
};
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.database().ref('.info/connected').on('value', function(snap) {
    if (snap.val() === true) {
        console.log('✅ Συνδέθηκε στο Firebase Database');
    } else {
        console.log('❌ Δεν συνδέθηκε στο Firebase Database');
    }
});

        // Enhanced Dropdown Menu Functions with Mobile Support
        function toggleActionsDropdown(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const container = document.querySelector('.dropdown-container');
            const dropdown = document.getElementById('actionsDropdown');
            const isActive = container.classList.contains('active');
            
            // Enhanced haptic feedback for mobile
            if (isMobile) {
                triggerVibration(20);
            }
            
            if (isActive) {
                // Close dropdown
                container.classList.remove('active');
                if (isMobile) {
                    // Remove touch body lock
                    document.body.style.overflow = '';
                }
            } else {
                // Open dropdown
                container.classList.add('active');
                
                // Enhanced mobile handling
                if (isMobile) {
                    // Prevent body scroll when dropdown is open
                    document.body.style.overflow = 'hidden';
                    
                    // Ensure dropdown is visible on mobile
                    setTimeout(() => {
                        const rect = dropdown.getBoundingClientRect();
                        const viewportHeight = window.innerHeight;
                        
                        if (rect.bottom > viewportHeight) {
                            const scrollAmount = rect.bottom - viewportHeight + 20;
                            window.scrollBy({
                                top: scrollAmount,
                                behavior: 'smooth'
                            });
                        }
                    }, 100);
                    
                    // Add enhanced animations for mobile
                    const items = dropdown.querySelectorAll('.dropdown-item');
                    items.forEach((item, index) => {
                        item.style.opacity = '0';
                        item.style.transform = 'translateX(-20px)';
                        item.style.transition = 'all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                        
                        setTimeout(() => {
                            item.style.opacity = '1';
                            item.style.transform = 'translateX(0)';
                        }, index * 50 + 100);
                    });
                }
            }
        }

        function closeActionsDropdown() {
            const container = document.querySelector('.dropdown-container');
            if (container.classList.contains('active')) {
                container.classList.remove('active');
                
                if (isMobile) {
                    // Restore body scroll
                    document.body.style.overflow = '';
                }
            }
        }

        // Enhanced Mobile Touch Handlers
        function initializeMobileDropdown() {
            const dropdownBtn = document.getElementById('actionsDropdownBtn');
            const dropdownContainer = document.querySelector('.dropdown-container');
            
            if (!dropdownBtn || !dropdownContainer) return;
            
            // Enhanced touch handling for mobile
            if (isMobile) {
                let touchStartTime = 0;
                let touchMoved = false;
                
                dropdownBtn.addEventListener('touchstart', (e) => {
                    touchStartTime = Date.now();
                    touchMoved = false;
                    dropdownBtn.style.transform = 'scale(0.96)';
                }, { passive: true });
                
                dropdownBtn.addEventListener('touchmove', (e) => {
                    touchMoved = true;
                    dropdownBtn.style.transform = 'scale(1)';
                }, { passive: true });
                
                dropdownBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    const touchDuration = Date.now() - touchStartTime;
                    
                    dropdownBtn.style.transform = 'scale(1)';
                    
                    // Only trigger if it was a quick tap and not a scroll
                    if (!touchMoved && touchDuration < 300) {
                        setTimeout(() => {
                            toggleActionsDropdown(e);
                        }, 50);
                    }
                }, { passive: false });
                
                // Enhanced click handling for mobile
                dropdownBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleActionsDropdown(e);
                });
            } else {
                // Desktop click handler
                dropdownBtn.addEventListener('click', toggleActionsDropdown);
            }
        }

        // Enhanced Mobile Tooltip System
        function initializeMobileTooltips() {
            if (!isMobile) return;
            
            const statCards = document.querySelectorAll('.stat-card[data-tooltip]');
            let currentActiveTooltip = null;
            
            statCards.forEach(card => {
                let touchStartTime = 0;
                let touchMoved = false;
                let tooltipTimeout;
                
                card.addEventListener('touchstart', (e) => {
                    touchStartTime = Date.now();
                    touchMoved = false;
                }, { passive: true });
                
                card.addEventListener('touchmove', (e) => {
                    touchMoved = true;
                }, { passive: true });
                
                card.addEventListener('touchend', (e) => {
                    const touchDuration = Date.now() - touchStartTime;
                    
                    // Only show tooltip for quick taps (not scrolls)
                    if (!touchMoved && touchDuration < 300) {
                        e.preventDefault();
                        
                        // Close any existing tooltip
                        if (currentActiveTooltip && currentActiveTooltip !== card) {
                            currentActiveTooltip.classList.remove('tooltip-active');
                        }
                        
                        // Toggle current tooltip
                        if (card.classList.contains('tooltip-active')) {
                            card.classList.remove('tooltip-active');
                            currentActiveTooltip = null;
                        } else {
                            card.classList.add('tooltip-active');
                            currentActiveTooltip = card;
                            
                            // Enhanced haptic feedback
                            triggerVibration(30);
                            
                            // Auto-hide after 4 seconds
                            clearTimeout(tooltipTimeout);
                            tooltipTimeout = setTimeout(() => {
                                card.classList.remove('tooltip-active');
                                if (currentActiveTooltip === card) {
                                    currentActiveTooltip = null;
                                }
                            }, 4000);
                        }
                    }
                }, { passive: false });
            });
            
            // Close tooltips when touching elsewhere
            document.addEventListener('touchend', (e) => {
                const touchedCard = e.target.closest('.stat-card');
                if (!touchedCard && currentActiveTooltip) {
                    currentActiveTooltip.classList.remove('tooltip-active');
                    currentActiveTooltip = null;
                }
            }, { passive: true });
        }

        // Add slide in animation for dropdown items
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInLeft {
                from {
                    opacity: 0;
                    transform: translateX(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
            
            .dropdown-item {
                animation-fill-mode: both;
                opacity: 0;
            }
            
            .dropdown-container.active .dropdown-item {
                opacity: 1;
            }
        `;
        document.head.appendChild(style);

        // Calculator Functions
        let calcMemory = 0;
        let calcCurrent = '0';
        let calcOperator = '';
        let calcPrevious = '';
        let calcWaitingForOperand = false;
        
        // Mobile detection
        // Enhanced Vibration Feedback System
        function triggerVibration(duration = 20) {
            if ('vibrate' in navigator) {
                try {
                    navigator.vibrate(duration);
                } catch (e) {
                    console.log('Vibration not supported');
                }
            }
        }

        // Enhanced Mobile Device Detection
        const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTouchDevice = () => {
            return 'ontouchstart' in window || 
                   navigator.maxTouchPoints > 0 || 
                   navigator.msMaxTouchPoints > 0;
        };

        // Enhanced initialization for mobile features
        function initializeEnhancedMobileFeatures() {
            if (isMobile || isTouchDevice()) {
                // Add mobile class to body for CSS targeting
                document.body.classList.add('mobile-device');
                
                // Disable iOS bounce scroll
                document.addEventListener('touchmove', function(e) {
                    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                        const isScrollable = e.target.scrollHeight > e.target.clientHeight;
                        if (!isScrollable) {
                            e.preventDefault();
                        }
                    }
                }, { passive: false });
                
                // Enhanced double-tap protection
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function(e) {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
                
                console.log('🚀 Enhanced mobile features activated!');
            }
        }
        
        // Prevent calculator drag on mobile (use touch events instead)
        function isTouchDevice() {
            return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        }
        
        // Mobile swipe functionality for table rows
        function addSwipeToDelete() {
            if (!isMobile) return;
            
            const tableRows = document.querySelectorAll('tr:not(:first-child)');
            tableRows.forEach(row => {
                let startX, startY, currentX, currentY;
                let isSwipeActive = false;
                
                row.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                    isSwipeActive = false;
                }, { passive: true });
                
                row.addEventListener('touchmove', (e) => {
                    if (!startX || !startY) return;
                    
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                    
                    const diffX = startX - currentX;
                    const diffY = startY - currentY;
                    
                    // Horizontal swipe (left)
                    if (Math.abs(diffX) > Math.abs(diffY) && diffX > 50) {
                        isSwipeActive = true;
                        row.style.transform = `translateX(-${Math.min(diffX, 150)}px)`;
                        row.style.background = 'rgba(231, 76, 60, 0.1)';
                    }
                }, { passive: true });
                
                row.addEventListener('touchend', () => {
                    if (isSwipeActive) {
                        // Show delete confirmation
                        const category = row.querySelector('.category-name')?.textContent;
                        if (category && confirm(`Διαγραφή κατηγορίας "${category}";`)) {
                            deleteCategory(category, row);
                        }
                    }
                    
                    // Reset row position
                    row.style.transform = '';
                    row.style.background = '';
                    startX = startY = null;
                }, { passive: true });
            });
        }

        // Pull-to-refresh functionality for mobile
        function initPullToRefresh() {
            if (!isMobile) return;
            
            let startY = 0;
            let currentY = 0;
            let isPulling = false;
            const pullThreshold = 80;
            
            // Create refresh indicator
            const refreshIndicator = document.createElement('div');
            refreshIndicator.id = 'pullRefreshIndicator';
            refreshIndicator.innerHTML = '↓ Τράβηξε για ανανέωση';
            refreshIndicator.style.cssText = `
                position: fixed;
                top: -60px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--primary-color);
                color: white;
                padding: 15px 25px;
                border-radius: 0 0 15px 15px;
                font-size: 14px;
                z-index: 9999;
                transition: top 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            document.body.appendChild(refreshIndicator);
            
            document.addEventListener('touchstart', (e) => {
                if (window.scrollY === 0) {
                    startY = e.touches[0].clientY;
                }
            }, { passive: true });
            
            document.addEventListener('touchmove', (e) => {
                if (window.scrollY === 0 && startY) {
                    currentY = e.touches[0].clientY;
                    const pullDistance = currentY - startY;
                    
                    if (pullDistance > 10) {
                        isPulling = true;
                        const progress = Math.min(pullDistance / pullThreshold, 1);
                        refreshIndicator.style.top = `${-60 + (progress * 60)}px`;
                        
                        if (pullDistance > pullThreshold) {
                            refreshIndicator.innerHTML = '↑ Άφησε για ανανέωση';
                            refreshIndicator.style.background = '#27ae60';
                        } else {
                            refreshIndicator.innerHTML = '↓ Τράβηξε για ανανέωση';
                            refreshIndicator.style.background = 'var(--primary-color)';
                        }
                    }
                }
            }, { passive: true });
            
            document.addEventListener('touchend', () => {
                if (isPulling) {
                    const pullDistance = currentY - startY;
                    
                    if (pullDistance > pullThreshold) {
                        // Trigger refresh
                        refreshIndicator.innerHTML = '🔄 Ανανέωση...';
                        refreshIndicator.style.top = '0px';
                        
                        // Simulate refresh
                        setTimeout(() => {
                            refreshData();
                            refreshIndicator.style.top = '-60px';
                            setTimeout(() => {
                                refreshIndicator.innerHTML = '↓ Τράβηξε για ανανέωση';
                                refreshIndicator.style.background = 'var(--primary-color)';
                            }, 300);
                        }, 1500);
                    } else {
                        refreshIndicator.style.top = '-60px';
                    }
                }
                
                startY = 0;
                currentY = 0;
                isPulling = false;
            }, { passive: true });
        }
        
        function refreshData() {
            // Refresh all data
            loadFromFirebase();
            renderTable();
            updateChart();
            calculateStats();
            showNotification(`🔄 ${t.dataRefreshed}`, "success");
        }

        function toggleCalculator() {
            const widget = document.getElementById('calculatorWidget');
            if (widget.style.display === 'none') {
                widget.style.display = 'block';
                clearCalc();
                closeActionsDropdown();
                showNotification(`🔢 ${translations[currentLanguage].calculatorActivated}`, "success", 1500);
                makeDraggable(widget);
            } else {
                widget.style.display = 'none';
            }
        }

        // Make calculator draggable
        function makeDraggable(element) {
            // On mobile, position calculator in center and don't make it draggable
            if (isMobile || isTouchDevice()) {
                element.style.position = 'fixed';
                element.style.top = '50%';
                element.style.left = '50%';
                element.style.transform = 'translate(-50%, -50%)';
                element.style.zIndex = '10001';
                return;
            }
            
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            const header = element.querySelector('.calculator-header');
            
            header.style.cursor = 'move';
            header.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                const newTop = element.offsetTop - pos2;
                const newLeft = element.offsetLeft - pos1;
                
                // Keep within viewport bounds
                const maxTop = window.innerHeight - element.offsetHeight;
                const maxLeft = window.innerWidth - element.offsetWidth;
                
                element.style.top = Math.max(0, Math.min(newTop, maxTop)) + "px";
                element.style.left = Math.max(0, Math.min(newLeft, maxLeft)) + "px";
                element.style.transform = 'none'; // Remove centering transform
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        function appendNumber(num) {
            const display = document.getElementById('calcDisplay');
            if (calcWaitingForOperand) {
                display.value = num;
                calcWaitingForOperand = false;
            } else {
                display.value = display.value === '0' ? num : display.value + num;
            }
            calcCurrent = display.value;
            
            // Add button press feedback
            addCalculatorFeedback();
        }

        function addCalculatorFeedback() {
            // Visual feedback - flash the display
            const display = document.getElementById('calcDisplay');
            display.style.boxShadow = '0 0 10px var(--primary-color)';
            setTimeout(() => {
                display.style.boxShadow = '';
            }, 100);
            
            // Haptic feedback for mobile
            if (isMobile && 'vibrate' in navigator) {
                navigator.vibrate(10); // Short vibration
            }
        }

        function appendDecimal() {
            const display = document.getElementById('calcDisplay');
            if (calcWaitingForOperand) {
                display.value = '0.';
                calcWaitingForOperand = false;
            } else if (display.value.indexOf('.') === -1) {
                display.value += '.';
            }
            calcCurrent = display.value;
            addCalculatorFeedback();
        }

        function appendOperator(nextOperator) {
            const display = document.getElementById('calcDisplay');
            const inputValue = parseFloat(display.value);

            if (calcPrevious === '') {
                calcPrevious = inputValue;
            } else if (calcOperator) {
                const currentValue = calcPrevious || 0;
                const newValue = performCalculation(currentValue, inputValue, calcOperator);
                
                display.value = String(newValue);
                calcPrevious = newValue;
            }

            calcWaitingForOperand = true;
            calcOperator = nextOperator;
            addCalculatorFeedback();
        }

        function calculate() {
            const display = document.getElementById('calcDisplay');
            const inputValue = parseFloat(display.value);

            if (calcPrevious !== '' && calcOperator && !calcWaitingForOperand) {
                const newValue = performCalculation(calcPrevious, inputValue, calcOperator);
                display.value = String(newValue);
                calcCurrent = String(newValue);
                calcPrevious = '';
                calcOperator = '';
                calcWaitingForOperand = true;
                
                // Special feedback for calculation result
                display.style.background = 'rgba(46, 204, 113, 0.2)';
                setTimeout(() => {
                    display.style.background = '';
                }, 500);
            }
        }

        function performCalculation(firstValue, secondValue, operator) {
            switch (operator) {
                case '+':
                    return firstValue + secondValue;
                case '-':
                    return firstValue - secondValue;
                case '*':
                    return firstValue * secondValue;
                case '/':
                    return secondValue !== 0 ? firstValue / secondValue : 0;
                default:
                    return secondValue;
            }
        }

        function clearCalc() {
            const display = document.getElementById('calcDisplay');
            display.value = '0';
            calcCurrent = '0';
            calcOperator = '';
            calcPrevious = '';
            calcWaitingForOperand = false;
        }

        function clearEntry() {
            const display = document.getElementById('calcDisplay');
            display.value = '0';
            calcCurrent = '0';
        }

        function deleteLast() {
            const display = document.getElementById('calcDisplay');
            if (display.value.length > 1) {
                display.value = display.value.slice(0, -1);
            } else {
                display.value = '0';
            }
            calcCurrent = display.value;
        }

        function memoryStore() {
            calcMemory = parseFloat(document.getElementById('calcDisplay').value) || 0;
            showNotification(`💾 ${t.saved} ${calcMemory}`, "success", 1500);
        }

        function memoryRecall() {
            document.getElementById('calcDisplay').value = calcMemory;
            calcCurrent = String(calcMemory);
            calcWaitingForOperand = true;
        }

        function memoryClear() {
            calcMemory = 0;
            showNotification(`🗑️ ${t.memoryClearedShortcut}`, "success", 1500);
        }

        function memoryAdd() {
            calcMemory += parseFloat(document.getElementById('calcDisplay').value) || 0;
            showNotification(`➕ ${t.memory} ${calcMemory}`, "success", 1500);
        }

        // Keyboard Shortcuts Functions
        function showKeyboardShortcuts() {
            const modal = document.getElementById('shortcutsModal');
            modal.style.display = 'flex';
            closeActionsDropdown();
            showNotification(`⌨️ ${t.keyboardShortcutsShown}`, "success", 1500);
        }

        function closeShortcuts() {
            const modal = document.getElementById('shortcutsModal');
            modal.style.display = 'none';
        }

        // Global Keyboard Event Listener
        document.addEventListener('keydown', (e) => {
            // Check if user is typing in an input field
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }

            if (e.ctrlKey || e.metaKey) {
                switch (e.key.toLowerCase()) {
                    case 'n':
                        e.preventDefault();
                        document.getElementById('addCategoryBtn').click();
                        break;
                    case 's':
                        e.preventDefault();
                        saveToFirebase();
                        saveToLocalStorage();
                        showNotification(`💾 ${t.dataSavedShortcut}`, "success");
                        break;
                    case 'd':
                        e.preventDefault();
                        document.getElementById('darkModeBtn').click();
                        break;
                    case 'f':
                        e.preventDefault();
                        document.getElementById('forecastBtn').click();
                        break;
                    case 'c':
                        e.preventDefault();
                        document.getElementById('compareBtn').click();
                        break;
                    case 'e':
                        e.preventDefault();
                        document.getElementById('exportExcelBtn').click();
                        break;
                    case 'p':
                        e.preventDefault();
                        document.getElementById('exportPdfBtn').click();
                        break;
                    case 'i':
                        e.preventDefault();
                        document.getElementById('downloadChartBtn').click();
                        break;
                    case 'g':
                        e.preventDefault();
                        document.getElementById('goalsBtn').click();
                        break;
                    case 't':
                        e.preventDefault();
                        document.getElementById('themeBtn').click();
                        break;
                    case 'k':
                        e.preventDefault();
                        toggleCalculator();
                        break;
                    case 'r':
                        e.preventDefault();
                        document.getElementById('refreshInsightsBtn').click();
                        break;
                    case '/':
                    case '?':
                        e.preventDefault();
                        showKeyboardShortcuts();
                        break;
                    case 'a':
                        e.preventDefault();
                        document.getElementById('toggleAnalyticsBtn').click();
                        break;
                    case 'j':
                        e.preventDefault();
                        document.getElementById('toggleInsightsBtn').click();
                        break;
                }
            } else {
                // Chart type shortcuts (1-4)
                if (['1', '2', '3', '4'].includes(e.key)) {
                    const chartTypes = ['line', 'bar', 'doughnut', 'radar'];
                    const chartType = chartTypes[parseInt(e.key) - 1];
                    if (chartType) {
                        document.querySelector(`[data-type="${chartType}"]`).click();
                        showNotification(`📊 ${t.chart} ${chartType.toUpperCase()}`, "success", 1500);
                    }
                }
                
                // ESC to close modals
                if (e.key === 'Escape') {
                    closeShortcuts();
                    document.getElementById('calculatorWidget').style.display = 'none';
                    closeActionsDropdown();
                    showNotification(`❌ ${t.modalsClosed}`, "info", 1000);
                }
                
                // Quick actions
                if (e.key === 'h' || e.key === 'H') {
                    showKeyboardShortcuts();
                }
            }
        });

        // Calculator keyboard support when calculator is open
        document.addEventListener('keydown', (e) => {
            const calcWidget = document.getElementById('calculatorWidget');
            if (calcWidget.style.display === 'block') {
                // Prevent default behavior for calculator keys
                if ('0123456789+-*/.='.includes(e.key) || e.key === 'Enter' || e.key === 'Backspace') {
                    e.preventDefault();
                    
                    if ('0123456789'.includes(e.key)) {
                        appendNumber(e.key);
                    } else if (e.key === '.') {
                        appendDecimal();
                    } else if (e.key === '+') {
                        appendOperator('+');
                    } else if (e.key === '-') {
                        appendOperator('-');
                    } else if (e.key === '*') {
                        appendOperator('*');
                    } else if (e.key === '/') {
                        appendOperator('/');
                    } else if (e.key === '=' || e.key === 'Enter') {
                        calculate();
                    } else if (e.key === 'Backspace') {
                        deleteLast();
                    }
                }
            }
        });

        // Enhanced Mobile Features

        // Utility function for haptic feedback
        function triggerVibration(duration = 30) {
            if (isMobile && 'vibrate' in navigator) {
                navigator.vibrate(duration);
            }
        }

        // Double Tap Manager
        class DoubleTapManager {
            constructor() {
                this.lastTap = 0;
                this.tapTimeout = 300; // 300ms between taps
                this.init();
            }

            init() {
                document.addEventListener('touchstart', (e) => {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - this.lastTap;
                    
                    if (tapLength < this.tapTimeout && tapLength > 0) {
                        this.handleDoubleTap(e);
                        e.preventDefault();
                    }
                    
                    this.lastTap = currentTime;
                });
            }

            handleDoubleTap(e) {
                const element = e.target.closest('.stat-card, .chart-container, .analytics-card');
                
                if (element) {
                    triggerVibration(30);
                    this.showDoubleTapIndicator(e.touches[0].clientX, e.touches[0].clientY);
                    
                    if (element.classList.contains('stat-card')) {
                        showNotification(t.statsCard, 'info');
                    } else if (element.classList.contains('chart-container')) {
                        showNotification(t.chartViewToggle, 'info');
                    }
                }
            }

            showDoubleTapIndicator(x, y) {
                const indicator = document.createElement('div');
                indicator.className = 'double-tap-indicator';
                indicator.style.left = (x - 30) + 'px';
                indicator.style.top = (y - 30) + 'px';
                
                document.body.appendChild(indicator);
                
                setTimeout(() => {
                    document.body.removeChild(indicator);
                }, 600);
            }
        }

        // Offline Manager
        class OfflineManager {
            constructor() {
                this.isOnline = navigator.onLine;
                this.pendingData = JSON.parse(localStorage.getItem('pendingData') || '[]');
                this.init();
            }

            init() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.hideOfflineIndicator();
                    this.syncPendingData();
                    showNotification(t.connectionRestored, 'success');
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.showOfflineIndicator();
                    showNotification(t.offlineMode, 'warning');
                });

                // Check initial state
                if (!this.isOnline) {
                    this.showOfflineIndicator();
                }
            }

            showOfflineIndicator() {
                let indicator = document.getElementById('offlineIndicator');
                if (!indicator) {
                    indicator = document.createElement('div');
                    indicator.id = 'offlineIndicator';
                    indicator.className = 'offline-indicator';
                    indicator.innerHTML = '📴 Εκτός σύνδεσης';
                    document.body.appendChild(indicator);
                }
                indicator.classList.add('show');
            }

            hideOfflineIndicator() {
                const indicator = document.getElementById('offlineIndicator');
                if (indicator) {
                    indicator.classList.remove('show');
                }
            }

            savePendingData(data) {
                this.pendingData.push({
                    ...data,
                    timestamp: Date.now()
                });
                localStorage.setItem('pendingData', JSON.stringify(this.pendingData));
            }

            syncPendingData() {
                if (this.pendingData.length > 0) {
                    // Simulate syncing pending data
                    setTimeout(() => {
                        this.pendingData = [];
                        localStorage.removeItem('pendingData');
                        showNotification(t.dataSynced, 'success');
                    }, 1000);
                }
            }
        }

        // Success Celebration Manager
        class CelebrationManager {
            createConfetti() {
                const celebration = document.getElementById('successCelebration') || this.createCelebrationContainer();
                
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.animationDelay = Math.random() * 0.3 + 's';
                        celebration.appendChild(confetti);
                        
                        setTimeout(() => {
                            confetti.remove();
                        }, 3000);
                    }, i * 50);
                }
            }

            createCelebrationContainer() {
                const container = document.createElement('div');
                container.id = 'successCelebration';
                container.className = 'success-celebration';
                document.body.appendChild(container);
                return container;
            }

            celebrate(message = 'Επιτυχία! 🎉') {
                triggerVibration(100);
                this.createConfetti();
                showNotification(message, 'success');
            }
        }

        // Initialize all mobile managers
        let doubleTapManager, offlineManager, celebrationManager;

        // Enhanced initialization
        function initializeMobileFeatures() {
            if (isMobile || isTouchDevice()) {
                doubleTapManager = new DoubleTapManager();
                offlineManager = new OfflineManager();
                celebrationManager = new CelebrationManager();
                
                console.log('🚀 Enhanced mobile features initialized!');
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            initializeEnhancedMobileFeatures();
            setTimeout(initializeMobileFeatures, 500);
            registerServiceWorker();
        });

        // Service Worker Registration
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('🎯 Service Worker registered successfully:', registration.scope);
                        
                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showNotification(t.newVersionAvailable, 'info', 5000);
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('❌ Service Worker registration failed:', error);
                    });

                // Listen for messages from service worker
                navigator.serviceWorker.addEventListener('message', (event) => {
                    if (event.data && event.data.type === 'DATA_SYNCED') {
                        showNotification(event.data.message, 'success');
                    }
                });
            }
        }

        // PWA Install Prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('🚀 PWA Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install suggestion for mobile users
            if (isMobile) {
                setTimeout(() => {
                    showInstallSuggestion();
                }, 3000);
            }
        });

        function showInstallSuggestion() {
            const installBtn = document.createElement('div');
            installBtn.innerHTML = `
                <div style="
                    position: fixed;
                    bottom: 180px;
                    left: 20px;
                    right: 20px;
                    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
                    color: white;
                    padding: 15px 20px;
                    border-radius: 15px;
                    text-align: center;
                    font-weight: 600;
                    z-index: 9999;
                    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
                    cursor: pointer;
                    animation: slideUp 0.5s ease;
                ">
                    📱 Εγκαταστήστε την εφαρμογή για καλύτερη εμπειρία!
                    <div style="margin-top: 8px; font-size: 12px; opacity: 0.9;">
                        Πατήστε για εγκατάσταση
                    </div>
                </div>
            `;
            
            installBtn.onclick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            showNotification(t.installationStarted, 'success');
                        }
                        deferredPrompt = null;
                        installBtn.remove();
                    });
                }
            };
            
            document.body.appendChild(installBtn);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (installBtn.parentNode) {
                    installBtn.remove();
                }
            }, 10000);
        }

        // Enhanced mobile notifications
        const originalShowNotification = window.showNotification;
        window.showNotification = function(message, type = 'info', duration = 3000) {
            if (isMobile) {
                // Position notifications at bottom for mobile
                const notification = document.createElement('div');
                notification.className = `notification ${type} show mobile-notification`;
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    bottom: 100px;
                    left: 20px;
                    right: 20px;
                    top: auto;
                    transform: translateY(0);
                    border-radius: 12px;
                    z-index: 9999;
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, duration);
                
                triggerVibration(20);
            } else {
                originalShowNotification?.call(this, message, type, duration);
            }
        };
        
        // Subscription system
        function checkSubscriptionAccess(feature) {
            const currentSubscription = localStorage.getItem('subscription');
            const subscriptionExpiry = localStorage.getItem('subscriptionExpiry');
            const subscriptionFeatures = JSON.parse(localStorage.getItem('subscriptionFeatures') || '[]');
            
            if (!currentSubscription || !subscriptionExpiry) {
                return false;
            }
            
            const now = new Date().getTime();
            const expiry = new Date(subscriptionExpiry).getTime();
            
            if (expiry <= now) {
                return false;
            }
            
            return subscriptionFeatures.includes(feature);
        }
        
        function showSubscriptionPrompt(feature) {
            const currentLang = localStorage.getItem('language') || 'el';
            const messages = {
                el: {
                    title: '🔒 Premium Δυνατότητα',
                    message: 'Αυτή η δυνατότητα απαιτεί συνδρομή. Θέλετε να δείτε τα διαθέσιμα πλάνα;',
                    upgrade: 'Δείτε Πλάνα',
                    cancel: 'Όχι τώρα'
                },
                en: {
                    title: '🔒 Premium Feature',
                    message: 'This feature requires a subscription. Would you like to see available plans?',
                    upgrade: 'View Plans',
                    cancel: 'Not now'
                }
            };
            
            const msg = messages[currentLang];
            
            if (confirm(msg.message)) {
                window.open('subscription.html', '_blank');
            }
        }
        
        // Add subscription checks to export features
        const originalExportExcel = window.exportExcel;
        window.exportExcel = function() {
            if (!checkSubscriptionAccess('export')) {
                showSubscriptionPrompt('export');
                return;
            }
            originalExportExcel?.call(this);
        };
        
        const originalExportPdf = window.exportPdf;
        window.exportPdf = function() {
            if (!checkSubscriptionAccess('export')) {
                showSubscriptionPrompt('export');
                return;
            }
            originalExportPdf?.call(this);
        };
        
        // Check subscription status on page load
        document.addEventListener('DOMContentLoaded', function() {
            const subscription = localStorage.getItem('subscription');
            const expiry = localStorage.getItem('subscriptionExpiry');
            
            if (subscription && expiry) {
                const now = new Date().getTime();
                const expiryTime = new Date(expiry).getTime();
                const daysLeft = Math.ceil((expiryTime - now) / (1000 * 60 * 60 * 24));
                
                if (daysLeft <= 0) {
                    // Subscription expired
                    localStorage.removeItem('subscription');
                    localStorage.removeItem('subscriptionExpiry');
                    localStorage.removeItem('subscriptionFeatures');
                    
                    const currentLang = localStorage.getItem('language') || 'el';
                    const message = currentLang === 'el' 
                        ? '⚠️ Η συνδρομή σας έληξε. Κάποιες δυνατότητες ενδέχεται να μην είναι διαθέσιμες.'
                        : '⚠️ Your subscription has expired. Some features may not be available.';
                    
                    showNotification(message, 'warning');
                } else if (daysLeft <= 3) {
                    // Subscription expiring soon
                    const currentLang = localStorage.getItem('language') || 'el';
                    const message = currentLang === 'el' 
                        ? `⏰ Η συνδρομή σας λήγει σε ${daysLeft} ημέρες. Ανανεώστε τώρα για να συνεχίσετε.`
                        : `⏰ Your subscription expires in ${daysLeft} days. Renew now to continue.`;
                    
                    showNotification(message, 'warning');
                }
            }
            
            // Apply subscription restrictions
            applySubscriptionRestrictions();
            
            // Listen for subscription updates from other windows/tabs
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'subscription-updated') {
                    // Re-apply subscription restrictions when subscription is updated
                    setTimeout(() => {
                        applySubscriptionRestrictions();
                    }, 100);
                }
            });
            
            // Listen for localStorage changes (for subscription updates in same tab)
            window.addEventListener('storage', function(event) {
                if (event.key === 'subscription' || event.key === 'subscriptionExpiry') {
                    setTimeout(() => {
                        applySubscriptionRestrictions();
                    }, 100);
                }
            });
        });
        
        // Global function to refresh subscription status (can be called from other pages)
        window.refreshSubscriptionStatus = function() {
            applySubscriptionRestrictions();
        };
        
        // Apply subscription-based restrictions
        function applySubscriptionRestrictions() {
            const subscription = localStorage.getItem('subscription');
            const expiry = localStorage.getItem('subscriptionExpiry');
            const features = JSON.parse(localStorage.getItem('subscriptionFeatures') || '[]');
            
            const now = new Date().getTime();
            const expiryTime = expiry ? new Date(expiry).getTime() : 0;
            const hasValidSubscription = subscription && expiryTime > now;
            
            // First unlock all features
            unlockAllFeatures();
            
            // Then lock features only for basic plan or no subscription
            if (!hasValidSubscription || subscription === 'basic') {
                lockAdvancedFeatures();
            }
        }
        
        function unlockAllFeatures() {
            // Remove all restrictions and lock icons
            const allRestrictedElements = document.querySelectorAll('[data-smart-suggestion], [data-advanced-analytics], [data-ai-prediction], .smart-suggestion, .ai-suggestion, .advanced-analytics, .ai-prediction, .prediction-feature');
            
            allRestrictedElements.forEach(element => {
                // Reset visual restrictions
                element.style.opacity = '';
                element.style.pointerEvents = '';
                element.title = '';
                
                // Remove lock icons
                const lockIcon = element.querySelector('.lock-icon');
                if (lockIcon) {
                    lockIcon.remove();
                }
            });
            
            // Enable category dropdown
            const categorySelect = document.getElementById('categorySelect');
            if (categorySelect) {
                categorySelect.disabled = false;
                categorySelect.style.opacity = '';
                categorySelect.title = '';
            }
        }
        
        function lockAdvancedFeatures() {
            const currentLang = localStorage.getItem('language') || 'el';
            const messages = {
                el: {
                    premiumFeature: '🔒 Premium Δυνατότητα',
                    upgradeMessage: 'Αυτή η δυνατότητα απαιτεί αναβάθμιση σε Plus πλάνο.'
                },
                en: {
                    premiumFeature: '🔒 Premium Feature',
                    upgradeMessage: 'This feature requires an upgrade to Plus plan.'
                }
            };
            
            // Lock AI suggestions
            const smartSuggestionsElements = document.querySelectorAll('[data-smart-suggestion], .smart-suggestion, .ai-suggestion');
            smartSuggestionsElements.forEach(element => {
                element.style.opacity = '0.5';
                element.style.pointerEvents = 'none';
                element.title = messages[currentLang].upgradeMessage;
            });
            
            // Lock advanced analytics
            const advancedAnalyticsElements = document.querySelectorAll('.advanced-analytics, [data-advanced-analytics]');
            advancedAnalyticsElements.forEach(element => {
                element.style.opacity = '0.5';
                element.style.pointerEvents = 'none';
                element.title = messages[currentLang].upgradeMessage;
            });
            
            // Lock category dropdown
            const categorySelect = document.getElementById('categorySelect');
            if (categorySelect) {
                categorySelect.disabled = true;
                categorySelect.style.opacity = '0.5';
                categorySelect.title = messages[currentLang].upgradeMessage;
            }
            
            // Lock AI predictions
            const aiPredictionElements = document.querySelectorAll('.ai-prediction, [data-ai-prediction], .prediction-feature');
            aiPredictionElements.forEach(element => {
                element.style.opacity = '0.5';
                element.style.pointerEvents = 'none';
                element.title = messages[currentLang].upgradeMessage;
            });
            
            // Add lock icons to restricted features
            addLockIcons();
        }
        
        function addLockIcons() {
            const restrictedSelectors = [
                '[data-smart-suggestion]',
                '.smart-suggestion',
                '.ai-suggestion',
                '.advanced-analytics',
                '[data-advanced-analytics]',
                '.ai-prediction',
                '[data-ai-prediction]',
                '.prediction-feature'
            ];
            
            restrictedSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    if (!element.querySelector('.lock-icon')) {
                        const lockIcon = document.createElement('span');
                        lockIcon.className = 'lock-icon';
                        lockIcon.innerHTML = '🔒';
                        lockIcon.style.cssText = `
                            position: absolute;
                            top: 5px;
                            right: 5px;
                            font-size: 0.8rem;
                            opacity: 0.7;
                            z-index: 10;
                        `;
                        
                        element.style.position = 'relative';
                        element.appendChild(lockIcon);
                    }
                });
            });
        }
        
        // ==================== FOOTER MODAL FUNCTIONS ====================
        
        function showTermsModal() {
            const t = translations[currentLanguage];
            showCustomModal(
                t.terms_title || 'Terms of Use',
                `
                <div style="text-align: left; line-height: 1.6; max-height: 400px; overflow-y: auto;">
                    <h3>${t.terms_section1 || 'Service Description'}</h3>
                    <p>${t.terms_desc1 || 'This service provides business analytics and tracking tools for a monthly subscription fee. The service includes comprehensive data analysis and forecasting capabilities.'}</p>
                    
                    <h3>${t.terms_section2 || 'Payment Terms'}</h3>
                    <p>${t.terms_desc2 || 'Payment is processed monthly via Stripe. The subscription will automatically renew unless cancelled before the renewal date.'}</p>
                    
                    <h3>${t.terms_section3 || 'Cancellation Policy'}</h3>
                    <p>${t.terms_desc3 || 'You may cancel your subscription at any time through the subscription page. No refunds will be provided for partial month usage.'}</p>
                    
                    <h3>${t.terms_section4 || 'User Responsibilities'}</h3>
                    <p>${t.terms_desc4 || 'Users are responsible for maintaining account security, data accuracy, and following platform guidelines.'}</p>
                </div>
                `,
                'I Understand'
            );
        }

        function showPrivacyModal() {
            const t = translations[currentLanguage];
            showCustomModal(
                t.privacy_title || 'Privacy Policy',
                `
                <div style="text-align: left; line-height: 1.6; max-height: 400px; overflow-y: auto;">
                    <h3>${t.privacy_section1 || 'Data Collection'}</h3>
                    <p>${t.privacy_desc1 || 'We collect business data that you input, usage analytics, and account information necessary for service provision.'}</p>
                    
                    <h3>${t.privacy_section2 || 'Data Usage'}</h3>
                    <p>${t.privacy_desc2 || 'Your business data is used solely for providing analytics, forecasting, and insights. We do not share or sell your business information.'}</p>
                    
                    <h3>${t.privacy_section3 || 'Data Security'}</h3>
                    <p>${t.privacy_desc3 || 'All data is encrypted and stored securely in Firebase with industry-standard security measures. Local data is stored in your browser only.'}</p>
                    
                    <h3>${t.privacy_section4 || 'Your Rights'}</h3>
                    <p>${t.privacy_desc4 || 'You have the right to export, modify, or delete your business data at any time through the dashboard or by contacting support.'}</p>
                </div>
                `,
                'Understood'
            );
        }

        function showRefundModal() {
            const t = translations[currentLanguage];
            showCustomModal(
                t.refund_title || 'Refund Policy',
                `
                <div style="text-align: left; line-height: 1.6; max-height: 400px; overflow-y: auto;">
                    <h3>${t.refund_section1 || 'General Policy'}</h3>
                    <p>${t.refund_desc1 || 'Due to the nature of our analytics service, refunds are considered on a case-by-case basis for technical issues that prevent service use.'}</p>
                    
                    <h3>${t.refund_section2 || 'Trial Period'}</h3>
                    <p>${t.refund_desc2 || 'If you have an active trial, you can cancel before it ends to avoid charges. Contact support for assistance with trial management.'}</p>
                    
                    <h3>${t.refund_section3 || 'Special Circumstances'}</h3>
                    <p>${t.refund_desc3 || 'Refunds may be provided for verified technical issues, billing errors, or service outages affecting your ability to use the platform.'}</p>
                    
                    <h3>${t.refund_section4 || 'Contact Support'}</h3>
                    <p>${t.refund_desc4 || 'For refund requests, contact our support team with your account details, subscription information, and detailed reason for the request.'}</p>
                </div>
                `,
                'Contact Support'
            );
        }

        function showContactModal() {
            const t = translations[currentLanguage];
            showCustomModal(
                t.contact_title || 'Contact Support',
                `
                <div style="text-align: left; line-height: 1.6;">
                    <div style="background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <h3 style="margin-top: 0;">${t.contact_email || 'Email Support'}</h3>
                        <p style="margin: 5px 0;"><strong>Email:</strong> support@businesstracker.com</p>
                        <p style="margin: 5px 0; font-size: 12px; color: rgba(255,255,255,0.7);">${t.contact_response || 'Response within 24 hours'}</p>
                    </div>
                    
                    <div style="background: rgba(46, 204, 113, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <h3 style="margin-top: 0;">${t.contact_live || 'Live Chat'}</h3>
                        <p style="margin: 5px 0;">${t.contact_available || 'Available Monday-Friday 9AM-6PM EST'}</p>
                        <button onclick="startLiveChat()" style="background: #2ecc71; color: white; border: none; padding: 8px 16px; border-radius: 5px; margin-top: 8px;">${t.contact_start_chat || 'Start Chat'}</button>
                    </div>
                    
                    <div style="background: rgba(155, 89, 182, 0.1); padding: 15px; border-radius: 10px;">
                        <h3 style="margin-top: 0;">${t.contact_phone || 'Technical Support'}</h3>
                        <p style="margin: 5px 0;"><strong>Phone:</strong> +1 (555) 123-4567</p>
                        <p style="margin: 5px 0; font-size: 12px; color: rgba(255,255,255,0.7);">${t.contact_business || 'Business hours only'}</p>
                    </div>
                </div>
                `,
                'Got It'
            );
        }

        function showHelpModal() {
            const t = translations[currentLanguage];
            showCustomModal(
                t.help_title || 'Help Center',
                `
                <div style="text-align: left; line-height: 1.6;">
                    <div style="display: grid; gap: 12px;">
                        <div style="background: rgba(52, 152, 219, 0.1); padding: 12px; border-radius: 8px; cursor: pointer;" onclick="showDataHelp()">
                            <h4 style="margin: 0; color: #3498db;">${t.help_data || '📊 Data Management'}</h4>
                            <p style="margin: 5px 0 0; font-size: 12px; color: rgba(255,255,255,0.7);">${t.help_data_desc || 'Adding data, editing values, importing/exporting'}</p>
                        </div>
                        
                        <div style="background: rgba(46, 204, 113, 0.1); padding: 12px; border-radius: 8px; cursor: pointer;" onclick="showAnalyticsHelp()">
                            <h4 style="margin: 0; color: #2ecc71;">${t.help_analytics || '📈 Analytics & Charts'}</h4>
                            <p style="margin: 5px 0 0; font-size: 12px; color: rgba(255,255,255,0.7);">${t.help_analytics_desc || 'Understanding charts, forecasting, insights'}</p>
                        </div>
                        
                        <div style="background: rgba(230, 126, 34, 0.1); padding: 12px; border-radius: 8px; cursor: pointer;" onclick="showAccountHelp()">
                            <h4 style="margin: 0; color: #e67e22;">${t.help_account || '👤 Account & Billing'}</h4>
                            <p style="margin: 5px 0 0; font-size: 12px; color: rgba(255,255,255,0.7);">${t.help_account_desc || 'Subscription management, billing, account settings'}</p>
                        </div>
                        
                        <div style="background: rgba(155, 89, 182, 0.1); padding: 12px; border-radius: 8px; cursor: pointer;" onclick="showTechnicalHelp()">
                            <h4 style="margin: 0; color: #9b59b6;">${t.help_technical || '⚙️ Technical Support'}</h4>
                            <p style="margin: 5px 0 0; font-size: 12px; color: rgba(255,255,255,0.7);">${t.help_technical_desc || 'Browser issues, performance, troubleshooting'}</p>
                        </div>
                    </div>
                </div>
                `,
                'Contact Support'
            );
        }

        function showFaqModal() {
            const t = translations[currentLanguage];
            showCustomModal(
                t.faq_title || 'Frequently Asked Questions',
                `
                <div style="text-align: left; line-height: 1.6; max-height: 400px; overflow-y: auto;">
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #3498db; margin: 0 0 5px 0;">${t.faq_q1 || 'How do I add sales data?'}</h4>
                        <p style="margin: 0; font-size: 13px; color: rgba(255,255,255,0.8);">${t.faq_a1 || 'Click on any cell in the table to edit values directly. Use the "Add Category" button to create new product categories.'}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #2ecc71; margin: 0 0 5px 0;">${t.faq_q2 || 'How accurate are the forecasts?'}</h4>
                        <p style="margin: 0; font-size: 13px; color: rgba(255,255,255,0.8);">${t.faq_a2 || 'Forecasts use advanced algorithms combining trend analysis, seasonal patterns, and historical data. Accuracy improves with more data.'}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #e67e22; margin: 0 0 5px 0;">${t.faq_q3 || 'Can I export my data?'}</h4>
                        <p style="margin: 0; font-size: 13px; color: rgba(255,255,255,0.8);">${t.faq_a3 || 'Yes, use the Export buttons to download your data in Excel or PDF format. Your data is also automatically saved.'}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #9b59b6; margin: 0 0 5px 0;">${t.faq_q4 || 'What are Smart Insights?'}</h4>
                        <p style="margin: 0; font-size: 13px; color: rgba(255,255,255,0.8);">${t.faq_a4 || 'AI-powered analysis that identifies trends, opportunities, and potential issues in your business data automatically.'}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #e74c3c; margin: 0 0 5px 0;">${t.faq_q5 || 'Is my business data secure?'}</h4>
                        <p style="margin: 0; font-size: 13px; color: rgba(255,255,255,0.8);">${t.faq_a5 || 'Yes, all data is encrypted and stored securely. You can also work offline with local storage as backup.'}</p>
                    </div>
                </div>
                `,
                'Got It'
            );
        }

        // Helper functions για τα modals
        function showCustomModal(title, content, buttonText = 'Close') {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                           padding: 25px; border-radius: 15px; max-width: 500px; width: 90%; 
                           max-height: 70vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <h2 style="margin: 0 0 20px 0; color: white; font-size: 18px; text-align: center;">${title}</h2>
                    ${content}
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="this.closest('.modal-overlay').remove()" 
                               style="background: rgba(255,255,255,0.2); color: white; border: none; 
                                      padding: 10px 20px; border-radius: 8px; cursor: pointer; 
                                      font-weight: 600; transition: all 0.3s ease;">
                            ${buttonText}
                        </button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal-overlay';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            document.body.appendChild(modal);
        }

        function startLiveChat() {
            const t = translations[currentLanguage];
            showNotification(
                t.chat_starting || 'Starting live chat...',
                'info'
            );
            setTimeout(() => {
                showNotification(
                    t.chat_demo || 'Live chat demo - Contact support for real assistance',
                    'warning'
                );
            }, 2000);
        }

        function showDataHelp() {
            showNotification('📊 Opening Data Management help...', 'info');
        }

        function showAnalyticsHelp() {
            showNotification('📈 Opening Analytics help...', 'info');
        }

        function showAccountHelp() {
            showNotification('👤 Opening Account help...', 'info');
        }

        function showTechnicalHelp() {
            showNotification('⚙️ Opening Technical Support...', 'info');
        }

        // ==================== END FOOTER MODAL FUNCTIONS ====================
        
        // Override restricted functions
        function showSubscriptionPrompt(feature) {
            const currentLang = localStorage.getItem('language') || 'el';
            const messages = {
                el: {
                    title: '🔒 Premium Δυνατότητα',
                    message: 'Αυτή η δυνατότητα απαιτεί αναβάθμιση σε Plus πλάνο. Θέλετε να δείτε τα διαθέσιμα πλάνα;',
                    upgrade: 'Δείτε Πλάνα',
                    cancel: 'Όχι τώρα'
                },
                en: {
                    title: '🔒 Premium Feature',
                    message: 'This feature requires an upgrade to Plus plan. Would you like to see available plans?',
                    upgrade: 'View Plans',
                    cancel: 'Not now'
                }
            };
            
            const msg = messages[currentLang];
            
            if (confirm(msg.message)) {
                window.location.href = 'subscription.html';
            }
        }
    </script>

    <!-- Footer Section -->
    <footer class="terms-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4 data-translate="terms_policies">Terms & Policies</h4>
                <div class="footer-links">
                    <a href="#" onclick="showTermsModal()" data-translate="terms_of_use">Terms of Use</a>
                    <a href="#" onclick="showPrivacyModal()" data-translate="privacy_policy">Privacy Policy</a>
                    <a href="#" onclick="showRefundModal()" data-translate="refund_policy">Refund Policy</a>
                </div>
            </div>
            
            <div class="footer-section">
                <h4 data-translate="support">Support</h4>
                <div class="footer-links">
                    <a href="#" onclick="showContactModal()" data-translate="contact_us">Contact Us</a>
                    <a href="#" onclick="showHelpModal()" data-translate="help_center">Help Center</a>
                    <a href="#" onclick="showFaqModal()" data-translate="faq">FAQ</a>
                </div>
            </div>
            
            <div class="footer-section">
                <h4 data-translate="company">Company</h4>
                <div class="footer-text" data-translate="copyright">© 2025 Business Tracker. All rights reserved.</div>
                <div class="footer-secure" data-translate="secure_encrypted">🔒 Secure & Encrypted</div>
            </div>
        </div>
    </footer>

</body>
</html>
